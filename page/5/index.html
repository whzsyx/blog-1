<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon.ico">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-minimal.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Pisces',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":true},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'å¤åˆ¶',
      copy_success: 'å¤åˆ¶æˆåŠŸ',
      copy_failure: 'å¤åˆ¶å¤±è´¥'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="Dunwu&#39;s Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Dunwu">
<meta property="og:url" content="https://dunwu.github.io/blog/page/5/index.html">
<meta property="og:site_name" content="Dunwu">
<meta property="og:description" content="Dunwu&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Zhang Peng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://dunwu.github.io/blog/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Dunwu</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/blog/atom.xml" title="Dunwu" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dunwu</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">å¤§é“è‡³ç®€ï¼ŒçŸ¥æ˜“è¡Œéš¾</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾<span class="badge">102</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»<span class="badge">37</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£<span class="badge">173</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="æœç´¢..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/dunwu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2021/04/29/%E9%87%8D%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/04/29/%E9%87%8D%E6%9E%84/" class="post-title-link" itemprop="url">é‡æ„</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-04-29 16:05:03" itemprop="dateCreated datePublished" datetime="2021-04-29T16:05:03+08:00">2021-04-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index">
                    <span itemprop="name">è®¾è®¡</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/%E9%87%8D%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">é‡æ„</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/2021/04/29/%E9%87%8D%E6%9E%84/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/04/29/é‡æ„/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>204</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="é‡æ„"><a class="markdownIt-Anchor" href="#é‡æ„"></a> é‡æ„</h1>
<blockquote>
<p><strong>é‡æ„æ˜¯ä¸æ”¹å˜è½¯ä»¶ç³»ç»Ÿå¤–éƒ¨è¡Œä¸ºçš„å‰æä¸‹ï¼Œæ”¹å–„å®ƒçš„å†…éƒ¨ç»“æ„</strong>ã€‚</p>
<p><strong>é‡æ„çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜ä»£ç çš„è´¨é‡å’Œæ€§èƒ½</strong>ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210430112157.png" alt="img" /></p>
<h2 id="å†…å®¹"><a class="markdownIt-Anchor" href="#å†…å®¹"></a> ğŸ“– å†…å®¹</h2>
<ul>
<li><a href="01.%E4%BB%A3%E7%A0%81%E7%9A%84%E5%9D%8F%E5%91%B3%E9%81%93%E5%92%8C%E9%87%8D%E6%9E%84.md">ä»£ç çš„åå‘³é“å’Œé‡æ„</a></li>
<li><a href="02.%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E4%BB%A3%E7%A0%81%E8%87%83%E8%82%BF.md">ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿</a></li>
<li><a href="03.%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E6%BB%A5%E7%94%A8%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1.md">ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡</a></li>
<li><a href="04.%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E5%8F%98%E9%9D%A9%E7%9A%84%E9%9A%9C%E7%A2%8D.md">ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢</a></li>
<li><a href="05.%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E9%9D%9E%E5%BF%85%E8%A6%81%E7%9A%84.md">ä»£ç åå‘³é“ä¹‹éå¿…è¦çš„</a></li>
<li><a href="06.%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E8%80%A6%E5%90%88.md">ä»£ç åå‘³é“ä¹‹è€¦åˆ</a></li>
</ul>
<h2 id="èµ„æ–™"><a class="markdownIt-Anchor" href="#èµ„æ–™"></a> ğŸ“š èµ„æ–™</h2>
<ul>
<li><a href="https://book.douban.com/subject/4199741/" target="_blank" rel="noopener">ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹</a></li>
<li><a href="https://book.douban.com/subject/4262627/" target="_blank" rel="noopener">ã€Šé‡æ„ - æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹</a></li>
<li><a href="https://book.douban.com/subject/1477390/" target="_blank" rel="noopener">ã€Šä»£ç å¤§å…¨ã€‹</a></li>
<li><a href="https://sourcemaking.com/refactoring" target="_blank" rel="noopener">https://sourcemaking.com/refactoring</a></li>
</ul>
<h2 id="ä¼ é€"><a class="markdownIt-Anchor" href="#ä¼ é€"></a> ğŸšª ä¼ é€</h2>
<p>â—¾ ğŸ  <a href="https://github.com/dunwu/design" target="_blank" rel="noopener">DESIGN é¦–é¡µ</a> â—¾ ğŸ¯ <a href="https://github.com/dunwu/blog" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a> â—¾</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2021/04/29/%E7%BC%96%E7%A8%8B%E8%8C%83%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/04/29/%E7%BC%96%E7%A8%8B%E8%8C%83%E5%BC%8F/" class="post-title-link" itemprop="url">ç¼–ç¨‹èŒƒå¼</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-04-29 16:05:03" itemprop="dateCreated datePublished" datetime="2021-04-29T16:05:03+08:00">2021-04-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index">
                    <span itemprop="name">è®¾è®¡</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%BC%96%E7%A8%8B%E8%8C%83%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">ç¼–ç¨‹èŒƒå¼</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/2021/04/29/%E7%BC%96%E7%A8%8B%E8%8C%83%E5%BC%8F/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/04/29/ç¼–ç¨‹èŒƒå¼/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>57</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ç¼–ç¨‹èŒƒå¼"><a class="markdownIt-Anchor" href="#ç¼–ç¨‹èŒƒå¼"></a> ç¼–ç¨‹èŒƒå¼</h1>
<h2 id="å†…å®¹"><a class="markdownIt-Anchor" href="#å†…å®¹"></a> ğŸ“– å†…å®¹</h2>
<ul>
<li><a href="01.%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86.md">é”™è¯¯å¤„ç†</a></li>
</ul>
<h2 id="èµ„æ–™"><a class="markdownIt-Anchor" href="#èµ„æ–™"></a> ğŸ“š èµ„æ–™</h2>
<ul>
<li><strong>ä¹¦ç±</strong>
<ul>
<li><a href="ttps://item.jd.com/12828404.html">ã€Šç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“ã€‹</a></li>
<li><a href="https://item.jd.com/12842858.html" target="_blank" rel="noopener">ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹</a></li>
</ul>
</li>
</ul>
<h2 id="ä¼ é€"><a class="markdownIt-Anchor" href="#ä¼ é€"></a> ğŸšª ä¼ é€</h2>
<p>â—¾ ğŸ  <a href="https://github.com/dunwu/design" target="_blank" rel="noopener">DESIGN é¦–é¡µ</a> â—¾ ğŸ¯ <a href="https://github.com/dunwu/blog" target="_blank" rel="noopener">æˆ‘çš„åšå®¢</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2021/04/14/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E8%AE%A9%E4%BD%A0%E5%BD%BB%E5%BA%95%E6%8E%8C%E6%8F%A1-scala/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/04/14/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E8%AE%A9%E4%BD%A0%E5%BD%BB%E5%BA%95%E6%8E%8C%E6%8F%A1-scala/" class="post-title-link" itemprop="url">ä¸€ç¯‡æ–‡ç« è®©ä½ å½»åº•æŒæ¡ Scala</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-04-14 15:27:00" itemprop="dateCreated datePublished" datetime="2021-04-14T15:27:00+08:00">2021-04-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index">
                    <span itemprop="name">ç¼–ç¨‹</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/2021/04/14/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E8%AE%A9%E4%BD%A0%E5%BD%BB%E5%BA%95%E6%8E%8C%E6%8F%A1-scala/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/04/14/ä¸€ç¯‡æ–‡ç« è®©ä½ å½»åº•æŒæ¡-scala/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>7.6k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>7 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="scala-å…¥é—¨"><a class="markdownIt-Anchor" href="#scala-å…¥é—¨"></a> Scala å…¥é—¨</h1>
<blockquote>
<p>Scala æ˜¯å¤§æ•°æ®é¢†åŸŸçš„çƒ­é—¨è¯­è¨€ï¼Œå¦‚ï¼šAkkaã€Kafkaï¼Œæ‰€ä»¥ï¼Œæƒ³è¦å­¦ä¹ å¤§æ•°æ®é¡¶çº§å¼€æºé¡¹ç›®çš„æºç ï¼Œæœ‰å¿…è¦å…·å¤‡ä¸€å®šçš„ Scala åŸºç¡€ã€‚</p>
</blockquote>
<!-- TOC depthFrom:2 depthTo:3 -->
<ul>
<li><a href="#1-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95">1. åŸºæœ¬è¯­æ³•</a></li>
<li><a href="#2-%E6%B3%A8%E9%87%8A">2. æ³¨é‡Š</a></li>
<li><a href="#3-%E5%8F%98%E9%87%8F">3. å˜é‡</a>
<ul>
<li><a href="#31-%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B%E5%A3%B0%E6%98%8E">3.1. å˜é‡ç±»å‹å£°æ˜</a></li>
</ul>
</li>
<li><a href="#4-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">4. æ•°æ®ç±»å‹</a></li>
<li><a href="#5-%E6%95%B0%E7%BB%84">5. æ•°ç»„</a></li>
<li><a href="#6-%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5">6. é€»è¾‘æ§åˆ¶è¯­å¥</a>
<ul>
<li><a href="#61-%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5">6.1. æ¡ä»¶è¯­å¥</a></li>
<li><a href="#62-%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5">6.2. å¾ªç¯è¯­å¥</a></li>
<li><a href="#63-%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D">6.3. æ¨¡å¼åŒ¹é…</a></li>
</ul>
</li>
<li><a href="#7-%E8%BF%90%E7%AE%97%E7%AC%A6">7. è¿ç®—ç¬¦</a></li>
<li><a href="#8-%E6%96%B9%E6%B3%95%E4%B8%8E%E5%87%BD%E6%95%B0">8. æ–¹æ³•ä¸å‡½æ•°</a></li>
<li><a href="#9-%E9%97%AD%E5%8C%85">9. é—­åŒ…</a></li>
<li><a href="#10-%E9%9B%86%E5%90%88">10. é›†åˆ</a>
<ul>
<li><a href="#101-%E8%BF%AD%E4%BB%A3%E5%99%A8">10.1. è¿­ä»£å™¨</a></li>
</ul>
</li>
<li><a href="#11-%E7%B1%BB%E5%92%8C%E5%AF%B9%E8%B1%A1">11. ç±»å’Œå¯¹è±¡</a></li>
<li><a href="#12-trait">12. Trait</a></li>
<li><a href="#13-%E5%BC%82%E5%B8%B8">13. å¼‚å¸¸</a></li>
<li><a href="#14-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA">14. è¾“å…¥è¾“å‡º</a>
<ul>
<li><a href="#141-%E8%AF%BB%E5%8F%96%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5">14.1. è¯»å–ç”¨æˆ·è¾“å…¥</a></li>
<li><a href="#142-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9">14.2. è¯»å–æ–‡ä»¶å†…å®¹</a></li>
</ul>
</li>
<li><a href="#15-%E5%8C%85">15. åŒ…</a>
<ul>
<li><a href="#151-%E5%AE%9A%E4%B9%89%E5%8C%85">15.1. å®šä¹‰åŒ…</a></li>
<li><a href="#152-%E5%BC%95%E7%94%A8">15.2. å¼•ç”¨</a></li>
<li><a href="#153-%E8%AE%BF%E9%97%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6">15.3. è®¿é—®ä¿®é¥°ç¬¦</a></li>
</ul>
</li>
<li><a href="#16-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">16. å‚è€ƒèµ„æ–™</a></li>
</ul>
<!-- /TOC -->
<h2 id="1-åŸºæœ¬è¯­æ³•"><a class="markdownIt-Anchor" href="#1-åŸºæœ¬è¯­æ³•"></a> 1. åŸºæœ¬è¯­æ³•</h2>
<p>Scala åŸºæœ¬è¯­æ³•éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li><strong>åŒºåˆ†å¤§å°å†™</strong> - Scala æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚</li>
<li><strong>ç±»å</strong> - å¯¹äºæ‰€æœ‰çš„ç±»åçš„ç¬¬ä¸€ä¸ªå­—æ¯è¦å¤§å†™ã€‚ç¤ºä¾‹ï¼š<code>class MyFirstScalaClass</code></li>
<li><strong>æ–¹æ³•åç§°</strong> - æ‰€æœ‰çš„æ–¹æ³•åç§°çš„ç¬¬ä¸€ä¸ªå­—æ¯ç”¨å°å†™ã€‚ç¤ºä¾‹ï¼š<code>def myMethodName()</code></li>
<li><strong>ç¨‹åºæ–‡ä»¶å</strong> - ç¨‹åºæ–‡ä»¶çš„åç§°åº”è¯¥ä¸å¯¹è±¡åç§°å®Œå…¨åŒ¹é…(æ–°ç‰ˆæœ¬ä¸éœ€è¦äº†ï¼Œä½†å»ºè®®ä¿ç•™è¿™ç§ä¹ æƒ¯)ã€‚ç¤ºä¾‹: å‡è®¾&quot;HelloWorld&quot;æ˜¯å¯¹è±¡çš„åç§°ã€‚é‚£ä¹ˆè¯¥æ–‡ä»¶åº”ä¿å­˜ä¸ºâ€™HelloWorld.scala&quot;</li>
<li><strong><code>def main(args: Array[String])</code></strong> - Scala ç¨‹åºä» <code>main()</code> æ–¹æ³•å¼€å§‹å¤„ç†ï¼Œè¿™æ˜¯æ¯ä¸€ä¸ª Scala ç¨‹åºçš„å¼ºåˆ¶ç¨‹åºå…¥å£éƒ¨åˆ†ã€‚</li>
<li>ä¸€è¡Œä¸­åªæœ‰ç©ºæ ¼æˆ–è€…å¸¦æœ‰æ³¨é‡Šï¼ŒScala ä¼šè®¤ä¸ºå…¶æ˜¯ç©ºè¡Œï¼Œä¼šå¿½ç•¥å®ƒã€‚æ ‡è®°å¯ä»¥è¢«ç©ºæ ¼æˆ–è€…æ³¨é‡Šæ¥åˆ†å‰²ã€‚</li>
<li>Scala æ˜¯é¢å‘è¡Œçš„è¯­è¨€ï¼Œè¯­å¥å¯ä»¥ç”¨åˆ†å·ï¼ˆ;ï¼‰ç»“æŸæˆ–æ¢è¡Œç¬¦ã€‚</li>
</ul>
<h2 id="2-æ³¨é‡Š"><a class="markdownIt-Anchor" href="#2-æ³¨é‡Š"></a> 2. æ³¨é‡Š</h2>
<p>Scala ç±»ä¼¼ Java æ”¯æŒå•è¡Œå’Œå¤šè¡Œæ³¨é‡Šã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘å•è¡Œå’Œå¤šè¡Œæ³¨é‡Š</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ª Scala ç¨‹åº</span></span><br><span class="line"><span class="comment">   * ä»¥ä¸‹ç¨‹åºå°†è¾“å‡º'Hello World!'</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    println(<span class="string">"Hello, world!"</span>) <span class="comment">// è¾“å‡º Hello World</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-å˜é‡"><a class="markdownIt-Anchor" href="#3-å˜é‡"></a> 3. å˜é‡</h2>
<p>åœ¨ Scala ä¸­ï¼Œä½¿ç”¨å…³é”®è¯ <code>var</code> å£°æ˜å˜é‡ï¼Œä½¿ç”¨å…³é”®è¯ <code>val</code> å£°æ˜å¸¸é‡ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘å£°æ˜å˜é‡</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> myVar : <span class="type">String</span> = <span class="string">"Foo"</span></span><br><span class="line"><span class="keyword">var</span> myVar : <span class="type">String</span> = <span class="string">"Too"</span></span><br></pre></td></tr></table></figure>
<p>ã€ç¤ºä¾‹ã€‘å£°æ˜å¸¸é‡</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> myVal : <span class="type">String</span> = <span class="string">"Foo"</span></span><br></pre></td></tr></table></figure>
<h3 id="31-å˜é‡ç±»å‹å£°æ˜"><a class="markdownIt-Anchor" href="#31-å˜é‡ç±»å‹å£°æ˜"></a> 3.1. å˜é‡ç±»å‹å£°æ˜</h3>
<p>å˜é‡çš„ç±»å‹åœ¨å˜é‡åä¹‹åç­‰å·ä¹‹å‰å£°æ˜ã€‚å®šä¹‰å˜é‡çš„ç±»å‹çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜å˜é‡ç±»å‹</span></span><br><span class="line"><span class="keyword">var</span> <span class="type">VariableName</span> : <span class="type">DataType</span> [=  <span class="type">Initial</span> <span class="type">Value</span>]</span><br><span class="line"><span class="comment">// å£°æ˜å¸¸é‡ç±»å‹</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">VariableName</span> : <span class="type">DataType</span> [=  <span class="type">Initial</span> <span class="type">Value</span>]</span><br></pre></td></tr></table></figure>
<p>åœ¨ Scala ä¸­å£°æ˜å˜é‡å’Œå¸¸é‡ä¸ä¸€å®šè¦æŒ‡æ˜æ•°æ®ç±»å‹ï¼Œåœ¨æ²¡æœ‰æŒ‡æ˜æ•°æ®ç±»å‹çš„æƒ…å†µä¸‹ï¼Œå…¶æ•°æ®ç±»å‹æ˜¯é€šè¿‡å˜é‡æˆ–å¸¸é‡çš„åˆå§‹å€¼æ¨æ–­å‡ºæ¥çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœåœ¨æ²¡æœ‰æŒ‡æ˜æ•°æ®ç±»å‹çš„æƒ…å†µä¸‹å£°æ˜å˜é‡æˆ–å¸¸é‡å¿…é¡»è¦ç»™å‡ºå…¶åˆå§‹å€¼ï¼Œå¦åˆ™å°†ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> myVar = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">val</span> myVal = <span class="string">"Hello, Scala!"</span>;</span><br><span class="line"><span class="keyword">val</span> xmax, ymax = <span class="number">100</span></span><br></pre></td></tr></table></figure>
<h2 id="4-æ•°æ®ç±»å‹"><a class="markdownIt-Anchor" href="#4-æ•°æ®ç±»å‹"></a> 4. æ•°æ®ç±»å‹</h2>
<p>Scala ä¸ Java æœ‰ç€ç›¸åŒçš„æ•°æ®ç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">æ•°æ®ç±»å‹</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Byte</td>
<td style="text-align:left">8 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -128 åˆ° 127</td>
</tr>
<tr>
<td style="text-align:left">Short</td>
<td style="text-align:left">16 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -32768 åˆ° 32767</td>
</tr>
<tr>
<td style="text-align:left">Int</td>
<td style="text-align:left">32 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -2147483648 åˆ° 2147483647</td>
</tr>
<tr>
<td style="text-align:left">Long</td>
<td style="text-align:left">64 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -9223372036854775808 åˆ° 9223372036854775807</td>
</tr>
<tr>
<td style="text-align:left">Float</td>
<td style="text-align:left">32 ä½, IEEE 754 æ ‡å‡†çš„å•ç²¾åº¦æµ®ç‚¹æ•°</td>
</tr>
<tr>
<td style="text-align:left">Double</td>
<td style="text-align:left">64 ä½ IEEE 754 æ ‡å‡†çš„åŒç²¾åº¦æµ®ç‚¹æ•°</td>
</tr>
<tr>
<td style="text-align:left">Char</td>
<td style="text-align:left">16 ä½æ— ç¬¦å· Unicode å­—ç¬¦, åŒºé—´å€¼ä¸º U+0000 åˆ° U+FFFF</td>
</tr>
<tr>
<td style="text-align:left">String</td>
<td style="text-align:left">å­—ç¬¦åºåˆ—</td>
</tr>
<tr>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">true æˆ– false</td>
</tr>
<tr>
<td style="text-align:left">Unit</td>
<td style="text-align:left">è¡¨ç¤ºæ— å€¼ï¼Œå’Œå…¶ä»–è¯­è¨€ä¸­ void ç­‰åŒã€‚ç”¨ä½œä¸è¿”å›ä»»ä½•ç»“æœçš„æ–¹æ³•çš„ç»“æœç±»å‹ã€‚Unit åªæœ‰ä¸€ä¸ªå®ä¾‹å€¼ï¼Œå†™æˆ()ã€‚</td>
</tr>
<tr>
<td style="text-align:left">Null</td>
<td style="text-align:left">null æˆ–ç©ºå¼•ç”¨</td>
</tr>
<tr>
<td style="text-align:left">Nothing</td>
<td style="text-align:left">Nothing ç±»å‹åœ¨ Scala çš„ç±»å±‚çº§çš„æœ€åº•ç«¯ï¼›å®ƒæ˜¯ä»»ä½•å…¶ä»–ç±»å‹çš„å­ç±»å‹ã€‚</td>
</tr>
<tr>
<td style="text-align:left">Any</td>
<td style="text-align:left">Any æ˜¯æ‰€æœ‰å…¶ä»–ç±»çš„è¶…ç±»</td>
</tr>
<tr>
<td style="text-align:left">AnyRef</td>
<td style="text-align:left">AnyRef ç±»æ˜¯ Scala é‡Œæ‰€æœ‰å¼•ç”¨ç±»(reference class)çš„åŸºç±»</td>
</tr>
</tbody>
</table>
<p>ä¸Šè¡¨ä¸­åˆ—å‡ºçš„æ•°æ®ç±»å‹éƒ½æ˜¯<strong>å¯¹è±¡</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ scala æ²¡æœ‰ java ä¸­çš„åŸç”Ÿç±»å‹ã€‚åœ¨ scala æ˜¯å¯ä»¥å¯¹æ•°å­—ç­‰åŸºç¡€ç±»å‹è°ƒç”¨æ–¹æ³•çš„ã€‚</p>
<h2 id="5-æ•°ç»„"><a class="markdownIt-Anchor" href="#5-æ•°ç»„"></a> 5. æ•°ç»„</h2>
<p>Scala æ•°ç»„å£°æ˜çš„è¯­æ³•æ ¼å¼ï¼š</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼ä¸€</span></span><br><span class="line"><span class="keyword">var</span> z:<span class="type">Array</span>[<span class="type">String</span>] = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">String</span>](<span class="number">3</span>)</span><br><span class="line"><span class="comment">// æ–¹å¼äºŒ</span></span><br><span class="line"><span class="keyword">var</span> z = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">String</span>](<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h2 id="6-é€»è¾‘æ§åˆ¶è¯­å¥"><a class="markdownIt-Anchor" href="#6-é€»è¾‘æ§åˆ¶è¯­å¥"></a> 6. é€»è¾‘æ§åˆ¶è¯­å¥</h2>
<h3 id="61-æ¡ä»¶è¯­å¥"><a class="markdownIt-Anchor" href="#61-æ¡ä»¶è¯­å¥"></a> 6.1. æ¡ä»¶è¯­å¥</h3>
<p>ã€ç¤ºä¾‹ã€‘æ¡ä»¶è¯­å¥</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">IfDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x == <span class="number">10</span>) &#123;</span><br><span class="line">      println(<span class="string">"X çš„å€¼ä¸º 10"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">20</span>) &#123;</span><br><span class="line">      println(<span class="string">"X çš„å€¼ä¸º 20"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">30</span>) &#123;</span><br><span class="line">      println(<span class="string">"X çš„å€¼ä¸º 30"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      println(<span class="string">"æ— æ³•åˆ¤æ–­ X çš„å€¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="62-å¾ªç¯è¯­å¥"><a class="markdownIt-Anchor" href="#62-å¾ªç¯è¯­å¥"></a> 6.2. å¾ªç¯è¯­å¥</h3>
<p>å’Œ Java ä¸€æ ·ï¼ŒScala æ”¯æŒ <code>while</code>ã€<code>do ... while</code>ã€<code>for</code> ä¸‰ç§å¾ªç¯è¯­å¥ã€‚</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">WhileDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="comment">// å±€éƒ¨å˜é‡</span></span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// while å¾ªç¯æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">while</span> (a &lt; <span class="number">20</span>) &#123;</span><br><span class="line">      println(<span class="string">"Value of a: "</span> + a);</span><br><span class="line">      a = a + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>scala ä¸æ”¯æŒ <code>break</code> å’Œ <code>continue</code></strong>ã€‚ä½†æ˜¯ï¼Œå¯ä»¥é€šè¿‡ <code>Breaks</code> å¯¹è±¡æ¥è¿›è¡Œå¾ªç¯æ§åˆ¶ã€‚</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.util.control._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">BreakDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">val</span> numList1 = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">val</span> numList2 = <span class="type">List</span>(<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> outer = <span class="keyword">new</span> <span class="type">Breaks</span>;</span><br><span class="line">    <span class="keyword">val</span> inner = <span class="keyword">new</span> <span class="type">Breaks</span>;</span><br><span class="line"></span><br><span class="line">    outer.breakable &#123;</span><br><span class="line">      <span class="keyword">for</span> (a &lt;- numList1) &#123;</span><br><span class="line">        println(<span class="string">"Value of a: "</span> + a);</span><br><span class="line">        inner.breakable &#123;</span><br><span class="line">          <span class="keyword">for</span> (b &lt;- numList2) &#123;</span><br><span class="line">            println(<span class="string">"Value of b: "</span> + b);</span><br><span class="line">            <span class="keyword">if</span> (b == <span class="number">12</span>) &#123;</span><br><span class="line">              inner.<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="comment">// å†…åµŒå¾ªç¯ä¸­æ–­</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="comment">// å¤–éƒ¨å¾ªç¯ä¸­æ–­</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="63-æ¨¡å¼åŒ¹é…"><a class="markdownIt-Anchor" href="#63-æ¨¡å¼åŒ¹é…"></a> 6.3. æ¨¡å¼åŒ¹é…</h3>
<p>scala çš„ <code>match</code> å¯¹åº” Java é‡Œçš„ <code>switch</code>ï¼Œä½†æ˜¯å†™åœ¨é€‰æ‹©å™¨è¡¨è¾¾å¼ä¹‹åã€‚å³ï¼š <strong>é€‰æ‹©å™¨ match {å¤‡é€‰é¡¹}ã€‚</strong></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @author peng.zhang</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">MatchDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    println(matchTest(<span class="string">"two"</span>))</span><br><span class="line">    println(matchTest(<span class="string">"test"</span>))</span><br><span class="line">    println(matchTest(<span class="number">1</span>))</span><br><span class="line">    println(matchTest(<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">matchTest</span></span>(x: <span class="type">Any</span>): <span class="type">Any</span> = x <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>      =&gt; <span class="string">"one"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"two"</span>  =&gt; <span class="number">2</span></span><br><span class="line">    <span class="keyword">case</span> y: <span class="type">Int</span> =&gt; <span class="string">"scala.Int"</span></span><br><span class="line">    <span class="keyword">case</span> _      =&gt; <span class="string">"many"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-è¿ç®—ç¬¦"><a class="markdownIt-Anchor" href="#7-è¿ç®—ç¬¦"></a> 7. è¿ç®—ç¬¦</h2>
<p>Scala å«æœ‰ä¸°å¯Œçš„å†…ç½®è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p>
<ul>
<li>ç®—æœ¯è¿ç®—ç¬¦ï¼š<code>+</code>ã€<code>-</code>ã€<code>*</code>ã€<code>/</code>ã€<code>%</code></li>
<li>å…³ç³»è¿ç®—ç¬¦ï¼š<code>==</code>ã€<code>!=</code>ã€<code>&gt;</code>ã€<code>&lt;</code>ã€<code>&gt;=</code>ã€<code>&lt;=</code></li>
<li>é€»è¾‘è¿ç®—ç¬¦ï¼š<code>&amp;&amp;</code>ã€<code>||</code>ã€<code>!</code></li>
<li>ä½è¿ç®—ç¬¦ï¼š<code>~</code>ã€<code>&amp;</code>ã€<code>|</code>ã€<code>^</code>ã€<code>&lt;&lt;</code>ã€<code>&gt;&gt;</code>ã€<code>&gt;&gt;&gt;</code> ï¼ˆæ— ç¬¦å·å³ç§»ï¼‰</li>
<li>èµ‹å€¼è¿ç®—ç¬¦ï¼š<code>=</code></li>
</ul>
<h2 id="8-æ–¹æ³•ä¸å‡½æ•°"><a class="markdownIt-Anchor" href="#8-æ–¹æ³•ä¸å‡½æ•°"></a> 8. æ–¹æ³•ä¸å‡½æ•°</h2>
<p>Scala æœ‰æ–¹æ³•ä¸å‡½æ•°ï¼ŒäºŒè€…åœ¨è¯­ä¹‰ä¸Šçš„åŒºåˆ«å¾ˆå°ã€‚</p>
<p>Scala ä¸­çš„æ–¹æ³•è·Ÿ Java çš„ç±»ä¼¼ï¼Œæ–¹æ³•æ˜¯ç»„æˆç±»çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>Scala ä¸­çš„å‡½æ•°åˆ™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ï¼ŒScala ä¸­çš„å‡½æ•°å…¶å®å°±æ˜¯ç»§æ‰¿äº† Trait çš„ç±»çš„å¯¹è±¡ã€‚</p>
<p>Scala ä¸­ä½¿ç”¨ <code>val</code> è¯­å¥å¯ä»¥å®šä¹‰å‡½æ•°ï¼Œ<code>def</code> è¯­å¥å®šä¹‰æ–¹æ³•ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">m</span></span>(x: <span class="type">Int</span>) = x + <span class="number">3</span></span><br><span class="line">  <span class="keyword">val</span> f = (x: <span class="type">Int</span>) =&gt; x + <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-é—­åŒ…"><a class="markdownIt-Anchor" href="#9-é—­åŒ…"></a> 9. é—­åŒ…</h2>
<p>é—­åŒ…æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›å€¼ä¾èµ–äºå£°æ˜åœ¨å‡½æ•°å¤–éƒ¨çš„ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡ã€‚</p>
<p>é—­åŒ…é€šå¸¸æ¥è®²å¯ä»¥ç®€å•çš„è®¤ä¸ºæ˜¯å¯ä»¥è®¿é—®ä¸€ä¸ªå‡½æ•°é‡Œé¢å±€éƒ¨å˜é‡çš„å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>å¦‚ä¸‹é¢è¿™æ®µåŒ¿åçš„å‡½æ•°ï¼š</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> multiplier = (i:<span class="type">Int</span>) =&gt; i * <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>å‡½æ•°ä½“å†…æœ‰ä¸€ä¸ªå˜é‡ iï¼Œå®ƒä½œä¸ºå‡½æ•°çš„ä¸€ä¸ªå‚æ•°ã€‚å¦‚ä¸‹é¢çš„å¦ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> multiplier = (i:<span class="type">Int</span>) =&gt; i * factor</span><br></pre></td></tr></table></figure>
<p>åœ¨ multiplier ä¸­æœ‰ä¸¤ä¸ªå˜é‡ï¼ši å’Œ factorã€‚å…¶ä¸­çš„ä¸€ä¸ª i æ˜¯å‡½æ•°çš„å½¢å¼å‚æ•°ï¼Œåœ¨ multiplier å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œi è¢«èµ‹äºˆä¸€ä¸ªæ–°çš„å€¼ã€‚ç„¶è€Œï¼Œfactor ä¸æ˜¯å½¢å¼å‚æ•°ï¼Œè€Œæ˜¯è‡ªç”±å˜é‡ï¼Œè€ƒè™‘ä¸‹é¢ä»£ç ï¼š</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> factor = <span class="number">3</span></span><br><span class="line"><span class="keyword">val</span> multiplier = (i:<span class="type">Int</span>) =&gt; i * factor</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªè‡ªç”±å˜é‡ factorï¼Œè¿™ä¸ªå˜é‡å®šä¹‰åœ¨å‡½æ•°å¤–é¢ã€‚</p>
<p>è¿™æ ·å®šä¹‰çš„å‡½æ•°å˜é‡ multiplier æˆä¸ºä¸€ä¸ª&quot;é—­åŒ…&quot;ï¼Œå› ä¸ºå®ƒå¼•ç”¨åˆ°å‡½æ•°å¤–é¢å®šä¹‰çš„å˜é‡ï¼Œå®šä¹‰è¿™ä¸ªå‡½æ•°çš„è¿‡ç¨‹æ˜¯å°†è¿™ä¸ªè‡ªç”±å˜é‡æ•è·è€Œæ„æˆä¸€ä¸ªå°é—­çš„å‡½æ•°ã€‚</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ClosureDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    println(<span class="string">"muliplier(1) value = "</span> + multiplier(<span class="number">1</span>))</span><br><span class="line">    println(<span class="string">"muliplier(2) value = "</span> + multiplier(<span class="number">2</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> factor = <span class="number">3</span></span><br><span class="line">  <span class="keyword">val</span> multiplier = (i: <span class="type">Int</span>) =&gt; i * factor</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-é›†åˆ"><a class="markdownIt-Anchor" href="#10-é›†åˆ"></a> 10. é›†åˆ</h2>
<p>Scala é›†åˆæ”¯æŒ Listã€Setã€Mapã€å…ƒç¥–ã€Optionã€‚</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æ•´å‹ List</span></span><br><span class="line"><span class="keyword">val</span> x = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ Set</span></span><br><span class="line"><span class="keyword">val</span> x = <span class="type">Set</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ Map</span></span><br><span class="line"><span class="keyword">val</span> x = <span class="type">Map</span>(<span class="string">"one"</span> -&gt; <span class="number">1</span>, <span class="string">"two"</span> -&gt; <span class="number">2</span>, <span class="string">"three"</span> -&gt; <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸¤ä¸ªä¸åŒç±»å‹å…ƒç´ çš„å…ƒç»„</span></span><br><span class="line"><span class="keyword">val</span> x = (<span class="number">10</span>, <span class="string">"Runoob"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ Option</span></span><br><span class="line"><span class="keyword">val</span> x:<span class="type">Option</span>[<span class="type">Int</span>] = <span class="type">Some</span>(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h3 id="101-è¿­ä»£å™¨"><a class="markdownIt-Anchor" href="#101-è¿­ä»£å™¨"></a> 10.1. è¿­ä»£å™¨</h3>
<p>è¿­ä»£å™¨ it çš„ä¸¤ä¸ªåŸºæœ¬æ“ä½œæ˜¯ <strong>next</strong> å’Œ <strong>hasNext</strong>ã€‚</p>
<p>è°ƒç”¨ <strong>it.next()</strong> ä¼šè¿”å›è¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”æ›´æ–°è¿­ä»£å™¨çš„çŠ¶æ€ã€‚</p>
<p>è°ƒç”¨ <strong>it.hasNext()</strong> ç”¨äºæ£€æµ‹é›†åˆä¸­æ˜¯å¦è¿˜æœ‰å…ƒç´ ã€‚</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">      <span class="keyword">val</span> it = <span class="type">Iterator</span>(<span class="string">"Baidu"</span>, <span class="string">"Google"</span>, <span class="string">"Runoob"</span>, <span class="string">"Taobao"</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span> (it.hasNext)&#123;</span><br><span class="line">         println(it.next())</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="11-ç±»å’Œå¯¹è±¡"><a class="markdownIt-Anchor" href="#11-ç±»å’Œå¯¹è±¡"></a> 11. ç±»å’Œå¯¹è±¡</h2>
<p>ç±»æ˜¯å¯¹è±¡çš„æŠ½è±¡ï¼Œè€Œå¯¹è±¡æ˜¯ç±»çš„å…·ä½“å®ä¾‹ã€‚ç±»æ˜¯æŠ½è±¡çš„ï¼Œä¸å ç”¨å†…å­˜ï¼Œè€Œå¯¹è±¡æ˜¯å…·ä½“çš„ï¼Œå ç”¨å­˜å‚¨ç©ºé—´ã€‚ç±»æ˜¯ç”¨äºåˆ›å»ºå¯¹è±¡çš„è“å›¾ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®šä¹‰åŒ…æ‹¬åœ¨ç‰¹å®šç±»å‹çš„å¯¹è±¡ä¸­çš„æ–¹æ³•å’Œå˜é‡çš„è½¯ä»¶æ¨¡æ¿ã€‚</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>(<span class="params">val xc: <span class="type">Int</span>, val yc: <span class="type">Int</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x: <span class="type">Int</span> = xc</span><br><span class="line">  <span class="keyword">var</span> y: <span class="type">Int</span> = yc</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">move</span></span>(dx: <span class="type">Int</span>, dy: <span class="type">Int</span>) &#123;</span><br><span class="line">    x = x + dx</span><br><span class="line">    y = y + dy</span><br><span class="line">    println(<span class="string">"x çš„åæ ‡ç‚¹ : "</span> + x);</span><br><span class="line">    println(<span class="string">"y çš„åæ ‡ç‚¹ : "</span> + y);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Location</span>(<span class="params">override val xc: <span class="type">Int</span>, override val yc: <span class="type">Int</span>, val zc: <span class="type">Int</span></span>)</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">Point</span>(<span class="params">xc, yc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> z: <span class="type">Int</span> = zc</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">move</span></span>(dx: <span class="type">Int</span>, dy: <span class="type">Int</span>, dz: <span class="type">Int</span>) &#123;</span><br><span class="line">    x = x + dx</span><br><span class="line">    y = y + dy</span><br><span class="line">    z = z + dz</span><br><span class="line">    println(<span class="string">"x çš„åæ ‡ç‚¹ : "</span> + x);</span><br><span class="line">    println(<span class="string">"y çš„åæ ‡ç‚¹ : "</span> + y);</span><br><span class="line">    println(<span class="string">"z çš„åæ ‡ç‚¹ : "</span> + z);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="keyword">val</span> loc = <span class="keyword">new</span> <span class="type">Location</span>(<span class="number">10</span>, <span class="number">20</span>, <span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§»åˆ°ä¸€ä¸ªæ–°çš„ä½ç½®</span></span><br><span class="line">    loc.move(<span class="number">10</span>, <span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="12-trait"><a class="markdownIt-Anchor" href="#12-trait"></a> 12. Trait</h2>
<p>Scala Trait(ç‰¹å¾) ç›¸å½“äº Java çš„æ¥å£ï¼Œå®é™…ä¸Šå®ƒæ¯”æ¥å£è¿˜åŠŸèƒ½å¼ºå¤§ã€‚</p>
<p>ä¸æ¥å£ä¸åŒçš„æ˜¯ï¼Œå®ƒè¿˜å¯ä»¥å®šä¹‰å±æ€§å’Œæ–¹æ³•çš„å®ç°ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ Scala çš„ç±»åªèƒ½å¤Ÿç»§æ‰¿å•ä¸€çˆ¶ç±»ï¼Œä½†æ˜¯å¦‚æœæ˜¯ Trait(ç‰¹å¾) çš„è¯å°±å¯ä»¥ç»§æ‰¿å¤šä¸ªï¼Œä»ç»“æœæ¥çœ‹å°±æ˜¯å®ç°äº†å¤šé‡ç»§æ‰¿ã€‚</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Equal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">isEqual</span></span>(x: <span class="type">Any</span>): <span class="type">Boolean</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">isNotEqual</span></span>(x: <span class="type">Any</span>): <span class="type">Boolean</span> = !isEqual(x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>(<span class="params">xc: <span class="type">Int</span>, yc: <span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Equal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x: <span class="type">Int</span> = xc</span><br><span class="line">  <span class="keyword">var</span> y: <span class="type">Int</span> = yc</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">isEqual</span></span>(obj: <span class="type">Any</span>) =</span><br><span class="line">    obj.isInstanceOf[<span class="type">Point</span>] &amp;&amp;</span><br><span class="line">      obj.asInstanceOf[<span class="type">Point</span>].x == x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="keyword">val</span> p1 = <span class="keyword">new</span> <span class="type">Point</span>(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">val</span> p2 = <span class="keyword">new</span> <span class="type">Point</span>(<span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">val</span> p3 = <span class="keyword">new</span> <span class="type">Point</span>(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    println(p1.isNotEqual(p2))</span><br><span class="line">    println(p1.isNotEqual(p3))</span><br><span class="line">    println(p1.isNotEqual(<span class="number">2</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="13-å¼‚å¸¸"><a class="markdownIt-Anchor" href="#13-å¼‚å¸¸"></a> 13. å¼‚å¸¸</h2>
<p>Scala æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•å’Œ Java ä¸€æ ·ï¼Œä½¿ç”¨ <code>throw</code> å…³é”®è¯ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æŠ›å‡ºå¼‚å¸¸</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span></span><br></pre></td></tr></table></figure>
<p>ã€ç¤ºä¾‹ã€‘æ•è·å¼‚å¸¸</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.&#123;<span class="type">FileNotFoundException</span>, <span class="type">FileReader</span>, <span class="type">IOException</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">val</span> f = <span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">"input.txt"</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> ex: <span class="type">FileNotFoundException</span> =&gt; &#123;</span><br><span class="line">        println(<span class="string">"Missing file exception"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">case</span> ex: <span class="type">IOException</span> =&gt; &#123;</span><br><span class="line">        println(<span class="string">"IO Exception"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      println(<span class="string">"Exiting finally..."</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="14-è¾“å…¥è¾“å‡º"><a class="markdownIt-Anchor" href="#14-è¾“å…¥è¾“å‡º"></a> 14. è¾“å…¥è¾“å‡º</h2>
<h3 id="141-è¯»å–ç”¨æˆ·è¾“å…¥"><a class="markdownIt-Anchor" href="#141-è¯»å–ç”¨æˆ·è¾“å…¥"></a> 14.1. è¯»å–ç”¨æˆ·è¾“å…¥</h3>
<p>ä½¿ç”¨ <code>scala.io.StdIn.readLine()</code> æ–¹æ³•è¯»å–ç”¨æˆ·è¾“å…¥</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">StdInDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    print(<span class="string">"è¯·è¾“å…¥å†…å®¹: "</span>)</span><br><span class="line">    <span class="keyword">val</span> line = <span class="type">StdIn</span>.readLine()</span><br><span class="line"></span><br><span class="line">    println(<span class="string">"ä½ è¾“å…¥çš„æ˜¯: "</span> + line)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="142-è¯»å–æ–‡ä»¶å†…å®¹"><a class="markdownIt-Anchor" href="#142-è¯»å–æ–‡ä»¶å†…å®¹"></a> 14.2. è¯»å–æ–‡ä»¶å†…å®¹</h3>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">SourceDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    println(<span class="string">"æ–‡ä»¶å†…å®¹ä¸º:"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="type">Source</span>.fromFile(<span class="string">"test.txt"</span>).foreach &#123;</span><br><span class="line">      print</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="15-åŒ…"><a class="markdownIt-Anchor" href="#15-åŒ…"></a> 15. åŒ…</h2>
<h3 id="151-å®šä¹‰åŒ…"><a class="markdownIt-Anchor" href="#151-å®šä¹‰åŒ…"></a> 15.1. å®šä¹‰åŒ…</h3>
<p>Scala ä½¿ç”¨ <code>package</code> å…³é”®å­—å®šä¹‰åŒ…ï¼Œåœ¨ Scala å°†ä»£ç å®šä¹‰åˆ°æŸä¸ªåŒ…ä¸­æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<p>ç¬¬ä¸€ç§æ–¹æ³•å’Œ Java ä¸€æ ·ï¼Œåœ¨æ–‡ä»¶çš„å¤´å®šä¹‰åŒ…åï¼Œè¿™ç§æ–¹æ³•å°±åç»­æ‰€æœ‰ä»£ç éƒ½æ”¾åœ¨è¯¥åŒ…ä¸­ã€‚ æ¯”å¦‚ï¼š</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.runoob</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span></span></span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æ–¹æ³•æœ‰äº›ç±»ä¼¼ C#ï¼Œå¦‚ï¼š</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.runoob &#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span></span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="152-å¼•ç”¨"><a class="markdownIt-Anchor" href="#152-å¼•ç”¨"></a> 15.2. å¼•ç”¨</h3>
<p>Scala ä½¿ç”¨ <code>import</code> å…³é”®å­—å¼•ç”¨åŒ…ã€‚</p>
<figure class="highlight flix"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.awt.Color  <span class="comment">// å¼•å…¥Color</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt._  <span class="comment">// å¼•å…¥åŒ…å†…æ‰€æœ‰æˆå‘˜</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span></span>(evt: event.ActionEvent) &#123; <span class="comment">// java.awt.event.ActionEvent</span></span><br><span class="line">  ...  <span class="comment">// å› ä¸ºå¼•å…¥äº†java.awtï¼Œæ‰€ä»¥å¯ä»¥çœå»å‰é¢çš„éƒ¨åˆ†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>import è¯­å¥å¯ä»¥å‡ºç°åœ¨ä»»ä½•åœ°æ–¹ï¼Œè€Œä¸æ˜¯åªèƒ½åœ¨æ–‡ä»¶é¡¶éƒ¨ã€‚import çš„æ•ˆæœä»å¼€å§‹å»¶ä¼¸åˆ°è¯­å¥å—çš„ç»“æŸã€‚è¿™å¯ä»¥å¤§å¹…å‡å°‘åç§°å†²çªçš„å¯èƒ½æ€§ã€‚</p>
<p>å¦‚æœæƒ³è¦å¼•å…¥åŒ…ä¸­çš„å‡ ä¸ªæˆå‘˜ï¼Œå¯ä»¥ä½¿ç”¨ selectorï¼ˆé€‰å–å™¨ï¼‰ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.awt.&#123;Color, Font&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡å‘½åæˆå‘˜</span></span><br><span class="line"><span class="keyword">import</span> java.util.&#123;<span class="function"><span class="params">HashMap</span> =&gt;</span> JavaHashMap&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éšè—æˆå‘˜</span></span><br><span class="line"><span class="keyword">import</span> java.util.&#123;<span class="function"><span class="params">HashMap</span> =&gt;</span> _, _&#125; <span class="comment">// å¼•å…¥äº†utilåŒ…çš„æ‰€æœ‰æˆå‘˜ï¼Œä½†æ˜¯HashMapè¢«éšè—äº†</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>**æ³¨æ„ï¼š**é»˜è®¤æƒ…å†µä¸‹ï¼ŒScala æ€»ä¼šå¼•å…¥ java.lang._ ã€ scala._ å’Œ Predef._ï¼Œè¿™é‡Œä¹Ÿèƒ½è§£é‡Šï¼Œä¸ºä»€ä¹ˆä»¥ scala å¼€å¤´çš„åŒ…ï¼Œåœ¨ä½¿ç”¨æ—¶éƒ½æ˜¯çœå» scala.çš„ã€‚</p>
</blockquote>
<h3 id="153-è®¿é—®ä¿®é¥°ç¬¦"><a class="markdownIt-Anchor" href="#153-è®¿é—®ä¿®é¥°ç¬¦"></a> 15.3. è®¿é—®ä¿®é¥°ç¬¦</h3>
<p>Scala è®¿é—®ä¿®é¥°ç¬¦åŸºæœ¬å’Œ Java çš„ä¸€æ ·ï¼Œåˆ†åˆ«æœ‰ï¼šprivateï¼Œprotectedï¼Œpublicã€‚</p>
<p>å¦‚æœæ²¡æœ‰æŒ‡å®šè®¿é—®ä¿®é¥°ç¬¦ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒScala å¯¹è±¡çš„è®¿é—®çº§åˆ«éƒ½æ˜¯ publicã€‚</p>
<p>Scala ä¸­çš„ private é™å®šç¬¦ï¼Œæ¯” Java æ›´ä¸¥æ ¼ï¼Œåœ¨åµŒå¥—ç±»æƒ…å†µä¸‹ï¼Œå¤–å±‚ç±»ç”šè‡³ä¸èƒ½è®¿é—®è¢«åµŒå¥—ç±»çš„ç§æœ‰æˆå‘˜ã€‚</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">f</span></span>() &#123;</span><br><span class="line">      println(<span class="string">"f"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">InnerMost</span> </span>&#123;</span><br><span class="line">      f() <span class="comment">// æ­£ç¡®</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  (<span class="keyword">new</span> <span class="type">Inner</span>).f() <span class="comment">//é”™è¯¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="16-å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#16-å‚è€ƒèµ„æ–™"></a> 16. å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://www.scala-lang.org/" target="_blank" rel="noopener">Scala å®˜ç½‘</a></li>
<li><a href="https://www.runoob.com/scala/scala-tutorial.html" target="_blank" rel="noopener">Scala èœé¸Ÿæ•™ç¨‹</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2020/12/28/shardingsphere-jdbc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/12/28/shardingsphere-jdbc/" class="post-title-link" itemprop="url">ShardingSphere Jdbc</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-12-28 00:01:28" itemprop="dateCreated datePublished" datetime="2020-12-28T00:01:28+08:00">2020-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“ä¸­é—´ä»¶</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/2020/12/28/shardingsphere-jdbc/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/12/28/shardingsphere-jdbc/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>3.9k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>4 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="shardingsphere-jdbc"><a class="markdownIt-Anchor" href="#shardingsphere-jdbc"></a> ShardingSphere Jdbc</h1>
<h2 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h2>
<p>shardingsphere-jdbc å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p>
<ul>
<li>é€‚ç”¨äºä»»ä½•åŸºäº JDBC çš„ ORM æ¡†æ¶ï¼Œå¦‚ï¼šJPA, Hibernate, Mybatis, Spring JDBC Template æˆ–ç›´æ¥ä½¿ç”¨ JDBCã€‚</li>
<li>æ”¯æŒä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, Druid, HikariCP ç­‰ã€‚</li>
<li>æ”¯æŒä»»æ„å®ç° JDBC è§„èŒƒçš„æ•°æ®åº“ï¼Œç›®å‰æ”¯æŒ MySQLï¼ŒOracleï¼ŒSQLServerï¼ŒPostgreSQL ä»¥åŠä»»ä½•éµå¾ª SQL92 æ ‡å‡†çš„æ•°æ®åº“ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20201008151213.png" alt="img" /></p>
<h2 id="å¿«é€Ÿå…¥é—¨"><a class="markdownIt-Anchor" href="#å¿«é€Ÿå…¥é—¨"></a> å¿«é€Ÿå…¥é—¨</h2>
<h3 id="å¼•å…¥-maven-ä¾èµ–"><a class="markdownIt-Anchor" href="#å¼•å…¥-maven-ä¾èµ–"></a> å¼•å…¥ maven ä¾èµ–</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;latest.release.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šè¯·å°† <code>${latest.release.version}</code> æ›´æ”¹ä¸ºå®é™…çš„ç‰ˆæœ¬å·ã€‚</p>
<h3 id="è§„åˆ™é…ç½®"><a class="markdownIt-Anchor" href="#è§„åˆ™é…ç½®"></a> è§„åˆ™é…ç½®</h3>
<p>ShardingSphere-JDBC å¯ä»¥é€šè¿‡ <code>Java</code>ï¼Œ<code>YAML</code>ï¼Œ<code>Spring å‘½åç©ºé—´</code>å’Œ <code>Spring Boot Starter</code> è¿™ 4 ç§æ–¹å¼è¿›è¡Œé…ç½®ï¼Œå¼€å‘è€…å¯æ ¹æ®åœºæ™¯é€‰æ‹©é€‚åˆçš„é…ç½®æ–¹å¼ã€‚ è¯¦æƒ…è¯·å‚è§<a href="https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/configuration/" target="_blank" rel="noopener">é…ç½®æ‰‹å†Œ</a>ã€‚</p>
<h3 id="åˆ›å»ºæ•°æ®æº"><a class="markdownIt-Anchor" href="#åˆ›å»ºæ•°æ®æº"></a> åˆ›å»ºæ•°æ®æº</h3>
<p>é€šè¿‡ <code>ShardingSphereDataSourceFactory</code> å·¥å‚å’Œè§„åˆ™é…ç½®å¯¹è±¡è·å– <code>ShardingSphereDataSource</code>ã€‚ è¯¥å¯¹è±¡å®ç°è‡ª JDBC çš„æ ‡å‡† DataSource æ¥å£ï¼Œå¯ç”¨äºåŸç”Ÿ JDBC å¼€å‘ï¼Œæˆ–ä½¿ç”¨ JPA, MyBatis ç­‰ ORM ç±»åº“ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DataSource dataSource = ShardingSphereDataSourceFactory.createDataSource(dataSourceMap, configurations, properties);</span><br></pre></td></tr></table></figure>
<h2 id="æ¦‚å¿µå’ŒåŠŸèƒ½"><a class="markdownIt-Anchor" href="#æ¦‚å¿µå’ŒåŠŸèƒ½"></a> æ¦‚å¿µå’ŒåŠŸèƒ½</h2>
<p>å•ä¸€æ•°æ®èŠ‚ç‚¹éš¾äºæ»¡è¶³äº’è”ç½‘çš„æµ·é‡æ•°æ®åœºæ™¯ã€‚</p>
<p>ä»æ€§èƒ½æ–¹é¢æ¥è¯´ï¼Œç”±äºå…³ç³»å‹æ•°æ®åº“å¤§å¤šé‡‡ç”¨ B+ æ ‘ç±»å‹çš„ç´¢å¼•ï¼Œåœ¨æ•°æ®é‡è¶…è¿‡é˜ˆå€¼çš„æƒ…å†µä¸‹ï¼Œç´¢å¼•æ·±åº¦çš„å¢åŠ ä¹Ÿå°†ä½¿å¾—ç£ç›˜è®¿é—®çš„ IO æ¬¡æ•°å¢åŠ ï¼Œè¿›è€Œå¯¼è‡´æŸ¥è¯¢æ€§èƒ½çš„ä¸‹é™ï¼›åŒæ—¶ï¼Œé«˜å¹¶å‘è®¿é—®è¯·æ±‚ä¹Ÿä½¿å¾—é›†ä¸­å¼æ•°æ®åº“æˆä¸ºç³»ç»Ÿçš„æœ€å¤§ç“¶é¢ˆã€‚</p>
<p>åœ¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“æ— æ³•æ»¡è¶³äº’è”ç½‘åœºæ™¯éœ€è¦çš„æƒ…å†µä¸‹ï¼Œå°†æ•°æ®å­˜å‚¨è‡³åŸç”Ÿæ”¯æŒåˆ†å¸ƒå¼çš„ NoSQL çš„å°è¯•è¶Šæ¥è¶Šå¤šã€‚ ä½† NoSQL å¯¹ SQL çš„ä¸å…¼å®¹æ€§ä»¥åŠç”Ÿæ€åœˆçš„ä¸å®Œå–„ï¼Œä½¿å¾—å®ƒä»¬åœ¨ä¸å…³ç³»å‹æ•°æ®åº“çš„åšå¼ˆä¸­å§‹ç»ˆæ— æ³•å®Œæˆè‡´å‘½ä¸€å‡»ï¼Œè€Œå…³ç³»å‹æ•°æ®åº“çš„åœ°ä½å´ä¾ç„¶ä¸å¯æ’¼åŠ¨ã€‚</p>
<p><strong>æ•°æ®åˆ†ç‰‡</strong>æŒ‡<strong>æŒ‰ç…§æŸä¸ªç»´åº¦</strong>å°†å­˜æ”¾åœ¨å•ä¸€æ•°æ®åº“ä¸­çš„<strong>æ•°æ®åˆ†æ•£åœ°å­˜æ”¾è‡³å¤šä¸ªæ•°æ®åº“æˆ–è¡¨ä¸­</strong>ä»¥è¾¾åˆ°æå‡æ€§èƒ½ç“¶é¢ˆä»¥åŠå¯ç”¨æ€§çš„æ•ˆæœã€‚æ•°æ®åˆ†ç‰‡çš„æœ‰æ•ˆæ‰‹æ®µæ˜¯å¯¹å…³ç³»å‹æ•°æ®åº“è¿›è¡Œåˆ†åº“å’Œåˆ†è¡¨ã€‚åˆ†åº“å’Œåˆ†è¡¨å‡å¯ä»¥æœ‰æ•ˆçš„é¿å…ç”±æ•°æ®é‡è¶…è¿‡å¯æ‰¿å—é˜ˆå€¼è€Œäº§ç”Ÿçš„æŸ¥è¯¢ç“¶é¢ˆã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œåˆ†åº“è¿˜èƒ½å¤Ÿç”¨äºæœ‰æ•ˆçš„åˆ†æ•£å¯¹æ•°æ®åº“å•ç‚¹çš„è®¿é—®é‡ï¼›åˆ†è¡¨è™½ç„¶æ— æ³•ç¼“è§£æ•°æ®åº“å‹åŠ›ï¼Œä½†å´èƒ½å¤Ÿæä¾›å°½é‡å°†åˆ†å¸ƒå¼äº‹åŠ¡è½¬åŒ–ä¸ºæœ¬åœ°äº‹åŠ¡çš„å¯èƒ½ï¼Œä¸€æ—¦æ¶‰åŠåˆ°è·¨åº“çš„æ›´æ–°æ“ä½œï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å¾€å¾€ä¼šä½¿é—®é¢˜å˜å¾—å¤æ‚ã€‚ ä½¿ç”¨å¤šä¸»å¤šä»çš„åˆ†ç‰‡æ–¹å¼ï¼Œå¯ä»¥æœ‰æ•ˆçš„é¿å…æ•°æ®å•ç‚¹ï¼Œä»è€Œæå‡æ•°æ®æ¶æ„çš„å¯ç”¨æ€§ã€‚</p>
<p>é€šè¿‡åˆ†åº“å’Œåˆ†è¡¨è¿›è¡Œæ•°æ®çš„æ‹†åˆ†æ¥ä½¿å¾—å„ä¸ªè¡¨çš„æ•°æ®é‡ä¿æŒåœ¨é˜ˆå€¼ä»¥ä¸‹ï¼Œä»¥åŠå¯¹æµé‡è¿›è¡Œç–å¯¼åº”å¯¹é«˜è®¿é—®é‡ï¼Œæ˜¯åº”å¯¹é«˜å¹¶å‘å’Œæµ·é‡æ•°æ®ç³»ç»Ÿçš„æœ‰æ•ˆæ‰‹æ®µã€‚ æ•°æ®åˆ†ç‰‡çš„æ‹†åˆ†æ–¹å¼åˆåˆ†ä¸ºå‚ç›´åˆ†ç‰‡å’Œæ°´å¹³åˆ†ç‰‡ã€‚</p>
<h3 id="å‚ç›´åˆ†ç‰‡"><a class="markdownIt-Anchor" href="#å‚ç›´åˆ†ç‰‡"></a> å‚ç›´åˆ†ç‰‡</h3>
<p>æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†çš„æ–¹å¼ç§°ä¸ºå‚ç›´åˆ†ç‰‡ï¼Œåˆç§°ä¸ºçºµå‘æ‹†åˆ†ï¼Œå®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ä¸“åº“ä¸“ç”¨ã€‚ åœ¨æ‹†åˆ†ä¹‹å‰ï¼Œä¸€ä¸ªæ•°æ®åº“ç”±å¤šä¸ªæ•°æ®è¡¨æ„æˆï¼Œæ¯ä¸ªè¡¨å¯¹åº”ç€ä¸åŒçš„ä¸šåŠ¡ã€‚è€Œæ‹†åˆ†ä¹‹åï¼Œåˆ™æ˜¯æŒ‰ç…§ä¸šåŠ¡å°†è¡¨è¿›è¡Œå½’ç±»ï¼Œåˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œä»è€Œå°†å‹åŠ›åˆ†æ•£è‡³ä¸åŒçš„æ•°æ®åº“ã€‚ ä¸‹å›¾å±•ç¤ºäº†æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå°†ç”¨æˆ·è¡¨å’Œè®¢å•è¡¨å‚ç›´åˆ†ç‰‡åˆ°ä¸åŒçš„æ•°æ®åº“çš„æ–¹æ¡ˆã€‚</p>
<p><a href="https://shardingsphere.apache.org/document/current/img/sharding/vertical_sharding.png" target="_blank" rel="noopener"><img src="https://shardingsphere.apache.org/document/current/img/sharding/vertical_sharding.png" alt="å‚ç›´åˆ†ç‰‡" /></a></p>
<p>å‚ç›´åˆ†ç‰‡å¾€å¾€éœ€è¦å¯¹æ¶æ„å’Œè®¾è®¡è¿›è¡Œè°ƒæ•´ã€‚é€šå¸¸æ¥è®²ï¼Œæ˜¯æ¥ä¸åŠåº”å¯¹äº’è”ç½‘ä¸šåŠ¡éœ€æ±‚å¿«é€Ÿå˜åŒ–çš„ï¼›è€Œä¸”ï¼Œå®ƒä¹Ÿå¹¶æ— æ³•çœŸæ­£çš„è§£å†³å•ç‚¹ç“¶é¢ˆã€‚ å‚ç›´æ‹†åˆ†å¯ä»¥ç¼“è§£æ•°æ®é‡å’Œè®¿é—®é‡å¸¦æ¥çš„é—®é¢˜ï¼Œä½†æ— æ³•æ ¹æ²»ã€‚å¦‚æœå‚ç›´æ‹†åˆ†ä¹‹åï¼Œè¡¨ä¸­çš„æ•°æ®é‡ä¾ç„¶è¶…è¿‡å•èŠ‚ç‚¹æ‰€èƒ½æ‰¿è½½çš„é˜ˆå€¼ï¼Œåˆ™éœ€è¦æ°´å¹³åˆ†ç‰‡æ¥è¿›ä¸€æ­¥å¤„ç†ã€‚</p>
<h3 id="æ°´å¹³åˆ†ç‰‡"><a class="markdownIt-Anchor" href="#æ°´å¹³åˆ†ç‰‡"></a> æ°´å¹³åˆ†ç‰‡</h3>
<p>æ°´å¹³åˆ†ç‰‡åˆç§°ä¸ºæ¨ªå‘æ‹†åˆ†ã€‚ ç›¸å¯¹äºå‚ç›´åˆ†ç‰‡ï¼Œå®ƒä¸å†å°†æ•°æ®æ ¹æ®ä¸šåŠ¡é€»è¾‘åˆ†ç±»ï¼Œè€Œæ˜¯é€šè¿‡æŸä¸ªå­—æ®µï¼ˆæˆ–æŸå‡ ä¸ªå­—æ®µï¼‰ï¼Œæ ¹æ®æŸç§è§„åˆ™å°†æ•°æ®åˆ†æ•£è‡³å¤šä¸ªåº“æˆ–è¡¨ä¸­ï¼Œæ¯ä¸ªåˆ†ç‰‡ä»…åŒ…å«æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚ ä¾‹å¦‚ï¼šæ ¹æ®ä¸»é”®åˆ†ç‰‡ï¼Œå¶æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 0 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œå¥‡æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 1 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><a href="https://shardingsphere.apache.org/document/current/img/sharding/horizontal_sharding.png" target="_blank" rel="noopener"><img src="https://shardingsphere.apache.org/document/current/img/sharding/horizontal_sharding.png" alt="æ°´å¹³åˆ†ç‰‡" /></a></p>
<p>æ°´å¹³åˆ†ç‰‡ä»ç†è®ºä¸Šçªç ´äº†å•æœºæ•°æ®é‡å¤„ç†çš„ç“¶é¢ˆï¼Œå¹¶ä¸”æ‰©å±•ç›¸å¯¹è‡ªç”±ï¼Œæ˜¯åˆ†åº“åˆ†è¡¨çš„æ ‡å‡†è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="æ•°æ®åˆ†ç‰‡å¸¦æ¥çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#æ•°æ®åˆ†ç‰‡å¸¦æ¥çš„é—®é¢˜"></a> æ•°æ®åˆ†ç‰‡å¸¦æ¥çš„é—®é¢˜</h3>
<ul>
<li><strong>æ•°æ®è·¯ç”±</strong>ï¼šéœ€è¦çŸ¥é“æ•°æ®éœ€è¦ä»å“ªä¸ªå…·ä½“çš„æ•°æ®åº“çš„åˆ†è¡¨ä¸­è·å–ã€‚</li>
<li><strong>SQL ä¸å…¼å®¹</strong>ï¼šåˆ†è¡¨å¯¼è‡´è¡¨åç§°çš„ä¿®æ”¹ï¼Œæˆ–è€…åˆ†é¡µã€æ’åºã€èšåˆã€åˆ†ç»„ç­‰æ“ä½œçš„ä¸æ­£ç¡®å¤„ç†ã€‚</li>
<li><strong>è·¨åº“äº‹åŠ¡</strong>ï¼šåˆç†é‡‡ç”¨åˆ†è¡¨ï¼Œå¯ä»¥åœ¨é™ä½å•è¡¨æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä½¿ç”¨æœ¬åœ°äº‹åŠ¡ï¼Œå–„äºä½¿ç”¨åŒåº“ä¸åŒè¡¨å¯æœ‰æ•ˆé¿å…åˆ†å¸ƒå¼äº‹åŠ¡å¸¦æ¥çš„éº»çƒ¦ã€‚ åœ¨ä¸èƒ½é¿å…è·¨åº“äº‹åŠ¡çš„åœºæ™¯ï¼Œæœ‰äº›ä¸šåŠ¡ä»ç„¶éœ€è¦ä¿æŒäº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚ è€ŒåŸºäº XA çš„åˆ†å¸ƒå¼äº‹åŠ¡ç”±äºåœ¨å¹¶å‘åº¦é«˜çš„åœºæ™¯ä¸­æ€§èƒ½æ— æ³•æ»¡è¶³éœ€è¦ï¼Œå¹¶æœªè¢«äº’è”ç½‘å·¨å¤´å¤§è§„æ¨¡ä½¿ç”¨ï¼Œä»–ä»¬å¤§å¤šé‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§çš„æŸ”æ€§äº‹åŠ¡ä»£æ›¿å¼ºä¸€è‡´äº‹åŠ¡ã€‚</li>
</ul>
<h2 id="shardingsphere-å†…æ ¸å‰–æ"><a class="markdownIt-Anchor" href="#shardingsphere-å†…æ ¸å‰–æ"></a> ShardingSphere å†…æ ¸å‰–æ</h2>
<p>ShardingSphere çš„ 3 ä¸ªäº§å“çš„æ•°æ®åˆ†ç‰‡ä¸»è¦æµç¨‹æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ æ ¸å¿ƒç”± <code>SQL è§£æ =&gt; æ‰§è¡Œå™¨ä¼˜åŒ– =&gt; SQL è·¯ç”± =&gt; SQL æ”¹å†™ =&gt; SQL æ‰§è¡Œ =&gt; ç»“æœå½’å¹¶</code>çš„æµç¨‹ç»„æˆã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20201008153551.png" alt="img" /></p>
<ul>
<li>QL è§£æï¼šåˆ†ä¸ºè¯æ³•è§£æå’Œè¯­æ³•è§£æã€‚ å…ˆé€šè¿‡è¯æ³•è§£æå™¨å°† SQL æ‹†åˆ†ä¸ºä¸€ä¸ªä¸ªä¸å¯å†åˆ†çš„å•è¯ã€‚å†ä½¿ç”¨è¯­æ³•è§£æå™¨å¯¹ SQL è¿›è¡Œç†è§£ï¼Œå¹¶æœ€ç»ˆæç‚¼å‡ºè§£æä¸Šä¸‹æ–‡ã€‚ è§£æä¸Šä¸‹æ–‡åŒ…æ‹¬è¡¨ã€é€‰æ‹©é¡¹ã€æ’åºé¡¹ã€åˆ†ç»„é¡¹ã€èšåˆå‡½æ•°ã€åˆ†é¡µä¿¡æ¯ã€æŸ¥è¯¢æ¡ä»¶ä»¥åŠå¯èƒ½éœ€è¦ä¿®æ”¹çš„å ä½ç¬¦çš„æ ‡è®°ã€‚</li>
<li>æ‰§è¡Œå™¨ä¼˜åŒ–ï¼šåˆå¹¶å’Œä¼˜åŒ–åˆ†ç‰‡æ¡ä»¶ï¼Œå¦‚ OR ç­‰ã€‚</li>
<li>SQL è·¯ç”±ï¼šæ ¹æ®è§£æä¸Šä¸‹æ–‡åŒ¹é…ç”¨æˆ·é…ç½®çš„åˆ†ç‰‡ç­–ç•¥ï¼Œå¹¶ç”Ÿæˆè·¯ç”±è·¯å¾„ã€‚ç›®å‰æ”¯æŒåˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ã€‚</li>
<li>SQL æ”¹å†™ï¼šå°† SQL æ”¹å†™ä¸ºåœ¨çœŸå®æ•°æ®åº“ä¸­å¯ä»¥æ­£ç¡®æ‰§è¡Œçš„è¯­å¥ã€‚SQL æ”¹å†™åˆ†ä¸ºæ­£ç¡®æ€§æ”¹å†™å’Œä¼˜åŒ–æ”¹å†™ã€‚</li>
<li>SQL æ‰§è¡Œï¼šé€šè¿‡å¤šçº¿ç¨‹æ‰§è¡Œå™¨å¼‚æ­¥æ‰§è¡Œã€‚</li>
<li>ç»“æœå½’å¹¶ï¼šå°†å¤šä¸ªæ‰§è¡Œç»“æœé›†å½’å¹¶ä»¥ä¾¿äºé€šè¿‡ç»Ÿä¸€çš„ JDBC æ¥å£è¾“å‡ºã€‚ç»“æœå½’å¹¶åŒ…æ‹¬æµå¼å½’å¹¶ã€å†…å­˜å½’å¹¶å’Œä½¿ç”¨è£…é¥°æ¨¡å¼çš„è¿½åŠ å½’å¹¶è¿™å‡ ç§æ–¹å¼ã€‚</li>
</ul>
<h3 id="è§£æå¼•æ“"><a class="markdownIt-Anchor" href="#è§£æå¼•æ“"></a> è§£æå¼•æ“</h3>
<h4 id="æŠ½è±¡è¯­æ³•æ ‘"><a class="markdownIt-Anchor" href="#æŠ½è±¡è¯­æ³•æ ‘"></a> æŠ½è±¡è¯­æ³•æ ‘</h4>
<p>è§£æè¿‡ç¨‹åˆ†ä¸º<strong>è¯æ³•è§£æ</strong>å’Œ<strong>è¯­æ³•è§£æ</strong>ã€‚ è¯æ³•è§£æå™¨ç”¨äºå°† SQL æ‹†è§£ä¸ºä¸å¯å†åˆ†çš„åŸå­ç¬¦å·ï¼Œç§°ä¸º Tokenã€‚å¹¶æ ¹æ®ä¸åŒæ•°æ®åº“æ–¹è¨€æ‰€æä¾›çš„å­—å…¸ï¼Œå°†å…¶å½’ç±»ä¸ºå…³é”®å­—ï¼Œè¡¨è¾¾å¼ï¼Œå­—é¢é‡å’Œæ“ä½œç¬¦ã€‚ å†ä½¿ç”¨è¯­æ³•è§£æå™¨å°† SQL è½¬æ¢ä¸ºæŠ½è±¡è¯­æ³•æ ‘ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ SQLï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">name</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">status</span> = <span class="string">'ACTIVE'</span> <span class="keyword">AND</span> age &gt; <span class="number">18</span></span><br></pre></td></tr></table></figure>
<p>è§£æä¹‹åçš„ä¸ºæŠ½è±¡è¯­æ³•æ ‘è§ä¸‹å›¾ã€‚</p>
<p><a href="https://shardingsphere.apache.org/document/current/img/sharding/sql_ast.png" target="_blank" rel="noopener"><img src="https://shardingsphere.apache.org/document/current/img/sharding/sql_ast.png" alt="SQLæŠ½è±¡è¯­æ³•æ ‘" /></a></p>
<p>ä¸ºäº†ä¾¿äºç†è§£ï¼ŒæŠ½è±¡è¯­æ³•æ ‘ä¸­çš„å…³é”®å­—çš„ Token ç”¨ç»¿è‰²è¡¨ç¤ºï¼Œå˜é‡çš„ Token ç”¨çº¢è‰²è¡¨ç¤ºï¼Œç°è‰²è¡¨ç¤ºéœ€è¦è¿›ä¸€æ­¥æ‹†åˆ†ã€‚</p>
<p>æœ€åï¼Œé€šè¿‡å¯¹æŠ½è±¡è¯­æ³•æ ‘çš„éå†å»æç‚¼åˆ†ç‰‡æ‰€éœ€çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶æ ‡è®°æœ‰å¯èƒ½éœ€è¦æ”¹å†™çš„ä½ç½®ã€‚ ä¾›åˆ†ç‰‡ä½¿ç”¨çš„è§£æä¸Šä¸‹æ–‡åŒ…å«æŸ¥è¯¢é€‰æ‹©é¡¹ï¼ˆSelect Itemsï¼‰ã€è¡¨ä¿¡æ¯ï¼ˆTableï¼‰ã€åˆ†ç‰‡æ¡ä»¶ï¼ˆSharding Conditionï¼‰ã€è‡ªå¢ä¸»é”®ä¿¡æ¯ï¼ˆAuto increment Primary Keyï¼‰ã€æ’åºä¿¡æ¯ï¼ˆOrder Byï¼‰ã€åˆ†ç»„ä¿¡æ¯ï¼ˆGroup Byï¼‰ä»¥åŠåˆ†é¡µä¿¡æ¯ï¼ˆLimitã€Rownumã€Topï¼‰ã€‚ SQL çš„ä¸€æ¬¡è§£æè¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ï¼Œä¸€ä¸ªä¸ª Token æŒ‰ SQL åŸæœ¬çš„é¡ºåºä¾æ¬¡è¿›è¡Œè§£æï¼Œæ€§èƒ½å¾ˆé«˜ã€‚ è€ƒè™‘åˆ°å„ç§æ•°æ®åº“ SQL æ–¹è¨€çš„å¼‚åŒï¼Œåœ¨è§£ææ¨¡å—æä¾›äº†å„ç±»æ•°æ®åº“çš„ SQL æ–¹è¨€å­—å…¸ã€‚</p>
<h4 id="sql-è§£æå¼•æ“"><a class="markdownIt-Anchor" href="#sql-è§£æå¼•æ“"></a> SQL è§£æå¼•æ“</h4>
<p>SQL è§£æä½œä¸ºåˆ†åº“åˆ†è¡¨ç±»äº§å“çš„æ ¸å¿ƒï¼Œå…¶æ€§èƒ½å’Œå…¼å®¹æ€§æ˜¯æœ€é‡è¦çš„è¡¡é‡æŒ‡æ ‡ã€‚ ShardingSphere çš„ SQL è§£æå™¨ç»å†äº† 3 ä»£äº§å“çš„æ›´æ–°è¿­ä»£ã€‚</p>
<p>ç¬¬ä¸€ä»£ SQL è§£æå™¨ä¸ºäº†è¿½æ±‚æ€§èƒ½ä¸å¿«é€Ÿå®ç°ï¼Œåœ¨ 1.4.x ä¹‹å‰çš„ç‰ˆæœ¬ä½¿ç”¨ Druid ä½œä¸º SQL è§£æå™¨ã€‚ç»å®é™…æµ‹è¯•ï¼Œå®ƒçš„æ€§èƒ½è¿œè¶…å…¶å®ƒè§£æå™¨ã€‚</p>
<p>ç¬¬äºŒä»£ SQL è§£æå™¨ä» 1.5.x ç‰ˆæœ¬å¼€å§‹ï¼ŒShardingSphere é‡‡ç”¨å®Œå…¨è‡ªç ”çš„ SQL è§£æå¼•æ“ã€‚ ç”±äºç›®çš„ä¸åŒï¼ŒShardingSphere å¹¶ä¸éœ€è¦å°† SQL è½¬ä¸ºä¸€é¢—å®Œå…¨çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œä¹Ÿæ— éœ€é€šè¿‡è®¿é—®å™¨æ¨¡å¼è¿›è¡ŒäºŒæ¬¡éå†ã€‚å®ƒé‡‡ç”¨å¯¹ SQL <code>åŠç†è§£</code>çš„æ–¹å¼ï¼Œä»…æç‚¼æ•°æ®åˆ†ç‰‡éœ€è¦å…³æ³¨çš„ä¸Šä¸‹æ–‡ï¼Œå› æ­¤ SQL è§£æçš„æ€§èƒ½å’Œå…¼å®¹æ€§å¾—åˆ°äº†è¿›ä¸€æ­¥çš„æé«˜ã€‚</p>
<p>ç¬¬ä¸‰ä»£ SQL è§£æå™¨åˆ™ä» 3.0.x ç‰ˆæœ¬å¼€å§‹ï¼ŒShardingSphere å°è¯•ä½¿ç”¨ ANTLR ä½œä¸º SQL è§£æçš„å¼•æ“ï¼Œå¹¶è®¡åˆ’æ ¹æ® <code>DDL -&gt; TCL -&gt; DAL â€“&gt; DCL -&gt; DML â€“&gt;DQL</code> è¿™ä¸ªé¡ºåºï¼Œä¾æ¬¡æ›¿æ¢åŸæœ‰çš„è§£æå¼•æ“ï¼Œç›®å‰ä»å¤„äºæ›¿æ¢è¿­ä»£ä¸­ã€‚ ä½¿ç”¨ ANTLR çš„åŸå› æ˜¯å¸Œæœ› ShardingSphere çš„è§£æå¼•æ“èƒ½å¤Ÿæ›´å¥½çš„å¯¹ SQL è¿›è¡Œå…¼å®¹ã€‚å¯¹äºå¤æ‚çš„è¡¨è¾¾å¼ã€é€’å½’ã€å­æŸ¥è¯¢ç­‰è¯­å¥ï¼Œè™½ç„¶ ShardingSphere çš„åˆ†ç‰‡æ ¸å¿ƒå¹¶ä¸å…³æ³¨ï¼Œä½†æ˜¯ä¼šå½±å“å¯¹äº SQL ç†è§£çš„å‹å¥½åº¦ã€‚ ç»è¿‡å®ä¾‹æµ‹è¯•ï¼ŒANTLR è§£æ SQL çš„æ€§èƒ½æ¯”è‡ªç ”çš„ SQL è§£æå¼•æ“æ…¢ 3-10 å€å·¦å³ã€‚ä¸ºäº†å¼¥è¡¥è¿™ä¸€å·®è·ï¼ŒShardingSphere å°†ä½¿ç”¨ <code>PreparedStatement</code> çš„ SQL è§£æçš„è¯­æ³•æ ‘æ”¾å…¥ç¼“å­˜ã€‚ å› æ­¤å»ºè®®é‡‡ç”¨ <code>PreparedStatement</code> è¿™ç§ SQL é¢„ç¼–è¯‘çš„æ–¹å¼æå‡æ€§èƒ½ã€‚</p>
<p>ç¬¬ä¸‰ä»£ SQL è§£æå¼•æ“çš„æ•´ä½“ç»“æ„åˆ’åˆ†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><a href="https://shardingsphere.apache.org/document/current/img/sharding/parsing_architecture_cn.png" target="_blank" rel="noopener"><img src="https://shardingsphere.apache.org/document/current/img/sharding/parsing_architecture_cn.png" alt="è§£æå¼•æ“ç»“æ„" /></a></p>
<h3 id="è·¯ç”±å¼•æ“"><a class="markdownIt-Anchor" href="#è·¯ç”±å¼•æ“"></a> è·¯ç”±å¼•æ“</h3>
<h3 id="æ”¹å†™å¼•æ“"><a class="markdownIt-Anchor" href="#æ”¹å†™å¼•æ“"></a> æ”¹å†™å¼•æ“</h3>
<h3 id="æ‰§è¡Œå¼•æ“"><a class="markdownIt-Anchor" href="#æ‰§è¡Œå¼•æ“"></a> æ‰§è¡Œå¼•æ“</h3>
<h3 id="å½’å¹¶å¼•æ“"><a class="markdownIt-Anchor" href="#å½’å¹¶å¼•æ“"></a> å½’å¹¶å¼•æ“</h3>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2020/10/10/%E6%89%A9%E5%B1%95-sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/10/10/%E6%89%A9%E5%B1%95-sql/" class="post-title-link" itemprop="url">æ‰©å±• SQL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-10-10 19:03:05" itemprop="dateCreated datePublished" datetime="2020-10-10T19:03:05+08:00">2020-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">å…³ç³»å‹æ•°æ®åº“</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/2020/10/10/%E6%89%A9%E5%B1%95-sql/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/10/10/æ‰©å±•-sql/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>593</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="æ‰©å±•-sql"><a class="markdownIt-Anchor" href="#æ‰©å±•-sql"></a> æ‰©å±• SQL</h1>
<blockquote>
<p>ä¸åŒäº <a href="02.SqlCheatSheet.md">SQL Cheat Sheet</a> ä¸­çš„ä¸€èˆ¬è¯­æ³•ï¼Œæœ¬æ–‡ä¸»è¦æ•´ç†æ”¶é›†ä¸€äº›é«˜çº§ä½†æ˜¯å¾ˆæœ‰ç”¨çš„ SQL</p>
</blockquote>
<h2 id="æ•°æ®åº“"><a class="markdownIt-Anchor" href="#æ•°æ®åº“"></a> æ•°æ®åº“</h2>
<h2 id="è¡¨"><a class="markdownIt-Anchor" href="#è¡¨"></a> è¡¨</h2>
<h3 id="æŸ¥çœ‹è¡¨çš„åŸºæœ¬ä¿¡æ¯"><a class="markdownIt-Anchor" href="#æŸ¥çœ‹è¡¨çš„åŸºæœ¬ä¿¡æ¯"></a> æŸ¥çœ‹è¡¨çš„åŸºæœ¬ä¿¡æ¯</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> information_schema.tables</span><br><span class="line"><span class="keyword">WHERE</span> table_schema = <span class="string">'test'</span> <span class="keyword">AND</span> table_name = <span class="string">'user'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹è¡¨çš„åˆ—ä¿¡æ¯"><a class="markdownIt-Anchor" href="#æŸ¥çœ‹è¡¨çš„åˆ—ä¿¡æ¯"></a> æŸ¥çœ‹è¡¨çš„åˆ—ä¿¡æ¯</h3>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> information_schema.columns</span><br><span class="line"><span class="keyword">WHERE</span> table_schema = <span class="string">'test'</span> <span class="keyword">AND</span> table_name = <span class="string">'user'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="å¦‚ä½•æ‰¹é‡åˆ é™¤å¤§é‡æ•°æ®"><a class="markdownIt-Anchor" href="#å¦‚ä½•æ‰¹é‡åˆ é™¤å¤§é‡æ•°æ®"></a> å¦‚ä½•æ‰¹é‡åˆ é™¤å¤§é‡æ•°æ®</h3>
<p>å¦‚æœè¦æ ¹æ®æ—¶é—´èŒƒå›´æ‰¹é‡åˆ é™¤å¤§é‡æ•°æ®ï¼Œæœ€ç®€å•çš„è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> orders</span><br><span class="line"><span class="keyword">where</span> <span class="built_in">timestamp</span> &lt; <span class="keyword">SUBDATE</span>(<span class="keyword">CURDATE</span>(),<span class="built_in">INTERVAL</span> <span class="number">3</span> <span class="keyword">month</span>);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„è¯­å¥ï¼Œå¤§æ¦‚ç‡æ‰§è¡Œä¼šæŠ¥é”™ï¼Œæç¤ºåˆ é™¤å¤±è´¥ï¼Œå› ä¸ºéœ€è¦åˆ é™¤çš„æ•°æ®é‡å¤ªå¤§äº†ï¼Œæ‰€ä»¥éœ€è¦åˆ†æ‰¹åˆ é™¤ã€‚</p>
<p>å¯ä»¥å…ˆé€šè¿‡ä¸€æ¬¡æŸ¥è¯¢ï¼Œæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å†å²è®¢å•ä¸­æœ€å¤§çš„é‚£ä¸ªè®¢å• IDï¼Œç„¶ååœ¨åˆ é™¤è¯­å¥ä¸­æŠŠåˆ é™¤çš„æ¡ä»¶è½¬æ¢æˆæŒ‰ä¸»é”®åˆ é™¤ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">id</span>) <span class="keyword">from</span> orders</span><br><span class="line"><span class="keyword">where</span> <span class="built_in">timestamp</span> &lt; <span class="keyword">SUBDATE</span>(<span class="keyword">CURDATE</span>(),<span class="built_in">INTERVAL</span> <span class="number">3</span> <span class="keyword">month</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ†æ‰¹åˆ é™¤ï¼Œ? å¡«ä¸Šä¸€æ¡è¯­å¥æŸ¥åˆ°çš„æœ€å¤§ ID</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> orders</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">id</span> &lt;= ?</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">limit</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://item.jd.com/11232698.html" target="_blank" rel="noopener">ã€ŠSQL å¿…çŸ¥å¿…ä¼šã€‹</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2020/10/08/shardingsphere-%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/10/08/shardingsphere-%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">ShardingSphere ç®€ä»‹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-10-08 20:30:30" itemprop="dateCreated datePublished" datetime="2020-10-08T20:30:30+08:00">2020-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“ä¸­é—´ä»¶</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/2020/10/08/shardingsphere-%E7%AE%80%E4%BB%8B/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/10/08/shardingsphere-ç®€ä»‹/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>1.5k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="shardingsphere-ç®€ä»‹"><a class="markdownIt-Anchor" href="#shardingsphere-ç®€ä»‹"></a> ShardingSphere ç®€ä»‹</h1>
<h2 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h2>
<h3 id="shardingsphere-ç»„ä»¶"><a class="markdownIt-Anchor" href="#shardingsphere-ç»„ä»¶"></a> ShardingSphere ç»„ä»¶</h3>
<p>ShardingSphere æ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æ•°æ®åº“ä¸­é—´ä»¶è§£å†³æ–¹æ¡ˆç»„æˆçš„ç”Ÿæ€åœˆï¼Œå®ƒç”± Sharding-JDBCã€Sharding-Proxy å’Œ Sharding-Sidecarï¼ˆè®¡åˆ’ä¸­ï¼‰è¿™ 3 æ¬¾ç›¸äº’ç‹¬ç«‹çš„äº§å“ç»„æˆã€‚ ä»–ä»¬å‡æä¾›æ ‡å‡†åŒ–çš„æ•°æ®åˆ†ç‰‡ã€åˆ†å¸ƒå¼äº‹åŠ¡å’Œæ•°æ®åº“æ²»ç†åŠŸèƒ½ï¼Œå¯é€‚ç”¨äºå¦‚ Java åŒæ„ã€å¼‚æ„è¯­è¨€ã€äº‘åŸç”Ÿç­‰å„ç§å¤šæ ·åŒ–çš„åº”ç”¨åœºæ™¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20201008151613.png" alt="img" /></p>
<h4 id="shardingsphere-jdbc"><a class="markdownIt-Anchor" href="#shardingsphere-jdbc"></a> ShardingSphere-JDBC</h4>
<p>å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p>
<ul>
<li>é€‚ç”¨äºä»»ä½•åŸºäº JDBC çš„ ORM æ¡†æ¶ï¼Œå¦‚ï¼šJPA, Hibernate, Mybatis, Spring JDBC Template æˆ–ç›´æ¥ä½¿ç”¨ JDBCã€‚</li>
<li>æ”¯æŒä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, Druid, HikariCP ç­‰ã€‚</li>
<li>æ”¯æŒä»»æ„å®ç° JDBC è§„èŒƒçš„æ•°æ®åº“ï¼Œç›®å‰æ”¯æŒ MySQLï¼ŒOracleï¼ŒSQLServerï¼ŒPostgreSQL ä»¥åŠä»»ä½•éµå¾ª SQL92 æ ‡å‡†çš„æ•°æ®åº“ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20201008151213.png" alt="img" /></p>
<h4 id="sharding-proxy"><a class="markdownIt-Anchor" href="#sharding-proxy"></a> Sharding-Proxy</h4>
<p>å®šä½ä¸ºé€æ˜åŒ–çš„æ•°æ®åº“ä»£ç†ç«¯ï¼Œæä¾›å°è£…äº†æ•°æ®åº“äºŒè¿›åˆ¶åè®®çš„æœåŠ¡ç«¯ç‰ˆæœ¬ï¼Œç”¨äºå®Œæˆå¯¹å¼‚æ„è¯­è¨€çš„æ”¯æŒã€‚ ç›®å‰æä¾› MySQL å’Œ PostgreSQL ç‰ˆæœ¬ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ä»»ä½•å…¼å®¹ MySQL/PostgreSQL åè®®çš„è®¿é—®å®¢æˆ·ç«¯(å¦‚ï¼šMySQL Command Client, MySQL Workbench, Navicat ç­‰)æ“ä½œæ•°æ®ï¼Œå¯¹ DBA æ›´åŠ å‹å¥½ã€‚</p>
<ul>
<li>å‘åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ï¼Œå¯ç›´æ¥å½“åš MySQL/PostgreSQL ä½¿ç”¨ã€‚</li>
<li>é€‚ç”¨äºä»»ä½•å…¼å®¹ MySQL/PostgreSQL åè®®çš„çš„å®¢æˆ·ç«¯ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20201008151434.png" alt="img" /></p>
<h4 id="sharding-sidecartodo"><a class="markdownIt-Anchor" href="#sharding-sidecartodo"></a> Sharding-Sidecarï¼ˆTODOï¼‰</h4>
<p>å®šä½ä¸º Kubernetes çš„äº‘åŸç”Ÿæ•°æ®åº“ä»£ç†ï¼Œä»¥ Sidecar çš„å½¢å¼ä»£ç†æ‰€æœ‰å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚ é€šè¿‡æ— ä¸­å¿ƒã€é›¶ä¾µå…¥çš„æ–¹æ¡ˆæä¾›ä¸æ•°æ®åº“äº¤äº’çš„çš„å•®åˆå±‚ï¼Œå³ <code>Database Mesh</code>ï¼Œåˆå¯ç§°æ•°æ®åº“ç½‘æ ¼ã€‚</p>
<p>Database Mesh çš„å…³æ³¨é‡ç‚¹åœ¨äºå¦‚ä½•å°†åˆ†å¸ƒå¼çš„æ•°æ®è®¿é—®åº”ç”¨ä¸æ•°æ®åº“æœ‰æœºä¸²è”èµ·æ¥ï¼Œå®ƒæ›´åŠ å…³æ³¨çš„æ˜¯äº¤äº’ï¼Œæ˜¯å°†æ‚ä¹±æ— ç« çš„åº”ç”¨ä¸æ•°æ®åº“ä¹‹é—´çš„äº¤äº’è¿›è¡Œæœ‰æ•ˆåœ°æ¢³ç†ã€‚ ä½¿ç”¨ Database Meshï¼Œè®¿é—®æ•°æ®åº“çš„åº”ç”¨å’Œæ•°æ®åº“ç»ˆå°†å½¢æˆä¸€ä¸ªå·¨å¤§çš„ç½‘æ ¼ä½“ç³»ï¼Œåº”ç”¨å’Œæ•°æ®åº“åªéœ€åœ¨ç½‘æ ¼ä½“ç³»ä¸­å¯¹å·å…¥åº§å³å¯ï¼Œå®ƒä»¬éƒ½æ˜¯è¢«å•®åˆå±‚æ‰€æ²»ç†çš„å¯¹è±¡ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20201008151557.png" alt="img" /></p>
<table>
<thead>
<tr>
<th style="text-align:left"><em>Sharding-JDBC</em></th>
<th style="text-align:left"><em>Sharding-Proxy</em></th>
<th style="text-align:left"><em>Sharding-Sidecar</em></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">æ•°æ®åº“</td>
<td style="text-align:left">ä»»æ„</td>
<td style="text-align:left">MySQL</td>
<td>MySQL</td>
</tr>
<tr>
<td style="text-align:left">è¿æ¥æ¶ˆè€—æ•°</td>
<td style="text-align:left">é«˜</td>
<td style="text-align:left">ä½</td>
<td>é«˜</td>
</tr>
<tr>
<td style="text-align:left">å¼‚æ„è¯­è¨€</td>
<td style="text-align:left">ä»… Java</td>
<td style="text-align:left">ä»»æ„</td>
<td>ä»»æ„</td>
</tr>
<tr>
<td style="text-align:left">æ€§èƒ½</td>
<td style="text-align:left">æŸè€—ä½</td>
<td style="text-align:left">æŸè€—ç•¥é«˜</td>
<td>æŸè€—ä½</td>
</tr>
<tr>
<td style="text-align:left">æ— ä¸­å¿ƒåŒ–</td>
<td style="text-align:left">æ˜¯</td>
<td style="text-align:left">å¦</td>
<td>æ˜¯</td>
</tr>
<tr>
<td style="text-align:left">é™æ€å…¥å£</td>
<td style="text-align:left">æ— </td>
<td style="text-align:left">æœ‰</td>
<td>æ— </td>
</tr>
</tbody>
</table>
<h4 id="æ··åˆæ¶æ„"><a class="markdownIt-Anchor" href="#æ··åˆæ¶æ„"></a> æ··åˆæ¶æ„</h4>
<p>ShardingSphere-JDBC é‡‡ç”¨æ— ä¸­å¿ƒåŒ–æ¶æ„ï¼Œé€‚ç”¨äº Java å¼€å‘çš„é«˜æ€§èƒ½çš„è½»é‡çº§ OLTP åº”ç”¨ï¼›ShardingSphere-Proxy æä¾›é™æ€å…¥å£ä»¥åŠå¼‚æ„è¯­è¨€çš„æ”¯æŒï¼Œé€‚ç”¨äº OLAP åº”ç”¨ä»¥åŠå¯¹åˆ†ç‰‡æ•°æ®åº“è¿›è¡Œç®¡ç†å’Œè¿ç»´çš„åœºæ™¯ã€‚</p>
<p>Apache ShardingSphere æ˜¯å¤šæ¥å…¥ç«¯å…±åŒç»„æˆçš„ç”Ÿæ€åœˆã€‚ é€šè¿‡æ··åˆä½¿ç”¨ ShardingSphere-JDBC å’Œ ShardingSphere-Proxyï¼Œå¹¶é‡‡ç”¨åŒä¸€æ³¨å†Œä¸­å¿ƒç»Ÿä¸€é…ç½®åˆ†ç‰‡ç­–ç•¥ï¼Œèƒ½å¤Ÿçµæ´»çš„æ­å»ºé€‚ç”¨äºå„ç§åœºæ™¯çš„åº”ç”¨ç³»ç»Ÿï¼Œä½¿å¾—æ¶æ„å¸ˆæ›´åŠ è‡ªç”±åœ°è°ƒæ•´é€‚åˆä¸å½“å‰ä¸šåŠ¡çš„æœ€ä½³ç³»ç»Ÿæ¶æ„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20201008151658.png" alt="img" /></p>
<h3 id="åŠŸèƒ½åˆ—è¡¨"><a class="markdownIt-Anchor" href="#åŠŸèƒ½åˆ—è¡¨"></a> åŠŸèƒ½åˆ—è¡¨</h3>
<h4 id="æ•°æ®åˆ†ç‰‡"><a class="markdownIt-Anchor" href="#æ•°æ®åˆ†ç‰‡"></a> æ•°æ®åˆ†ç‰‡</h4>
<ul>
<li>åˆ†åº“ &amp; åˆ†è¡¨</li>
<li>è¯»å†™åˆ†ç¦»</li>
<li>åˆ†ç‰‡ç­–ç•¥å®šåˆ¶åŒ–</li>
<li>æ— ä¸­å¿ƒåŒ–åˆ†å¸ƒå¼ä¸»é”®</li>
</ul>
<h4 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a class="markdownIt-Anchor" href="#åˆ†å¸ƒå¼äº‹åŠ¡"></a> åˆ†å¸ƒå¼äº‹åŠ¡</h4>
<ul>
<li>æ ‡å‡†åŒ–äº‹åŠ¡æ¥å£</li>
<li>XA å¼ºä¸€è‡´äº‹åŠ¡</li>
<li>æŸ”æ€§äº‹åŠ¡</li>
</ul>
<h4 id="æ•°æ®åº“æ²»ç†"><a class="markdownIt-Anchor" href="#æ•°æ®åº“æ²»ç†"></a> æ•°æ®åº“æ²»ç†</h4>
<ul>
<li>åˆ†å¸ƒå¼æ²»ç†</li>
<li>å¼¹æ€§ä¼¸ç¼©</li>
<li>å¯è§†åŒ–é“¾è·¯è¿½è¸ª</li>
<li>æ•°æ®åŠ å¯†</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://github.com/apache/incubator-shardingsphere" target="_blank" rel="noopener">shardingsphere Github</a></li>
<li><a href="https://shardingsphere.apache.org/document/current/cn/overview/" target="_blank" rel="noopener">shardingsphere å®˜æ–¹æ–‡æ¡£</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2020/09/25/mongodb-%E7%9A%84-crud-%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/09/25/mongodb-%E7%9A%84-crud-%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">MongoDB çš„ CRUD æ“ä½œ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-09-25 21:23:41" itemprop="dateCreated datePublished" datetime="2020-09-25T21:23:41+08:00">2020-09-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">æ–‡æ¡£æ•°æ®åº“</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/" itemprop="url" rel="index">
                    <span itemprop="name">MongoDB</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/2020/09/25/mongodb-%E7%9A%84-crud-%E6%93%8D%E4%BD%9C/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/09/25/mongodb-çš„-crud-æ“ä½œ/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>5.1k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>5 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="mongodb-çš„-crud-æ“ä½œ"><a class="markdownIt-Anchor" href="#mongodb-çš„-crud-æ“ä½œ"></a> MongoDB çš„ CRUD æ“ä½œ</h1>
<h2 id="ä¸€-åŸºæœ¬-crud-æ“ä½œ"><a class="markdownIt-Anchor" href="#ä¸€-åŸºæœ¬-crud-æ“ä½œ"></a> ä¸€ã€åŸºæœ¬ CRUD æ“ä½œ</h2>
<p>MongoDB çš„ CRUD æ“ä½œæ˜¯é’ˆå¯¹ document çš„è¯»å†™æ“ä½œã€‚</p>
<h3 id="create-æ“ä½œ"><a class="markdownIt-Anchor" href="#create-æ“ä½œ"></a> Create æ“ä½œ</h3>
<p>MongoDB æä¾›ä»¥ä¸‹æ“ä½œå‘ä¸€ä¸ª collection æ’å…¥ document</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.insertOne/#db.collection.insertOne" target="_blank" rel="noopener"><code>db.collection.insertOne()</code></a>ï¼šæ’å…¥ä¸€æ¡ document</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.insertMany/#db.collection.insertMany" target="_blank" rel="noopener"><code>db.collection.insertMany()</code></a>ï¼šæ’å…¥å¤šæ¡ document</li>
</ul>
<blockquote>
<p>æ³¨ï¼šä»¥ä¸Šæ“ä½œéƒ½æ˜¯åŸå­æ“ä½œã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200924112342.svg" alt="img" /></p>
<p>æ’å…¥æ“ä½œçš„ç‰¹æ€§ï¼š</p>
<ul>
<li>MongoDB ä¸­çš„æ‰€æœ‰å†™æ“ä½œéƒ½æ˜¯å•ä¸ªæ–‡æ¡£çº§åˆ«çš„åŸå­æ“ä½œã€‚</li>
<li>å¦‚æœè¦æ’å…¥çš„ collection å½“å‰ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥æ“ä½œä¼šè‡ªåŠ¨åˆ›å»º collectionã€‚</li>
<li>åœ¨ MongoDB ä¸­ï¼Œå­˜å‚¨åœ¨é›†åˆä¸­çš„æ¯ä¸ªæ–‡æ¡£éƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„ <a href="https://docs.mongodb.com/manual/reference/glossary/#term-id" target="_blank" rel="noopener"><code>_id</code></a> å­—æ®µä½œä¸ºä¸»é”®ã€‚å¦‚æœæ’å…¥çš„æ–‡æ¡£çœç•¥ <code>_id</code> å­—æ®µï¼Œåˆ™ MongoDB é©±åŠ¨ç¨‹åºä¼šè‡ªåŠ¨ä¸º <code>_id</code> å­—æ®µç”Ÿæˆ ObjectIdã€‚</li>
<li>å¯ä»¥ MongoDB å†™å…¥æ“ä½œçš„ç¡®è®¤çº§åˆ«æ¥æ§åˆ¶å†™å…¥è¡Œä¸ºã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘æ’å…¥ä¸€æ¡ document ç¤ºä¾‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.inventory.insertOne(&#123;</span><br><span class="line">  item: <span class="string">'canvas'</span>,</span><br><span class="line">  qty: <span class="number">100</span>,</span><br><span class="line">  tags: [<span class="string">'cotton'</span>],</span><br><span class="line">  size: &#123; <span class="attr">h</span>: <span class="number">28</span>, <span class="attr">w</span>: <span class="number">35.5</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ã€ç¤ºä¾‹ã€‘æ’å…¥å¤šæ¡ document ç¤ºä¾‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.inventory.insertMany([</span><br><span class="line">  &#123;</span><br><span class="line">    item: <span class="string">'journal'</span>,</span><br><span class="line">    qty: <span class="number">25</span>,</span><br><span class="line">    tags: [<span class="string">'blank'</span>, <span class="string">'red'</span>],</span><br><span class="line">    size: &#123; <span class="attr">h</span>: <span class="number">14</span>, <span class="attr">w</span>: <span class="number">21</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    item: <span class="string">'mat'</span>,</span><br><span class="line">    qty: <span class="number">85</span>,</span><br><span class="line">    tags: [<span class="string">'gray'</span>],</span><br><span class="line">    size: &#123; <span class="attr">h</span>: <span class="number">27.9</span>, <span class="attr">w</span>: <span class="number">35.5</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    item: <span class="string">'mousepad'</span>,</span><br><span class="line">    qty: <span class="number">25</span>,</span><br><span class="line">    tags: [<span class="string">'gel'</span>, <span class="string">'blue'</span>],</span><br><span class="line">    size: &#123; <span class="attr">h</span>: <span class="number">19</span>, <span class="attr">w</span>: <span class="number">22.85</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h3 id="read-æ“ä½œ"><a class="markdownIt-Anchor" href="#read-æ“ä½œ"></a> Read æ“ä½œ</h3>
<p>MongoDB æä¾› <a href="https://docs.mongodb.com/manual/reference/method/db.collection.find/#db.collection.find" target="_blank" rel="noopener"><code>db.collection.find()</code></a> æ–¹æ³•æ¥æ£€ç´¢ documentã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200924113832.svg" alt="img" /></p>
<h3 id="update-æ“ä½œ"><a class="markdownIt-Anchor" href="#update-æ“ä½œ"></a> Update æ“ä½œ</h3>
<p>MongoDB æä¾›ä»¥ä¸‹æ“ä½œæ¥æ›´æ–° collection ä¸­çš„ document</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateOne/#db.collection.updateOne" target="_blank" rel="noopener"><code>db.collection.updateOne()</code></a>ï¼šæ›´æ–°ä¸€æ¡ document</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateMany/#db.collection.updateMany" target="_blank" rel="noopener"><code>db.collection.updateMany()</code></a>ï¼šæ›´æ–°å¤šæ¡ document</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.replaceOne/#db.collection.replaceOne" target="_blank" rel="noopener"><code>db.collection.replaceOne()</code></a>ï¼šæ›¿æ¢ä¸€æ¡ document</li>
</ul>
<p>è¯­æ³•æ ¼å¼ï¼š</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateOne/#db.collection.updateOne" target="_blank" rel="noopener"><code>db.collection.updateOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateMany/#db.collection.updateMany" target="_blank" rel="noopener"><code>db.collection.updateMany(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.replaceOne/#db.collection.replaceOne" target="_blank" rel="noopener"><code>db.collection.replaceOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></a></li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200924114043.svg" alt="img" /></p>
<p>ã€ç¤ºä¾‹ã€‘æ’å…¥æµ‹è¯•æ•°æ®</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.inventory.insertMany([</span><br><span class="line">  &#123;</span><br><span class="line">    item: <span class="string">'canvas'</span>,</span><br><span class="line">    qty: <span class="number">100</span>,</span><br><span class="line">    size: &#123; <span class="attr">h</span>: <span class="number">28</span>, <span class="attr">w</span>: <span class="number">35.5</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;,</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">item</span>: <span class="string">'journal'</span>, <span class="attr">qty</span>: <span class="number">25</span>, <span class="attr">size</span>: &#123; <span class="attr">h</span>: <span class="number">14</span>, <span class="attr">w</span>: <span class="number">21</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;, <span class="attr">status</span>: <span class="string">'A'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">item</span>: <span class="string">'mat'</span>, <span class="attr">qty</span>: <span class="number">85</span>, <span class="attr">size</span>: &#123; <span class="attr">h</span>: <span class="number">27.9</span>, <span class="attr">w</span>: <span class="number">35.5</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;, <span class="attr">status</span>: <span class="string">'A'</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    item: <span class="string">'mousepad'</span>,</span><br><span class="line">    qty: <span class="number">25</span>,</span><br><span class="line">    size: &#123; <span class="attr">h</span>: <span class="number">19</span>, <span class="attr">w</span>: <span class="number">22.85</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;,</span><br><span class="line">    status: <span class="string">'P'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    item: <span class="string">'notebook'</span>,</span><br><span class="line">    qty: <span class="number">50</span>,</span><br><span class="line">    size: &#123; <span class="attr">h</span>: <span class="number">8.5</span>, <span class="attr">w</span>: <span class="number">11</span>, <span class="attr">uom</span>: <span class="string">'in'</span> &#125;,</span><br><span class="line">    status: <span class="string">'P'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">item</span>: <span class="string">'paper'</span>, <span class="attr">qty</span>: <span class="number">100</span>, <span class="attr">size</span>: &#123; <span class="attr">h</span>: <span class="number">8.5</span>, <span class="attr">w</span>: <span class="number">11</span>, <span class="attr">uom</span>: <span class="string">'in'</span> &#125;, <span class="attr">status</span>: <span class="string">'D'</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    item: <span class="string">'planner'</span>,</span><br><span class="line">    qty: <span class="number">75</span>,</span><br><span class="line">    size: &#123; <span class="attr">h</span>: <span class="number">22.85</span>, <span class="attr">w</span>: <span class="number">30</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;,</span><br><span class="line">    status: <span class="string">'D'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    item: <span class="string">'postcard'</span>,</span><br><span class="line">    qty: <span class="number">45</span>,</span><br><span class="line">    size: &#123; <span class="attr">h</span>: <span class="number">10</span>, <span class="attr">w</span>: <span class="number">15.25</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;,</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    item: <span class="string">'sketchbook'</span>,</span><br><span class="line">    qty: <span class="number">80</span>,</span><br><span class="line">    size: &#123; <span class="attr">h</span>: <span class="number">14</span>, <span class="attr">w</span>: <span class="number">21</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;,</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    item: <span class="string">'sketch pad'</span>,</span><br><span class="line">    qty: <span class="number">95</span>,</span><br><span class="line">    size: &#123; <span class="attr">h</span>: <span class="number">22.85</span>, <span class="attr">w</span>: <span class="number">30.5</span>, <span class="attr">uom</span>: <span class="string">'cm'</span> &#125;,</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>ã€ç¤ºä¾‹ã€‘æ›´æ–°ä¸€æ¡ document</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.inventory.updateOne(</span><br><span class="line">  &#123; <span class="attr">item</span>: <span class="string">'paper'</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    $<span class="keyword">set</span>: &#123; <span class="string">'size.uom'</span>: <span class="string">'cm'</span>, <span class="attr">status</span>: <span class="string">'P'</span> &#125;,</span><br><span class="line">    $currentDate: &#123; <span class="attr">lastModified</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ã€ç¤ºä¾‹ã€‘æ›´æ–°å¤šæ¡ document</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.inventory.updateMany(</span><br><span class="line">  &#123; <span class="attr">qty</span>: &#123; <span class="attr">$lt</span>: <span class="number">50</span> &#125; &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    $<span class="keyword">set</span>: &#123; <span class="string">'size.uom'</span>: <span class="string">'in'</span>, <span class="attr">status</span>: <span class="string">'P'</span> &#125;,</span><br><span class="line">    $currentDate: &#123; <span class="attr">lastModified</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ã€ç¤ºä¾‹ã€‘æ›¿æ¢ä¸€æ¡ document</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.inventory.replaceOne(</span><br><span class="line">  &#123; <span class="attr">item</span>: <span class="string">'paper'</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    item: <span class="string">'paper'</span>,</span><br><span class="line">    instock: [</span><br><span class="line">      &#123; <span class="attr">warehouse</span>: <span class="string">'A'</span>, <span class="attr">qty</span>: <span class="number">60</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">warehouse</span>: <span class="string">'B'</span>, <span class="attr">qty</span>: <span class="number">40</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>æ›´æ–°æ“ä½œçš„ç‰¹æ€§ï¼š</p>
<ul>
<li>MongoDB ä¸­çš„æ‰€æœ‰å†™æ“ä½œéƒ½æ˜¯å•ä¸ªæ–‡æ¡£çº§åˆ«çš„åŸå­æ“ä½œã€‚</li>
<li>ä¸€æ—¦è®¾ç½®äº†ï¼Œå°±æ— æ³•æ›´æ–°æˆ–æ›¿æ¢ <a href="https://docs.mongodb.com/manual/reference/glossary/#term-id" target="_blank" rel="noopener"><code>_id</code></a> å­—æ®µã€‚</li>
<li>é™¤ä»¥ä¸‹æƒ…å†µå¤–ï¼ŒMongoDB ä¼šåœ¨æ‰§è¡Œå†™æ“ä½œåä¿ç•™æ–‡æ¡£å­—æ®µçš„é¡ºåºï¼š
<ul>
<li><code>_id</code> å­—æ®µå§‹ç»ˆæ˜¯æ–‡æ¡£ä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µã€‚</li>
<li>åŒ…æ‹¬é‡å‘½åå­—æ®µåç§°çš„æ›´æ–°å¯èƒ½å¯¼è‡´æ–‡æ¡£ä¸­å­—æ®µçš„é‡æ–°æ’åºã€‚</li>
</ul>
</li>
<li>å¦‚æœæ›´æ–°æ“ä½œä¸­åŒ…å« <code>upsert : true</code> å¹¶ä¸”æ²¡æœ‰ document åŒ¹é…è¿‡æ»¤å™¨ï¼ŒMongoDB ä¼šæ–°æ’å…¥ä¸€ä¸ª documentï¼›å¦‚æœæœ‰åŒ¹é…çš„ documentï¼ŒMongoDB ä¼šä¿®æ”¹æˆ–æ›¿æ¢è¿™äº› documentã€‚</li>
</ul>
<h3 id="delete-æ“ä½œ"><a class="markdownIt-Anchor" href="#delete-æ“ä½œ"></a> Delete æ“ä½œ</h3>
<p>MongoDB æä¾›ä»¥ä¸‹æ“ä½œæ¥åˆ é™¤ collection ä¸­çš„ document</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.deleteOne/#db.collection.deleteOne" target="_blank" rel="noopener"><code>db.collection.deleteOne()</code></a>ï¼šåˆ é™¤ä¸€æ¡ document</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.deleteMany/#db.collection.deleteMany" target="_blank" rel="noopener"><code>db.collection.deleteMany()</code></a>ï¼šåˆ é™¤å¤šæ¡ document</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200924120007.svg" alt="img" /></p>
<p>åˆ é™¤æ“ä½œçš„ç‰¹æ€§ï¼š</p>
<ul>
<li>MongoDB ä¸­çš„æ‰€æœ‰å†™æ“ä½œéƒ½æ˜¯å•ä¸ªæ–‡æ¡£çº§åˆ«çš„åŸå­æ“ä½œã€‚</li>
</ul>
<h2 id="äºŒ-æ‰¹é‡å†™æ“ä½œ"><a class="markdownIt-Anchor" href="#äºŒ-æ‰¹é‡å†™æ“ä½œ"></a> äºŒã€æ‰¹é‡å†™æ“ä½œ</h2>
<p>MongoDB é€šè¿‡ <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener"><code>db.collection.bulkWrite()</code></a> æ–¹æ³•æ¥æ”¯æŒæ‰¹é‡å†™æ“ä½œï¼ˆåŒ…æ‹¬æ‰¹é‡æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰ã€‚</p>
<p>æ­¤å¤–ï¼Œ<a href="https://docs.mongodb.com/manual/reference/method/db.collection.insertMany/#db.collection.insertMany" target="_blank" rel="noopener"><code>db.collection.insertMany()</code></a> æ–¹æ³•æ”¯æŒæ‰¹é‡æ’å…¥æ“ä½œã€‚</p>
<h3 id="æœ‰åºå’Œæ— åºçš„æ“ä½œ"><a class="markdownIt-Anchor" href="#æœ‰åºå’Œæ— åºçš„æ“ä½œ"></a> æœ‰åºå’Œæ— åºçš„æ“ä½œ</h3>
<p>æ‰¹é‡å†™æ“ä½œå¯ä»¥æœ‰åºæˆ–æ— åºã€‚</p>
<ul>
<li>å¯¹äºæœ‰åºåˆ—è¡¨ï¼ŒMongoDB ä¸²è¡Œæ‰§è¡Œæ“ä½œã€‚å¦‚æœåœ¨å†™æ“ä½œçš„å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼ŒMongoDB å°†ä¸å¤„ç†åˆ—è¡¨ä¸­å‰©ä½™çš„å†™æ“ä½œã€‚</li>
<li>å¯¹äºæ— åºåˆ—è¡¨ï¼ŒMongoDB å¯ä»¥å¹¶è¡Œæ‰§è¡Œæ“ä½œï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æ­¤è¡Œä¸ºã€‚å¦‚æœåœ¨å†™æ“ä½œçš„å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼ŒMongoDB å°†ç»§ç»­å¤„ç†åˆ—è¡¨ä¸­å‰©ä½™çš„å†™æ“ä½œã€‚</li>
</ul>
<p>åœ¨åˆ†ç‰‡é›†åˆä¸Šæ‰§è¡Œæ“ä½œçš„æœ‰åºåˆ—è¡¨é€šå¸¸æ¯”æ‰§è¡Œæ— åºåˆ—è¡¨è¦æ…¢ï¼Œå› ä¸ºå¯¹äºæœ‰åºåˆ—è¡¨ï¼Œæ¯ä¸ªæ“ä½œå¿…é¡»ç­‰å¾…ä¸Šä¸€ä¸ªæ“ä½œå®Œæˆã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener"><code>bulkWrite()</code></a> æ‰§è¡Œæœ‰åºæ“ä½œã€‚è¦æŒ‡å®šæ— åºå†™æ“ä½œï¼Œè¯·åœ¨é€‰é¡¹æ–‡æ¡£ä¸­è®¾ç½® <code>ordered : false</code>ã€‚</p>
<h3 id="bulkwrite-æ–¹æ³•"><a class="markdownIt-Anchor" href="#bulkwrite-æ–¹æ³•"></a> bulkWrite() æ–¹æ³•</h3>
<p><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener"><code>bulkWrite()</code></a> æ”¯æŒä»¥ä¸‹å†™æ“ä½œï¼š</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-insertone" target="_blank" rel="noopener">insertOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-updateonemany" target="_blank" rel="noopener">updateOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-updateonemany" target="_blank" rel="noopener">updateMany</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-replaceone" target="_blank" rel="noopener">replaceOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-deleteonemany" target="_blank" rel="noopener">deleteOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-deleteonemany" target="_blank" rel="noopener">deleteMany</a></li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘æ‰¹é‡å†™æ“ä½œç¤ºä¾‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  db.characters.bulkWrite([</span><br><span class="line">    &#123;</span><br><span class="line">      insertOne: &#123;</span><br><span class="line">        <span class="built_in">document</span>: &#123;</span><br><span class="line">          _id: <span class="number">4</span>,</span><br><span class="line">          char: <span class="string">'Dithras'</span>,</span><br><span class="line">          class: 'barbarian',</span><br><span class="line">          lvl: <span class="number">4</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      insertOne: &#123;</span><br><span class="line">        <span class="built_in">document</span>: &#123;</span><br><span class="line">          _id: <span class="number">5</span>,</span><br><span class="line">          char: <span class="string">'Taeln'</span>,</span><br><span class="line">          class: 'fighter',</span><br><span class="line">          lvl: <span class="number">3</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      updateOne: &#123;</span><br><span class="line">        filter: &#123; <span class="attr">char</span>: <span class="string">'Eldon'</span> &#125;,</span><br><span class="line">        update: &#123; <span class="attr">$set</span>: &#123; <span class="attr">status</span>: <span class="string">'Critical Injury'</span> &#125; &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">deleteOne</span>: &#123; <span class="attr">filter</span>: &#123; <span class="attr">char</span>: <span class="string">'Brisbane'</span> &#125; &#125; &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      replaceOne: &#123;</span><br><span class="line">        filter: &#123; <span class="attr">char</span>: <span class="string">'Meldane'</span> &#125;,</span><br><span class="line">        replacement: &#123; <span class="attr">char</span>: <span class="string">'Tanys'</span>, <span class="attr">class</span>: <span class="string">'oracle'</span>, <span class="attr">lvl</span>: <span class="number">4</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ])</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  print(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰¹é‡å†™æ“ä½œç­–ç•¥"><a class="markdownIt-Anchor" href="#æ‰¹é‡å†™æ“ä½œç­–ç•¥"></a> æ‰¹é‡å†™æ“ä½œç­–ç•¥</h3>
<p>å¤§é‡çš„æ’å…¥æ“ä½œï¼ˆåŒ…æ‹¬åˆå§‹æ•°æ®æ’å…¥æˆ–å¸¸è§„æ•°æ®å¯¼å…¥ï¼‰å¯èƒ½ä¼šå½±å“åˆ†ç‰‡é›†ç¾¤çš„æ€§èƒ½ã€‚å¯¹äºæ‰¹é‡æ’å…¥ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹ç­–ç•¥ï¼š</p>
<h4 id="é¢„æ‹†åˆ†-collection"><a class="markdownIt-Anchor" href="#é¢„æ‹†åˆ†-collection"></a> é¢„æ‹†åˆ† collection</h4>
<p>å¦‚æœåˆ†ç‰‡é›†åˆä¸ºç©ºï¼Œåˆ™è¯¥é›†åˆåªæœ‰ä¸€ä¸ªåˆå§‹ <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener">chunk</a>ï¼Œè¯¥ <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener">chunk</a> ä½äºå•ä¸ªåˆ†ç‰‡ä¸Šã€‚ç„¶åï¼ŒMongoDB å¿…é¡»èŠ±ä¸€äº›æ—¶é—´æ¥æ¥æ”¶æ•°æ®ï¼Œåˆ›å»ºæ‹†åˆ†å¹¶å°†æ‹†åˆ†çš„å—åˆ†å‘åˆ°å¯ç”¨çš„åˆ†ç‰‡ã€‚ä¸ºäº†é¿å…è¿™ç§æ€§èƒ½æˆæœ¬ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§æ‹†åˆ†ç¾¤é›†ä¸­çš„æ‹†åˆ†å—ä¸­çš„è¯´æ˜é¢„æ‹†åˆ† collectionã€‚</p>
<h4 id="æ— åºå†™æ“ä½œ"><a class="markdownIt-Anchor" href="#æ— åºå†™æ“ä½œ"></a> æ— åºå†™æ“ä½œ</h4>
<p>è¦æé«˜å¯¹åˆ†ç‰‡é›†ç¾¤çš„å†™å…¥æ€§èƒ½ï¼Œè¯·ä½¿ç”¨ <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener"><code>bulkWrite()</code></a>ï¼Œå¹¶å°†å¯é€‰å‚æ•°é¡ºåºè®¾ç½®ä¸º falseã€‚<a href="https://docs.mongodb.com/manual/reference/program/mongos/#bin.mongos" target="_blank" rel="noopener"><code>mongos</code></a> å¯ä»¥å°è¯•åŒæ—¶å°†å†™å…¥æ“ä½œå‘é€åˆ°å¤šä¸ªåˆ†ç‰‡ã€‚å¯¹äºç©ºé›†åˆï¼Œé¦–å…ˆæŒ‰ç…§åˆ†ç‰‡ç¾¤é›†ä¸­çš„åˆ†å‰² <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener">chunk</a> ä¸­çš„è¯´æ˜é¢„æ‹†åˆ† collectionã€‚</p>
<h4 id="é¿å…å•è°ƒèŠ‚æµ"><a class="markdownIt-Anchor" href="#é¿å…å•è°ƒèŠ‚æµ"></a> é¿å…å•è°ƒèŠ‚æµ</h4>
<p>å¦‚æœåœ¨ä¸€æ¬¡æ’å…¥æ“ä½œä¸­ï¼Œåˆ†ç‰‡ key å•è°ƒé€’å¢ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ’å…¥æ•°æ®éƒ½ä¼šå­˜å…¥ collection çš„æœ€åä¸€ä¸ª chunkï¼Œä¹Ÿå°±æ˜¯å­˜å…¥ä¸€ä¸ªåˆ†ç‰‡ä¸­ã€‚å› æ­¤ï¼Œé›†ç¾¤çš„æ’å…¥å®¹é‡å°†æ°¸è¿œä¸ä¼šè¶…è¿‡è¯¥å•ä¸ªåˆ†ç‰‡çš„æ’å…¥å®¹é‡ã€‚</p>
<p>å¦‚æœæ’å…¥é‡å¤§äºå•ä¸ªåˆ†ç‰‡å¯ä»¥å¤„ç†çš„æ’å…¥é‡ï¼Œå¹¶ä¸”æ— æ³•é¿å…å•è°ƒé€’å¢çš„åˆ†ç‰‡é”®ï¼Œé‚£ä¹ˆè¯·è€ƒè™‘å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œä»¥ä¸‹ä¿®æ”¹ï¼š</p>
<ul>
<li>åè½¬åˆ†ç‰‡å¯†é’¥çš„äºŒè¿›åˆ¶ä½ã€‚è¿™æ ·å¯ä»¥ä¿ç•™ä¿¡æ¯ï¼Œå¹¶é¿å…å°†æ’å…¥é¡ºåºä¸å€¼åºåˆ—çš„å¢åŠ å…³è”èµ·æ¥ã€‚</li>
<li>äº¤æ¢ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ª 16 ä½å­—ä»¥â€œéšæœºâ€æ’å…¥ã€‚</li>
</ul>
<h2 id="sql-å’Œ-mongodb-å¯¹æ¯”"><a class="markdownIt-Anchor" href="#sql-å’Œ-mongodb-å¯¹æ¯”"></a> SQL å’Œ MongoDB å¯¹æ¯”</h2>
<h3 id="æœ¯è¯­å’Œæ¦‚å¿µ"><a class="markdownIt-Anchor" href="#æœ¯è¯­å’Œæ¦‚å¿µ"></a> æœ¯è¯­å’Œæ¦‚å¿µ</h3>
<table>
<thead>
<tr>
<th style="text-align:left">SQL æœ¯è¯­å’Œæ¦‚å¿µ</th>
<th style="text-align:left">MongoDB æœ¯è¯­å’Œæ¦‚å¿µ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">database</td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/glossary/#term-database" target="_blank" rel="noopener">database</a></td>
</tr>
<tr>
<td style="text-align:left">table</td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/glossary/#term-collection" target="_blank" rel="noopener">collection</a></td>
</tr>
<tr>
<td style="text-align:left">row</td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/glossary/#term-document" target="_blank" rel="noopener">document</a> æˆ– <a href="https://docs.mongodb.com/manual/reference/glossary/#term-bson" target="_blank" rel="noopener">BSON</a></td>
</tr>
<tr>
<td style="text-align:left">column</td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/glossary/#term-field" target="_blank" rel="noopener">field</a></td>
</tr>
<tr>
<td style="text-align:left">index</td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/glossary/#term-index" target="_blank" rel="noopener">index</a></td>
</tr>
<tr>
<td style="text-align:left">table joins</td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank" rel="noopener"><code>$lookup</code></a>ã€åµŒå…¥å¼æ–‡æ¡£</td>
</tr>
<tr>
<td style="text-align:left">primary key</td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/glossary/#term-primary-key" target="_blank" rel="noopener">primary key</a><br>MongoDB ä¸­è‡ªåŠ¨è®¾ç½®ä¸»é”®ä¸º <a href="https://docs.mongodb.com/manual/reference/glossary/#term-id" target="_blank" rel="noopener"><code>_id</code></a> å­—æ®µ</td>
</tr>
<tr>
<td style="text-align:left">aggregation (e.g. group by)</td>
<td style="text-align:left">aggregation pipeline<br>å‚è€ƒ <a href="https://docs.mongodb.com/manual/reference/sql-aggregation-comparison/" target="_blank" rel="noopener">SQL to Aggregation Mapping Chart</a>.</td>
</tr>
<tr>
<td style="text-align:left">SELECT INTO NEW_TABLE</td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/out/#pipe._S_out" target="_blank" rel="noopener"><code>$out</code></a><br>å‚è€ƒ <a href="https://docs.mongodb.com/manual/reference/sql-aggregation-comparison/" target="_blank" rel="noopener">SQL to Aggregation Mapping Chart</a></td>
</tr>
<tr>
<td style="text-align:left">MERGE INTO TABLE</td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/merge/#pipe._S_merge" target="_blank" rel="noopener"><code>$merge</code></a> (MongoDB 4.2 å¼€å§‹æ”¯æŒ)<br>å‚è€ƒ <a href="https://docs.mongodb.com/manual/reference/sql-aggregation-comparison/" target="_blank" rel="noopener">SQL to Aggregation Mapping Chart</a>.</td>
</tr>
<tr>
<td style="text-align:left">UNION ALL</td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/unionWith/#pipe._S_unionWith" target="_blank" rel="noopener"><code>$unionWith</code></a> (MongoDB 4.4 å¼€å§‹æ”¯æŒ)</td>
</tr>
<tr>
<td style="text-align:left">transactions</td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/core/transactions/" target="_blank" rel="noopener">transactions</a></td>
</tr>
</tbody>
</table>
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2>
<ul>
<li><strong>å®˜æ–¹</strong>
<ul>
<li><a href="https://www.mongodb.com/" target="_blank" rel="noopener">MongoDB å®˜ç½‘</a></li>
<li><a href="https://github.com/mongodb/mongo" target="_blank" rel="noopener">MongoDB Github</a></li>
<li><a href="https://university.mongodb.com/" target="_blank" rel="noopener">MongoDB å®˜æ–¹å…è´¹æ•™ç¨‹</a></li>
</ul>
</li>
<li><strong>æ•™ç¨‹</strong>
<ul>
<li><a href="https://www.runoob.com/mongodb/mongodb-tutorial.html" target="_blank" rel="noopener">MongoDB æ•™ç¨‹</a></li>
<li><a href="https://time.geekbang.org/course/intro/100040001" target="_blank" rel="noopener">MongoDB é«˜æ‰‹è¯¾</a></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2020/09/21/mongodb-%E7%9A%84%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/09/21/mongodb-%E7%9A%84%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">MongoDB çš„èšåˆæ“ä½œ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-09-21 21:22:57" itemprop="dateCreated datePublished" datetime="2020-09-21T21:22:57+08:00">2020-09-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">æ–‡æ¡£æ•°æ®åº“</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/" itemprop="url" rel="index">
                    <span itemprop="name">MongoDB</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/2020/09/21/mongodb-%E7%9A%84%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/09/21/mongodb-çš„èšåˆæ“ä½œ/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>6.4k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>6 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="mongodb-çš„èšåˆæ“ä½œ"><a class="markdownIt-Anchor" href="#mongodb-çš„èšåˆæ“ä½œ"></a> MongoDB çš„èšåˆæ“ä½œ</h1>
<p>èšåˆæ“ä½œå¤„ç†æ•°æ®è®°å½•å¹¶è¿”å›è®¡ç®—ç»“æœã€‚èšåˆæ“ä½œå°†æ¥è‡ªå¤šä¸ª document çš„å€¼åˆ†ç»„ï¼Œå¹¶å¯ä»¥å¯¹åˆ†ç»„çš„æ•°æ®æ‰§è¡Œå„ç§æ“ä½œä»¥è¿”å›å•ä¸ªç»“æœã€‚ MongoDB æä¾›äº†ä¸‰ç§æ‰§è¡Œèšåˆçš„æ–¹å¼ï¼šèšåˆç®¡é“ï¼Œmap-reduce å‡½æ•°å’Œå•ä¸€ç›®çš„èšåˆæ–¹æ³•ã€‚</p>
<h2 id="pipeline"><a class="markdownIt-Anchor" href="#pipeline"></a> Pipeline</h2>
<h3 id="pipeline-ç®€ä»‹"><a class="markdownIt-Anchor" href="#pipeline-ç®€ä»‹"></a> Pipeline ç®€ä»‹</h3>
<p>MongoDB çš„èšåˆæ¡†æ¶ä»¥æ•°æ®å¤„ç†ç®¡é“ï¼ˆPipelineï¼‰çš„æ¦‚å¿µä¸ºæ¨¡å‹ã€‚</p>
<p><strong>MongoDB é€šè¿‡ <a href="https://docs.mongodb.com/manual/reference/method/db.collection.aggregate/#db.collection.aggregate" target="_blank" rel="noopener"><code>db.collection.aggregate()</code></a> æ–¹æ³•æ”¯æŒèšåˆæ“ä½œ</strong>ã€‚å¹¶æä¾›äº† <a href="https://docs.mongodb.com/manual/reference/command/aggregate/#dbcmd.aggregate" target="_blank" rel="noopener"><code>aggregate</code></a> å‘½ä»¤æ¥æ‰§è¡Œ pipelineã€‚</p>
<p>MongoDB Pipeline ç”±å¤šä¸ªé˜¶æ®µï¼ˆ<a href="https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/#aggregation-pipeline-operator-reference" target="_blank" rel="noopener">stages</a>ï¼‰ç»„æˆã€‚æ¯ä¸ªé˜¶æ®µåœ¨ document é€šè¿‡ pipeline æ—¶éƒ½ä¼šå¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚pipeline é˜¶æ®µä¸éœ€è¦ä¸ºæ¯ä¸ªè¾“å…¥ document éƒ½ç”Ÿæˆä¸€ä¸ªè¾“å‡º documentã€‚ä¾‹å¦‚ï¼ŒæŸäº›é˜¶æ®µå¯èƒ½ä¼šç”Ÿæˆæ–° document æˆ–è¿‡æ»¤ documentã€‚</p>
<p>åŒä¸€ä¸ªé˜¶æ®µå¯ä»¥åœ¨ pipeline ä¸­å‡ºç°å¤šæ¬¡ï¼Œä½† <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/out/#pipe._S_out" target="_blank" rel="noopener"><code>$out</code></a>ã€<a href="https://docs.mongodb.com/manual/reference/operator/aggregation/merge/#pipe._S_merge" target="_blank" rel="noopener"><code>$merge</code></a>,å’Œ <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/geoNear/#pipe._S_geoNear" target="_blank" rel="noopener"><code>$geoNear</code></a> é˜¶æ®µé™¤å¤–ã€‚æ‰€æœ‰å¯ç”¨ pipeline é˜¶æ®µå¯ä»¥å‚è€ƒï¼š<a href="https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/#aggregation-pipeline-operator-reference" target="_blank" rel="noopener">Aggregation Pipeline Stages</a>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200921092725.png" alt="img" /></p>
<ul>
<li>ç¬¬ä¸€é˜¶æ®µï¼š<a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener"><code>$match</code></a> é˜¶æ®µæŒ‰çŠ¶æ€å­—æ®µè¿‡æ»¤ documentï¼Œç„¶åå°†çŠ¶æ€ç­‰äºâ€œ Aâ€çš„é‚£äº› document ä¼ é€’åˆ°ä¸‹ä¸€é˜¶æ®µã€‚</li>
<li>ç¬¬äºŒé˜¶æ®µï¼š<a href="https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group" target="_blank" rel="noopener"><code>$group</code></a> é˜¶æ®µæŒ‰ cust_id å­—æ®µå¯¹ document è¿›è¡Œåˆ†ç»„ï¼Œä»¥è®¡ç®—æ¯ä¸ªå”¯ä¸€ cust_id çš„é‡‘é¢æ€»å’Œã€‚</li>
</ul>
<p>æœ€åŸºæœ¬çš„ç®¡é“é˜¶æ®µæä¾›è¿‡æ»¤å™¨ï¼Œå…¶æ“ä½œç±»ä¼¼äºæŸ¥è¯¢å’Œ document è½¬æ¢ï¼ˆä¿®æ”¹è¾“å‡º document å½¢å¼ï¼‰ã€‚</p>
<p>å…¶ä»–ç®¡é“æ“ä½œæä¾›äº†ç”¨äºæŒ‰ç‰¹å®šå­—æ®µå¯¹ document è¿›è¡Œåˆ†ç»„å’Œæ’åºçš„å·¥å…·ï¼Œä»¥åŠç”¨äºæ±‡æ€»æ•°ç»„ï¼ˆåŒ…æ‹¬ document æ•°ç»„ï¼‰å†…å®¹çš„å·¥å…·ã€‚å¦å¤–ï¼Œç®¡é“é˜¶æ®µå¯ä»¥å°†è¿ç®—ç¬¦ç”¨äºè¯¸å¦‚è®¡ç®—å¹³å‡å€¼æˆ–è¿æ¥å­—ç¬¦ä¸²ä¹‹ç±»çš„ä»»åŠ¡ã€‚</p>
<p>èšåˆç®¡é“ä¹Ÿå¯ä»¥åœ¨åˆ†ç‰‡ collection ä¸Šæ“ä½œã€‚</p>
<h3 id="pipeline-ä¼˜åŒ–"><a class="markdownIt-Anchor" href="#pipeline-ä¼˜åŒ–"></a> Pipeline ä¼˜åŒ–</h3>
<h4 id="æŠ•å½±ä¼˜åŒ–"><a class="markdownIt-Anchor" href="#æŠ•å½±ä¼˜åŒ–"></a> æŠ•å½±ä¼˜åŒ–</h4>
<p>Pipeline å¯ä»¥ç¡®å®šæ˜¯å¦ä»…éœ€è¦ document ä¸­å¿…å¡«å­—æ®µå³å¯è·å¾—ç»“æœã€‚</p>
<h4 id="pipeline-ä¸²è¡Œä¼˜åŒ–"><a class="markdownIt-Anchor" href="#pipeline-ä¸²è¡Œä¼˜åŒ–"></a> Pipeline ä¸²è¡Œä¼˜åŒ–</h4>
<p>ï¼ˆ<code>$project</code>ã€<code>$unset</code>ã€<code>$addFields</code>ã€<code>$set</code>ï¼‰ + <code>$match</code> ä¸²è¡Œä¼˜åŒ–</p>
<p>å¯¹äºåŒ…å«æŠ•å½±é˜¶æ®µï¼ˆ<a href="https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project" target="_blank" rel="noopener"><code>$project</code></a> æˆ– <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/unset/#pipe._S_unset" target="_blank" rel="noopener"><code>$unset</code></a> æˆ– <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/addFields/#pipe._S_addFields" target="_blank" rel="noopener"><code>$addFields</code></a> æˆ– <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/set/#pipe._S_set" target="_blank" rel="noopener"><code>$set</code></a>ï¼‰ï¼Œä¸”åç»­è·Ÿéšç€ <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener"><code>$match</code></a> é˜¶æ®µçš„ Pipeline ï¼ŒMongoDB ä¼šå°†æ‰€æœ‰ <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener"><code>$match</code></a> é˜¶æ®µä¸­ä¸éœ€è¦åœ¨æŠ•å½±é˜¶æ®µä¸­è®¡ç®—å‡ºçš„å€¼çš„è¿‡æ»¤å™¨ï¼Œç§»åŠ¨ä¸€ä¸ªåœ¨æŠ•å½±é˜¶æ®µä¹‹å‰çš„æ–° <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener"><code>$match</code></a> é˜¶æ®µã€‚</p>
<p>å¦‚æœ Pipeline åŒ…å«å¤šä¸ªæŠ•å½±é˜¶æ®µ å’Œ / æˆ– <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener"><code>$match</code></a> é˜¶æ®µï¼Œåˆ™ MongoDB å°†ä¸ºæ¯ä¸ª <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener"><code>$match</code></a> é˜¶æ®µæ‰§è¡Œæ­¤ä¼˜åŒ–ï¼Œå°†æ¯ä¸ª <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener"><code>$match</code></a> è¿‡æ»¤å™¨ç§»åŠ¨åˆ°è¯¥è¿‡æ»¤å™¨ä¸ä¾èµ–çš„æ‰€æœ‰æŠ•å½±é˜¶æ®µä¹‹å‰ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘Pipeline ä¸²è¡Œä¼˜åŒ–ç¤ºä¾‹</p>
<p>ä¼˜åŒ–å‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123; <span class="attr">$addFields</span>: &#123;</span><br><span class="line">    maxTime: &#123; <span class="attr">$max</span>: <span class="string">"$times"</span> &#125;,</span><br><span class="line">    minTime: &#123; <span class="attr">$min</span>: <span class="string">"$times"</span> &#125;</span><br><span class="line">&#125; &#125;,</span><br><span class="line">&#123; <span class="attr">$project</span>: &#123;</span><br><span class="line">    _id: <span class="number">1</span>, <span class="attr">name</span>: <span class="number">1</span>, <span class="attr">times</span>: <span class="number">1</span>, <span class="attr">maxTime</span>: <span class="number">1</span>, <span class="attr">minTime</span>: <span class="number">1</span>,</span><br><span class="line">    avgTime: &#123; <span class="attr">$avg</span>: [<span class="string">"$maxTime"</span>, <span class="string">"$minTime"</span>] &#125;</span><br><span class="line">&#125; &#125;,</span><br><span class="line">&#123; <span class="attr">$match</span>: &#123;</span><br><span class="line">    name: <span class="string">"Joe Schmoe"</span>,</span><br><span class="line">    maxTime: &#123; <span class="attr">$lt</span>: <span class="number">20</span> &#125;,</span><br><span class="line">    minTime: &#123; <span class="attr">$gt</span>: <span class="number">5</span> &#125;,</span><br><span class="line">    avgTime: &#123; <span class="attr">$gt</span>: <span class="number">7</span> &#125;</span><br><span class="line">&#125; &#125;</span><br></pre></td></tr></table></figure>
<p>ä¼˜åŒ–åï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123; <span class="attr">$match</span>: &#123; <span class="attr">name</span>: <span class="string">"Joe Schmoe"</span> &#125; &#125;,</span><br><span class="line">&#123; <span class="attr">$addFields</span>: &#123;</span><br><span class="line">    maxTime: &#123; <span class="attr">$max</span>: <span class="string">"$times"</span> &#125;,</span><br><span class="line">    minTime: &#123; <span class="attr">$min</span>: <span class="string">"$times"</span> &#125;</span><br><span class="line">&#125; &#125;,</span><br><span class="line">&#123; <span class="attr">$match</span>: &#123; <span class="attr">maxTime</span>: &#123; <span class="attr">$lt</span>: <span class="number">20</span> &#125;, <span class="attr">minTime</span>: &#123; <span class="attr">$gt</span>: <span class="number">5</span> &#125; &#125; &#125;,</span><br><span class="line">&#123; <span class="attr">$project</span>: &#123;</span><br><span class="line">    _id: <span class="number">1</span>, <span class="attr">name</span>: <span class="number">1</span>, <span class="attr">times</span>: <span class="number">1</span>, <span class="attr">maxTime</span>: <span class="number">1</span>, <span class="attr">minTime</span>: <span class="number">1</span>,</span><br><span class="line">    avgTime: &#123; <span class="attr">$avg</span>: [<span class="string">"$maxTime"</span>, <span class="string">"$minTime"</span>] &#125;</span><br><span class="line">&#125; &#125;,</span><br><span class="line">&#123; <span class="attr">$match</span>: &#123; <span class="attr">avgTime</span>: &#123; <span class="attr">$gt</span>: <span class="number">7</span> &#125; &#125; &#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<p><code>{ name: &quot;Joe Schmoe&quot; }</code> ä¸éœ€è¦è®¡ç®—ä»»ä½•æŠ•å½±é˜¶æ®µçš„å€¼ï¼Œæ‰€ä»¥å¯ä»¥æ”¾åœ¨æœ€å‰é¢ã€‚</p>
<p><code>{ avgTime: { $gt: 7 } }</code> ä¾èµ– <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project" target="_blank" rel="noopener"><code>$project</code></a> é˜¶æ®µçš„ <code>avgTime</code> å­—æ®µï¼Œæ‰€ä»¥ä¸èƒ½ç§»åŠ¨ã€‚</p>
<p><code>maxTime</code> å’Œ <code>minTime</code> å­—æ®µè¢« <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/addFields/#pipe._S_addFields" target="_blank" rel="noopener"><code>$addFields</code></a> é˜¶æ®µæ‰€ä¾èµ–ï¼Œä½†è‡ªèº«ä¸ä¾èµ–å…¶ä»–ï¼Œæ‰€ä»¥ä¼šæ–°å»ºä¸€ä¸ª <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener"><code>$match</code></a> é˜¶æ®µï¼Œå¹¶å°†å…¶ç½®äº <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project" target="_blank" rel="noopener"><code>$project</code></a> é˜¶æ®µä¹‹å‰ã€‚</p>
<h4 id="pipeline-å¹¶è¡Œä¼˜åŒ–"><a class="markdownIt-Anchor" href="#pipeline-å¹¶è¡Œä¼˜åŒ–"></a> Pipeline å¹¶è¡Œä¼˜åŒ–</h4>
<p>å¦‚æœå¯èƒ½ï¼Œä¼˜åŒ–é˜¶æ®µä¼šå°† Pipeline é˜¶æ®µåˆå¹¶åˆ°å…¶å‰èº«ã€‚é€šå¸¸ï¼Œåˆå¹¶å‘ç”Ÿåœ¨ä»»æ„åºåˆ—é‡æ–°æ’åºä¼˜åŒ–ä¹‹åã€‚</p>
<h5 id="sort-limit"><a class="markdownIt-Anchor" href="#sort-limit"></a> <code>$sort</code> + <code>$limit</code></h5>
<p>å½“ <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort" target="_blank" rel="noopener"><code>$sort</code></a> åœ¨ <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener"><code>$limit</code></a> ä¹‹å‰æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¸­é—´é˜¶æ®µä¿®æ”¹æ–‡æ¡£æ•°é‡ï¼ˆä¾‹å¦‚ <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind" target="_blank" rel="noopener"><code>$unwind</code></a>ã€<a href="https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group" target="_blank" rel="noopener"><code>$group</code></a>ï¼‰ï¼Œåˆ™ä¼˜åŒ–ç¨‹åºå¯ä»¥å°† <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener"><code>$limit</code></a> åˆå¹¶åˆ° <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort" target="_blank" rel="noopener"><code>$sort</code></a> ä¸­ã€‚å¦‚æœæœ‰ç®¡é“é˜¶æ®µæ›´æ”¹äº† <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort" target="_blank" rel="noopener"><code>$sort</code></a> å’Œ <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener"><code>$limit</code></a> é˜¶æ®µä¹‹é—´çš„æ–‡æ¡£æ•°ï¼Œåˆ™ MongoDB ä¸ä¼šå°† <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener"><code>$limit</code></a> åˆå¹¶åˆ° <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort" target="_blank" rel="noopener"><code>$sort</code></a> ä¸­ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘<code>$sort</code> + <code>$limit</code></p>
<p>ä¼˜åŒ–å‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123; <span class="attr">$sort</span> : &#123; <span class="attr">age</span> : <span class="number">-1</span> &#125; &#125;,</span><br><span class="line">&#123; <span class="attr">$project</span> : &#123; <span class="attr">age</span> : <span class="number">1</span>, <span class="attr">status</span> : <span class="number">1</span>, <span class="attr">name</span> : <span class="number">1</span> &#125; &#125;,</span><br><span class="line">&#123; <span class="attr">$limit</span>: <span class="number">5</span> &#125;</span><br></pre></td></tr></table></figure>
<p>ä¼˜åŒ–åï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"$sort"</span> : &#123;</span><br><span class="line">       <span class="string">"sortKey"</span> : &#123;</span><br><span class="line">          <span class="string">"age"</span> : <span class="number">-1</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"limit"</span> : NumberLong(<span class="number">5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123; <span class="string">"$project"</span> : &#123;</span><br><span class="line">         <span class="string">"age"</span> : <span class="number">1</span>,</span><br><span class="line">         <span class="string">"status"</span> : <span class="number">1</span>,</span><br><span class="line">         <span class="string">"name"</span> : <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="limit-limit"><a class="markdownIt-Anchor" href="#limit-limit"></a> <code>$limit</code> + <code>$limit</code></h5>
<p>å¦‚æœä¸€ä¸ª <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener"><code>$limit</code></a> ç´§éšå¦ä¸€ä¸ª <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener"><code>$limit</code></a>ï¼Œé‚£ä¹ˆå®ƒä»¬å¯ä»¥åˆå¹¶ä¸ºä¸€ã€‚</p>
<p>ä¼˜åŒ–å‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123; <span class="attr">$limit</span>: <span class="number">100</span> &#125;,</span><br><span class="line">&#123; <span class="attr">$limit</span>: <span class="number">10</span> &#125;</span><br></pre></td></tr></table></figure>
<p>ä¼˜åŒ–åï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  $limit: <span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="skip-skip"><a class="markdownIt-Anchor" href="#skip-skip"></a> <code>$skip</code> + <code>$skip</code></h5>
<p>å¦‚æœä¸€ä¸ª <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip" target="_blank" rel="noopener"><code>$skip</code></a> ç´§éšå¦ä¸€ä¸ª <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip" target="_blank" rel="noopener"><code>$skip</code></a> ï¼Œé‚£ä¹ˆå®ƒä»¬å¯ä»¥åˆå¹¶ä¸ºä¸€ã€‚</p>
<p>ä¼˜åŒ–å‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123; <span class="attr">$skip</span>: <span class="number">5</span> &#125;,</span><br><span class="line">&#123; <span class="attr">$skip</span>: <span class="number">2</span> &#125;</span><br></pre></td></tr></table></figure>
<p>ä¼˜åŒ–åï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  $skip: <span class="number">7</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="match-match"><a class="markdownIt-Anchor" href="#match-match"></a> <code>$match</code> + <code>$match</code></h5>
<p>å¦‚æœä¸€ä¸ª <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip" target="_blank" rel="noopener"><code>$skip</code></a> ç´§éšå¦ä¸€ä¸ª <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip" target="_blank" rel="noopener"><code>$skip</code></a> ï¼Œé‚£ä¹ˆå®ƒä»¬å¯ä»¥é€šè¿‡ <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/and/#exp._S_and" target="_blank" rel="noopener"><code>$and</code></a> åˆå¹¶ä¸ºä¸€ã€‚</p>
<p>ä¼˜åŒ–å‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123; <span class="attr">$match</span>: &#123; <span class="attr">year</span>: <span class="number">2014</span> &#125; &#125;,</span><br><span class="line">&#123; <span class="attr">$match</span>: &#123; <span class="attr">status</span>: <span class="string">"A"</span> &#125; &#125;</span><br></pre></td></tr></table></figure>
<p>ä¼˜åŒ–åï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  $match: &#123;</span><br><span class="line">    $and: [&#123; <span class="attr">year</span>: <span class="number">2014</span> &#125;, &#123; <span class="attr">status</span>: <span class="string">'A'</span> &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="lookup-unwind"><a class="markdownIt-Anchor" href="#lookup-unwind"></a> <code>$lookup</code> + <code>$unwind</code></h5>
<p>å¦‚æœä¸€ä¸ª <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind" target="_blank" rel="noopener"><code>$unwind</code></a> ç´§éšå¦ä¸€ä¸ª <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank" rel="noopener"><code>$lookup</code></a>ï¼Œå¹¶ä¸” <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind" target="_blank" rel="noopener"><code>$unwind</code></a> åœ¨ <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank" rel="noopener"><code>$lookup</code></a> çš„ as å­—æ®µä¸Šè¿è¡Œæ—¶ï¼Œä¼˜åŒ–ç¨‹åºå¯ä»¥å°† <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind" target="_blank" rel="noopener"><code>$unwind</code></a> åˆå¹¶åˆ° <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank" rel="noopener"><code>$lookup</code></a> é˜¶æ®µã€‚è¿™æ ·å¯ä»¥é¿å…åˆ›å»ºè¾ƒå¤§çš„ä¸­é—´æ–‡æ¡£ã€‚</p>
<p>ä¼˜åŒ–å‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  $lookup: &#123;</span><br><span class="line">    <span class="keyword">from</span>: <span class="string">"otherCollection"</span>,</span><br><span class="line">    <span class="keyword">as</span>: <span class="string">"resultingArray"</span>,</span><br><span class="line">    localField: <span class="string">"x"</span>,</span><br><span class="line">    foreignField: <span class="string">"y"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123; <span class="attr">$unwind</span>: <span class="string">"$resultingArray"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>ä¼˜åŒ–åï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  $lookup: &#123;</span><br><span class="line">    <span class="keyword">from</span>: <span class="string">"otherCollection"</span>,</span><br><span class="line">    <span class="keyword">as</span>: <span class="string">"resultingArray"</span>,</span><br><span class="line">    localField: <span class="string">"x"</span>,</span><br><span class="line">    foreignField: <span class="string">"y"</span>,</span><br><span class="line">    unwinding: &#123; <span class="attr">preserveNullAndEmptyArrays</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="pipeline-é™åˆ¶"><a class="markdownIt-Anchor" href="#pipeline-é™åˆ¶"></a> Pipeline é™åˆ¶</h3>
<p>ç»“æœé›†ä¸­çš„æ¯ä¸ªæ–‡æ¡£å‡å— BSON æ–‡æ¡£å¤§å°é™åˆ¶ï¼ˆå½“å‰ä¸º 16 MBï¼‰</p>
<p>Pipeline çš„å†…å­˜é™åˆ¶ä¸º 100 MBã€‚</p>
<h2 id="map-reduce"><a class="markdownIt-Anchor" href="#map-reduce"></a> Map-Reduce</h2>
<blockquote>
<p>èšåˆ pipeline æ¯” map-reduce æä¾›æ›´å¥½çš„æ€§èƒ½å’Œæ›´ä¸€è‡´çš„æ¥å£ã€‚</p>
</blockquote>
<p>Map-reduce æ˜¯ä¸€ç§æ•°æ®å¤„ç†èŒƒå¼ï¼Œç”¨äºå°†å¤§é‡æ•°æ®æ±‡æ€»ä¸ºæœ‰ç”¨çš„èšåˆç»“æœã€‚ä¸ºäº†æ‰§è¡Œ map-reduce æ“ä½œï¼ŒMongoDB æä¾›äº† <a href="https://docs.mongodb.com/manual/reference/command/mapReduce/#dbcmd.mapReduce" target="_blank" rel="noopener"><code>mapReduce</code></a> æ•°æ®åº“å‘½ä»¤ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200921155546.svg" alt="img" /></p>
<p>åœ¨ä¸Šé¢çš„æ“ä½œä¸­ï¼ŒMongoDB å°† map é˜¶æ®µåº”ç”¨äºæ¯ä¸ªè¾“å…¥ documentï¼ˆå³ collection ä¸­ä¸æŸ¥è¯¢æ¡ä»¶åŒ¹é…çš„ documentï¼‰ã€‚ map å‡½æ•°åˆ†å‘å‡ºå¤šä¸ªé”®-å€¼å¯¹ã€‚å¯¹äºå…·æœ‰å¤šä¸ªå€¼çš„é‚£äº›é”®ï¼ŒMongoDB åº”ç”¨ reduce é˜¶æ®µï¼Œè¯¥é˜¶æ®µæ”¶é›†å¹¶æ±‡æ€»èšåˆçš„æ•°æ®ã€‚ç„¶åï¼ŒMongoDB å°†ç»“æœå­˜å‚¨åœ¨ collection ä¸­ã€‚å¯é€‰åœ°ï¼Œreduce å‡½æ•°çš„è¾“å‡ºå¯ä»¥é€šè¿‡ finalize å‡½æ•°æ¥è¿›ä¸€æ­¥æ±‡æ€»èšåˆç»“æœã€‚</p>
<p>MongoDB ä¸­çš„æ‰€æœ‰ map-reduce å‡½æ•°éƒ½æ˜¯ JavaScriptï¼Œå¹¶åœ¨ mongod è¿›ç¨‹ä¸­è¿è¡Œã€‚ Map-reduce æ“ä½œå°†å•ä¸ª collection çš„ document ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å¼€å§‹ map é˜¶æ®µä¹‹å‰æ‰§è¡Œä»»æ„æ’åºå’Œé™åˆ¶ã€‚ mapReduce å¯ä»¥å°† map-reduce æ“ä½œçš„ç»“æœä½œä¸º document è¿”å›ï¼Œä¹Ÿå¯ä»¥å°†ç»“æœå†™å…¥ collectionã€‚</p>
<h2 id="å•ä¸€ç›®çš„èšåˆæ–¹æ³•"><a class="markdownIt-Anchor" href="#å•ä¸€ç›®çš„èšåˆæ–¹æ³•"></a> å•ä¸€ç›®çš„èšåˆæ–¹æ³•</h2>
<p>MongoDB æ”¯æŒä¸€ä¸‹å•ä¸€ç›®çš„çš„èšåˆæ“ä½œï¼š</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.estimatedDocumentCount/#db.collection.estimatedDocumentCount" target="_blank" rel="noopener"><code>db.collection.estimatedDocumentCount()</code></a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.count/#db.collection.count" target="_blank" rel="noopener"><code>db.collection.count()</code></a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.distinct/#db.collection.distinct" target="_blank" rel="noopener"><code>db.collection.distinct()</code></a></li>
</ul>
<p>æ‰€æœ‰è¿™äº›æ“ä½œéƒ½æ±‡æ€»äº†å•ä¸ª collection ä¸­çš„ documentã€‚å°½ç®¡è¿™äº›æ“ä½œæä¾›äº†å¯¹å¸¸è§èšåˆè¿‡ç¨‹çš„ç®€å•è®¿é—®ï¼Œä½†æ˜¯å®ƒä»¬ç›¸æ¯”èšåˆ pipeline å’Œ map-reduceï¼Œç¼ºå°‘çµæ´»æ€§å’Œä¸°å¯Œçš„åŠŸèƒ½æ€§ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200921155935.svg" alt="img" /></p>
<h2 id="sql-å’Œ-mongodb-èšåˆå¯¹æ¯”"><a class="markdownIt-Anchor" href="#sql-å’Œ-mongodb-èšåˆå¯¹æ¯”"></a> SQL å’Œ MongoDB èšåˆå¯¹æ¯”</h2>
<p>MongoDB pipeline æä¾›äº†è®¸å¤šç­‰ä»·äº SQL ä¸­å¸¸è§èšåˆè¯­å¥çš„æ“ä½œã€‚</p>
<p>ä¸‹è¡¨æ¦‚è¿°äº†å¸¸è§çš„ SQL èšåˆè¯­å¥æˆ–å‡½æ•°å’Œ MongoDB èšåˆæ“ä½œçš„æ˜ å°„è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">SQL Terms, Functions, and Concepts</th>
<th style="text-align:left">MongoDB Aggregation Operators</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>WHERE</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener"><code>$match</code></a></td>
</tr>
<tr>
<td style="text-align:left"><code>GROUP BY</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group" target="_blank" rel="noopener"><code>$group</code></a></td>
</tr>
<tr>
<td style="text-align:left"><code>HAVING</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener"><code>$match</code></a></td>
</tr>
<tr>
<td style="text-align:left"><code>SELECT</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project" target="_blank" rel="noopener"><code>$project</code></a></td>
</tr>
<tr>
<td style="text-align:left"><code>ORDER BY</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort" target="_blank" rel="noopener"><code>$sort</code></a></td>
</tr>
<tr>
<td style="text-align:left"><code>LIMIT</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener"><code>$limit</code></a></td>
</tr>
<tr>
<td style="text-align:left"><code>SUM()</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sum/#grp._S_sum" target="_blank" rel="noopener"><code>$sum</code></a></td>
</tr>
<tr>
<td style="text-align:left"><code>COUNT()</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sum/#grp._S_sum" target="_blank" rel="noopener"><code>$sum</code></a><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sortByCount/#pipe._S_sortByCount" target="_blank" rel="noopener"><code>$sortByCount</code></a></td>
</tr>
<tr>
<td style="text-align:left"><code>JOIN</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank" rel="noopener"><code>$lookup</code></a></td>
</tr>
<tr>
<td style="text-align:left"><code>SELECT INTO NEW_TABLE</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/out/#pipe._S_out" target="_blank" rel="noopener"><code>$out</code></a></td>
</tr>
<tr>
<td style="text-align:left"><code>MERGE INTO TABLE</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/merge/#pipe._S_merge" target="_blank" rel="noopener"><code>$merge</code></a> (Available starting in MongoDB 4.2)</td>
</tr>
<tr>
<td style="text-align:left"><code>UNION ALL</code></td>
<td style="text-align:left"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/unionWith/#pipe._S_unionWith" target="_blank" rel="noopener"><code>$unionWith</code></a> (Available starting in MongoDB 4.4)</td>
</tr>
</tbody>
</table>
<p>ã€ç¤ºä¾‹ã€‘</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.orders.insertMany([</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">1</span>,</span><br><span class="line">    cust_id: <span class="string">'Ant O. Knee'</span>,</span><br><span class="line">    ord_date: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-01'</span>),</span><br><span class="line">    price: <span class="number">25</span>,</span><br><span class="line">    items: [</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'oranges'</span>, <span class="attr">qty</span>: <span class="number">5</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'apples'</span>, <span class="attr">qty</span>: <span class="number">5</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">2</span>,</span><br><span class="line">    cust_id: <span class="string">'Ant O. Knee'</span>,</span><br><span class="line">    ord_date: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-08'</span>),</span><br><span class="line">    price: <span class="number">70</span>,</span><br><span class="line">    items: [</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'oranges'</span>, <span class="attr">qty</span>: <span class="number">8</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'chocolates'</span>, <span class="attr">qty</span>: <span class="number">5</span>, <span class="attr">price</span>: <span class="number">10</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">3</span>,</span><br><span class="line">    cust_id: <span class="string">'Busby Bee'</span>,</span><br><span class="line">    ord_date: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-08'</span>),</span><br><span class="line">    price: <span class="number">50</span>,</span><br><span class="line">    items: [</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'oranges'</span>, <span class="attr">qty</span>: <span class="number">10</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'pears'</span>, <span class="attr">qty</span>: <span class="number">10</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">4</span>,</span><br><span class="line">    cust_id: <span class="string">'Busby Bee'</span>,</span><br><span class="line">    ord_date: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-18'</span>),</span><br><span class="line">    price: <span class="number">25</span>,</span><br><span class="line">    items: [&#123; <span class="attr">sku</span>: <span class="string">'oranges'</span>, <span class="attr">qty</span>: <span class="number">10</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;],</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">5</span>,</span><br><span class="line">    cust_id: <span class="string">'Busby Bee'</span>,</span><br><span class="line">    ord_date: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-19'</span>),</span><br><span class="line">    price: <span class="number">50</span>,</span><br><span class="line">    items: [&#123; <span class="attr">sku</span>: <span class="string">'chocolates'</span>, <span class="attr">qty</span>: <span class="number">5</span>, <span class="attr">price</span>: <span class="number">10</span> &#125;],</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">6</span>,</span><br><span class="line">    cust_id: <span class="string">'Cam Elot'</span>,</span><br><span class="line">    ord_date: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-19'</span>),</span><br><span class="line">    price: <span class="number">35</span>,</span><br><span class="line">    items: [</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'carrots'</span>, <span class="attr">qty</span>: <span class="number">10</span>, <span class="attr">price</span>: <span class="number">1.0</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'apples'</span>, <span class="attr">qty</span>: <span class="number">10</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">7</span>,</span><br><span class="line">    cust_id: <span class="string">'Cam Elot'</span>,</span><br><span class="line">    ord_date: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-20'</span>),</span><br><span class="line">    price: <span class="number">25</span>,</span><br><span class="line">    items: [&#123; <span class="attr">sku</span>: <span class="string">'oranges'</span>, <span class="attr">qty</span>: <span class="number">10</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;],</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">8</span>,</span><br><span class="line">    cust_id: <span class="string">'Don Quis'</span>,</span><br><span class="line">    ord_date: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-20'</span>),</span><br><span class="line">    price: <span class="number">75</span>,</span><br><span class="line">    items: [</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'chocolates'</span>, <span class="attr">qty</span>: <span class="number">5</span>, <span class="attr">price</span>: <span class="number">10</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'apples'</span>, <span class="attr">qty</span>: <span class="number">10</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">9</span>,</span><br><span class="line">    cust_id: <span class="string">'Don Quis'</span>,</span><br><span class="line">    ord_date: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-20'</span>),</span><br><span class="line">    price: <span class="number">55</span>,</span><br><span class="line">    items: [</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'carrots'</span>, <span class="attr">qty</span>: <span class="number">5</span>, <span class="attr">price</span>: <span class="number">1.0</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'apples'</span>, <span class="attr">qty</span>: <span class="number">10</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">sku</span>: <span class="string">'oranges'</span>, <span class="attr">qty</span>: <span class="number">10</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: <span class="number">10</span>,</span><br><span class="line">    cust_id: <span class="string">'Don Quis'</span>,</span><br><span class="line">    ord_date: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-23'</span>),</span><br><span class="line">    price: <span class="number">25</span>,</span><br><span class="line">    items: [&#123; <span class="attr">sku</span>: <span class="string">'oranges'</span>, <span class="attr">qty</span>: <span class="number">10</span>, <span class="attr">price</span>: <span class="number">2.5</span> &#125;],</span><br><span class="line">    status: <span class="string">'A'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>SQL å’Œ MongoDB èšåˆæ–¹å¼å¯¹æ¯”ï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200921200556.png" alt="img" /></p>
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2>
<ul>
<li><strong>å®˜æ–¹</strong>
<ul>
<li><a href="https://www.mongodb.com/" target="_blank" rel="noopener">MongoDB å®˜ç½‘</a></li>
<li><a href="https://github.com/mongodb/mongo" target="_blank" rel="noopener">MongoDB Github</a></li>
<li><a href="https://university.mongodb.com/" target="_blank" rel="noopener">MongoDB å®˜æ–¹å…è´¹æ•™ç¨‹</a></li>
</ul>
</li>
<li><strong>æ•™ç¨‹</strong>
<ul>
<li><a href="https://www.runoob.com/mongodb/mongodb-tutorial.html" target="_blank" rel="noopener">MongoDB æ•™ç¨‹</a></li>
<li><a href="https://time.geekbang.org/course/intro/100040001" target="_blank" rel="noopener">MongoDB é«˜æ‰‹è¯¾</a></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2020/09/21/mongodb-%E7%B4%A2%E5%BC%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/09/21/mongodb-%E7%B4%A2%E5%BC%95/" class="post-title-link" itemprop="url">MongoDB ç´¢å¼•</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-09-21 21:22:57" itemprop="dateCreated datePublished" datetime="2020-09-21T21:22:57+08:00">2020-09-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">æ–‡æ¡£æ•°æ®åº“</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/" itemprop="url" rel="index">
                    <span itemprop="name">MongoDB</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/2020/09/21/mongodb-%E7%B4%A2%E5%BC%95/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/09/21/mongodb-ç´¢å¼•/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="mongodb-ç´¢å¼•"><a class="markdownIt-Anchor" href="#mongodb-ç´¢å¼•"></a> MongoDB ç´¢å¼•</h1>
<h2 id="mongodb-ç´¢å¼•ç®€ä»‹"><a class="markdownIt-Anchor" href="#mongodb-ç´¢å¼•ç®€ä»‹"></a> MongoDB ç´¢å¼•ç®€ä»‹</h2>
<h3 id="ç´¢å¼•çš„ä½œç”¨"><a class="markdownIt-Anchor" href="#ç´¢å¼•çš„ä½œç”¨"></a> ç´¢å¼•çš„ä½œç”¨</h3>
<p><strong>MongoDB åœ¨ collection æ•°æ®çº§åˆ«ä¸Šå®šä¹‰ç´¢å¼•</strong>ã€‚</p>
<p>ç´¢å¼•é€šå¸¸èƒ½å¤Ÿæå¤§çš„æé«˜æŸ¥è¯¢çš„æ•ˆç‡ã€‚å¦‚æœ<strong>æ²¡æœ‰ç´¢å¼•</strong>ï¼ŒMongoDB åœ¨è¯»å–æ•°æ®æ—¶<strong>å¿…é¡»æ‰«æ collection ä¸­çš„æ¯ä¸ª document</strong> å¹¶é€‰å–é‚£äº›ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è®°å½•ã€‚</p>
<p>è¿™ç§æ‰«æå…¨é›†åˆçš„æŸ¥è¯¢æ˜¯éå¸¸ä½æ•ˆçš„ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡çš„æ•°æ®æ—¶ã€‚æŸ¥è¯¢å¯èƒ½è¦èŠ±è´¹å‡ åç§’ç”šè‡³å‡ åˆ†é’Ÿï¼Œè¿™ç§æ€§èƒ½å¼€é”€æ˜¯ä¸å¯æ¥å—çš„ã€‚</p>
<p>ç´¢å¼•æ˜¯ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œç´¢å¼•å­˜å‚¨åœ¨ä¸€ä¸ªæ˜“äºéå†è¯»å–çš„æ•°æ®é›†åˆä¸­ï¼Œç´¢å¼•æ˜¯å¯¹æ•°æ®åº“è¡¨ä¸­ä¸€åˆ—æˆ–å¤šåˆ—çš„å€¼è¿›è¡Œæ’åºçš„ä¸€ç§ç»“æ„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200921210621.svg" alt="img" /></p>
<h3 id="createindex-æ–¹æ³•"><a class="markdownIt-Anchor" href="#createindex-æ–¹æ³•"></a> createIndex() æ–¹æ³•</h3>
<p><strong>MongoDB ä½¿ç”¨ <code>createIndex()</code> æ–¹æ³•æ¥åˆ›å»ºç´¢å¼•</strong>ã€‚</p>
<p><code>createIndex()</code> è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.collection.createIndex( &lt;key and index type specification&gt;, &lt;options&gt; )</span><br></pre></td></tr></table></figure>
<p><code>createIndex()</code> å¯é€‰å‚æ•°åˆ—è¡¨å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">Parameter</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">background</td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">å»ºç´¢å¼•è¿‡ç¨‹ä¼šé˜»å¡å…¶å®ƒæ•°æ®åº“æ“ä½œï¼Œbackground å¯æŒ‡å®šä»¥åå°æ–¹å¼åˆ›å»ºç´¢å¼•ï¼Œå³å¢åŠ  â€œbackgroundâ€ å¯é€‰å‚æ•°ã€‚ â€œbackgroundâ€ é»˜è®¤å€¼ä¸º<strong>false</strong>ã€‚</td>
</tr>
<tr>
<td style="text-align:left">unique</td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">å»ºç«‹çš„ç´¢å¼•æ˜¯å¦å”¯ä¸€ã€‚æŒ‡å®šä¸º true åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚é»˜è®¤å€¼ä¸º<strong>false</strong>.</td>
</tr>
<tr>
<td style="text-align:left">name</td>
<td style="text-align:left">string</td>
<td style="text-align:left">ç´¢å¼•çš„åç§°ã€‚å¦‚æœæœªæŒ‡å®šï¼ŒMongoDB çš„é€šè¿‡è¿æ¥ç´¢å¼•çš„å­—æ®µåå’Œæ’åºé¡ºåºç”Ÿæˆä¸€ä¸ªç´¢å¼•åç§°ã€‚</td>
</tr>
<tr>
<td style="text-align:left">dropDups</td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">**3.0+ç‰ˆæœ¬å·²åºŸå¼ƒã€‚**åœ¨å»ºç«‹å”¯ä¸€ç´¢å¼•æ—¶æ˜¯å¦åˆ é™¤é‡å¤è®°å½•,æŒ‡å®š true åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚é»˜è®¤å€¼ä¸º <strong>false</strong>.</td>
</tr>
<tr>
<td style="text-align:left">sparse</td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">å¯¹æ–‡æ¡£ä¸­ä¸å­˜åœ¨çš„å­—æ®µæ•°æ®ä¸å¯ç”¨ç´¢å¼•ï¼›è¿™ä¸ªå‚æ•°éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœè®¾ç½®ä¸º true çš„è¯ï¼Œåœ¨ç´¢å¼•å­—æ®µä¸­ä¸ä¼šæŸ¥è¯¢å‡ºä¸åŒ…å«å¯¹åº”å­—æ®µçš„æ–‡æ¡£.ã€‚é»˜è®¤å€¼ä¸º <strong>false</strong>.</td>
</tr>
<tr>
<td style="text-align:left">expireAfterSeconds</td>
<td style="text-align:left">integer</td>
<td style="text-align:left">æŒ‡å®šä¸€ä¸ªä»¥ç§’ä¸ºå•ä½çš„æ•°å€¼ï¼Œå®Œæˆ TTL è®¾å®šï¼Œè®¾å®šé›†åˆçš„ç”Ÿå­˜æ—¶é—´ã€‚</td>
</tr>
<tr>
<td style="text-align:left">v</td>
<td style="text-align:left">index version</td>
<td style="text-align:left">ç´¢å¼•çš„ç‰ˆæœ¬å·ã€‚é»˜è®¤çš„ç´¢å¼•ç‰ˆæœ¬å–å†³äº mongod åˆ›å»ºç´¢å¼•æ—¶è¿è¡Œçš„ç‰ˆæœ¬ã€‚</td>
</tr>
<tr>
<td style="text-align:left">weights</td>
<td style="text-align:left">document</td>
<td style="text-align:left">ç´¢å¼•æƒé‡å€¼ï¼Œæ•°å€¼åœ¨ 1 åˆ° 99,999 ä¹‹é—´ï¼Œè¡¨ç¤ºè¯¥ç´¢å¼•ç›¸å¯¹äºå…¶ä»–ç´¢å¼•å­—æ®µçš„å¾—åˆ†æƒé‡ã€‚</td>
</tr>
<tr>
<td style="text-align:left">default_language</td>
<td style="text-align:left">string</td>
<td style="text-align:left">å¯¹äºæ–‡æœ¬ç´¢å¼•ï¼Œè¯¥å‚æ•°å†³å®šäº†åœç”¨è¯åŠè¯å¹²å’Œè¯å™¨çš„è§„åˆ™çš„åˆ—è¡¨ã€‚ é»˜è®¤ä¸ºè‹±è¯­</td>
</tr>
<tr>
<td style="text-align:left">language_override</td>
<td style="text-align:left">string</td>
<td style="text-align:left">å¯¹äºæ–‡æœ¬ç´¢å¼•ï¼Œè¯¥å‚æ•°æŒ‡å®šäº†åŒ…å«åœ¨æ–‡æ¡£ä¸­çš„å­—æ®µåï¼Œè¯­è¨€è¦†ç›–é»˜è®¤çš„ languageï¼Œé»˜è®¤å€¼ä¸º language.</td>
</tr>
</tbody>
</table>
<p>ã€ç¤ºä¾‹ã€‘ä½¿ç”¨ name ä½œä¸ºç´¢å¼•ï¼Œå¹¶ä¸”æŒ‰ç…§é™åºæ’åº</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">db</span><span class="selector-class">.collection</span><span class="selector-class">.createIndex</span>( &#123; <span class="attribute">name</span>: -<span class="number">1</span> &#125; )</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2>
<ul>
<li><strong>å®˜æ–¹</strong>
<ul>
<li><a href="https://www.mongodb.com/" target="_blank" rel="noopener">MongoDB å®˜ç½‘</a></li>
<li><a href="https://github.com/mongodb/mongo" target="_blank" rel="noopener">MongoDB Github</a></li>
<li><a href="https://university.mongodb.com/" target="_blank" rel="noopener">MongoDB å®˜æ–¹å…è´¹æ•™ç¨‹</a></li>
</ul>
</li>
<li><strong>æ•™ç¨‹</strong>
<ul>
<li><a href="https://www.runoob.com/mongodb/mongodb-tutorial.html" target="_blank" rel="noopener">MongoDB æ•™ç¨‹</a></li>
<li><a href="https://time.geekbang.org/course/intro/100040001" target="_blank" rel="noopener">MongoDB é«˜æ‰‹è¯¾</a></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2020/09/20/mongodb-%E4%BA%8B%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/09/20/mongodb-%E4%BA%8B%E5%8A%A1/" class="post-title-link" itemprop="url">MongoDB äº‹åŠ¡</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-09-20 23:12:17" itemprop="dateCreated datePublished" datetime="2020-09-20T23:12:17+08:00">2020-09-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">æ–‡æ¡£æ•°æ®åº“</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/" itemprop="url" rel="index">
                    <span itemprop="name">MongoDB</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/2020/09/20/mongodb-%E4%BA%8B%E5%8A%A1/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/09/20/mongodb-äº‹åŠ¡/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>592</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="mongodb-äº‹åŠ¡"><a class="markdownIt-Anchor" href="#mongodb-äº‹åŠ¡"></a> MongoDB äº‹åŠ¡</h1>
<p>writeConcern å¯ä»¥å†³å®šå†™æ“ä½œåˆ°è¾¾å¤šå°‘ä¸ªèŠ‚ç‚¹æ‰ç®—æˆåŠŸã€‚</p>
<ul>
<li>é»˜è®¤ï¼šå¤šèŠ‚ç‚¹å¤åˆ¶é›†ä¸åšä»»ä½•è®¾å®šï¼Œæ‰€ä»¥æ˜¯æœ‰å¯èƒ½ä¸¢å¤±æ•°æ®ã€‚</li>
<li><code>w: &quot;majority&quot;</code>ï¼šå¤§éƒ¨åˆ†èŠ‚ç‚¹ç¡®è®¤ï¼Œå°±è§†ä¸ºå†™æˆåŠŸ</li>
<li><code>w: &quot;all&quot;</code>ï¼šå…¨éƒ¨èŠ‚ç‚¹ç¡®è®¤ï¼Œæ‰è§†ä¸ºå†™æˆåŠŸ</li>
</ul>
<p>journal åˆ™å®šä¹‰å¦‚ä½•æ‰ç®—æˆåŠŸã€‚å–å€¼åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>true</code>ï¼šå†™æ“ä½œè½åˆ° journal æ–‡ä»¶ä¸­æ‰ç®—æˆåŠŸï¼›</li>
<li><code>false</code>ï¼šå†™æ“ä½œè¾¾åˆ°å†…å­˜å³ç®—ä½œæˆåŠŸã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘åœ¨é›†ç¾¤ä¸­ä½¿ç”¨ writeConcern å‚æ•°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.transaction.insert(&#123; <span class="attr">count</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">writeConcern</span>: &#123; <span class="attr">w</span>: <span class="string">'majoriy'</span> &#125; &#125;)</span><br><span class="line">db.transaction.insert(&#123; <span class="attr">count</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">writeConcern</span>: &#123; <span class="attr">w</span>: <span class="string">'4'</span> &#125; &#125;)</span><br><span class="line">db.transaction.insert(&#123; <span class="attr">count</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">writeConcern</span>: &#123; <span class="attr">w</span>: <span class="string">'all'</span> &#125; &#125;)</span><br></pre></td></tr></table></figure>
<p>ã€ç¤ºä¾‹ã€‘é…ç½®å»¶è¿ŸèŠ‚ç‚¹ï¼Œæ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="attribute">conf</span>=rs.conf()</span><br><span class="line">conf.memebers[2].<span class="attribute">slaveDelay</span>=5</span><br><span class="line">conf.memebers[2].<span class="attribute">priority</span>=0</span><br><span class="line">rs.reconfig(conf)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/4/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/blog/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/18/">18</a><a class="extend next" rel="next" href="/blog/page/6/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Zhang Peng"
    src="/blog/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Zhang Peng</p>
  <div class="site-description" itemprop="description">Dunwu's Blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">173</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">102</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/dunwu" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;dunwu" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:forbreak@163.com" title="E-Mail &amp;rarr; mailto:forbreak@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/blog/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2015 â€“ 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-paper-plane"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang Peng</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">976k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">14:48</span>
</div>

        












        
      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>

<script src="/blog/js/bookmark.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>














  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://blog-ajay4qmfci.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
