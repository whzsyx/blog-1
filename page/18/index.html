<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon.ico">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-minimal.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Pisces',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":true},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="Dunwu&#39;s Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Dunwu">
<meta property="og:url" content="https://dunwu.github.io/blog/page/18/index.html">
<meta property="og:site_name" content="Dunwu">
<meta property="og:description" content="Dunwu&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Zhang Peng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://dunwu.github.io/blog/page/18/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Dunwu</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/blog/atom.xml" title="Dunwu" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dunwu</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">大道至简，知易行难</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">102</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">37</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">173</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/dunwu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2015/01/14/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2015/01/14/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式之适配器模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-01-14 18:31:00" itemprop="dateCreated datePublished" datetime="2015-01-14T18:31:00+08:00">2015-01-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index">
                    <span itemprop="name">设计</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">设计模式</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/blog/2015/01/14/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/01/14/设计模式之适配器模式/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="设计模式之适配器模式"><a class="markdownIt-Anchor" href="#设计模式之适配器模式"></a> 设计模式之适配器模式</h1>
<h2 id="1-意图"><a class="markdownIt-Anchor" href="#1-意图"></a> 1. 意图</h2>
<p><strong>适配器模式</strong> (Adapter)是一种结构型设计模式， 它能使不兼容的对象能够相互合作。</p>
<p>适配器模式通过封装对象将复杂的转换过程隐藏于幕后。 被封装的对象甚至察觉不到适配器的存在。</p>
<p>适配器不仅可以转换不同格式的数据， 其还有助于采用不同接口的对象之间的合作。 它的运作方式如下：</p>
<ul>
<li>适配器实现与其中一个现有对象兼容的接口。</li>
<li>现有对象可以使用该接口安全地调用适配器方法。</li>
<li>适配器方法被调用后将以另一个对象兼容的格式和顺序将请求传递给该对象。</li>
</ul>
<h2 id="2-适用场景"><a class="markdownIt-Anchor" href="#2-适用场景"></a> 2. 适用场景</h2>
<ul>
<li>当你希望使用某个类， 但是其接口与其他代码不兼容时， 可以使用适配器类。</li>
<li>如果您需要复用这样一些类， 他们处于同一个继承体系， 并且他们又有了额外的一些共同的方法， 但是这些共同的方法不是所有在这一继承体系中的子类所具有的共性。</li>
</ul>
<h2 id="3-结构"><a class="markdownIt-Anchor" href="#3-结构"></a> 3. 结构</h2>
<p>适配器实现了其中一个对象的接口， 并对另一个对象进行封装。</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210430141928.png" alt="img" /></p>
<h3 id="31-结构说明"><a class="markdownIt-Anchor" href="#31-结构说明"></a> 3.1. 结构说明</h3>
<ol>
<li><strong>客户端</strong> （Client） 是包含当前程序业务逻辑的类。</li>
<li><strong>客户端接口</strong> （Client Interface） 描述了其他类与客户端代码合作时必须遵循的协议。</li>
<li><strong>服务</strong> （Service） 中有一些功能类 （通常来自第三方或遗留系统）。 客户端与其接口不兼容， 因此无法直接调用其功能。</li>
<li><strong>适配器</strong> （Adapter） 是一个可以同时与客户端和服务交互的类： 它在实现客户端接口的同时封装了服务对象。 适配器接受客户端通过适配器接口发起的调用， 并将其转换为适用于被封装服务对象的调用。</li>
<li>客户端代码只需通过接口与适配器交互即可， 无需与具体的适配器类耦合。 因此， 你可以向程序中添加新类型的适配器而无需修改已有代码。 这在服务类的接口被更改或替换时很有用： 你无需修改客户端代码就可以创建新的适配器类。</li>
</ol>
<h3 id="32-结构代码范式"><a class="markdownIt-Anchor" href="#32-结构代码范式"></a> 3.2. 结构代码范式</h3>
<p>【Target】</p>
<p>定义用户实际<strong>需要的接口</strong>。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Request</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【Adaptee】</p>
<p>定义一个需要<strong>适配的接口</strong>。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adaptee</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SpecificRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"特殊请求"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【Adapter】</p>
<p>通过在内部<strong>包装一个</strong> <strong>Adaptee 对象</strong>，把源接口转换成目标接口。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Adaptee adaptee = <span class="keyword">new</span> Adaptee();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        adaptee.SpecificRequest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【客户端】</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdapterPattern</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        Target target = <span class="keyword">new</span> Adapter();</span><br><span class="line">        target.Request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【输出】</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">特殊请求</span><br></pre></td></tr></table></figure>
<h2 id="4-伪代码"><a class="markdownIt-Anchor" href="#4-伪代码"></a> 4. 伪代码</h2>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210430165258.png" alt="img" /></p>
<p>适配器假扮成一个圆钉 （Round­Peg）， 其半径等于方钉 （Square­Peg） 横截面对角线的一半 （即能够容纳方钉的最小外接圆的半径）。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 假设你有两个接口相互兼容的类：圆孔（Round­Hole）和圆钉（Round­Peg）。</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoundHole</span> <span class="title">is</span></span></span><br><span class="line"><span class="class">    <span class="title">constructor</span> <span class="title">RoundHole</span>(<span class="title">radius</span>) </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">method <span class="title">getRadius</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 返回孔的半径。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    method <span class="title">fits</span><span class="params">(peg: RoundPeg)</span> is</span></span><br><span class="line"><span class="function">        return <span class="keyword">this</span>.<span class="title">getRadius</span><span class="params">()</span> &gt;</span>= peg.getRadius()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoundPeg</span> <span class="title">is</span></span></span><br><span class="line"><span class="class">    <span class="title">constructor</span> <span class="title">RoundPeg</span>(<span class="title">radius</span>) </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">method <span class="title">getRadius</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 返回钉子的半径。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 但还有一个不兼容的类：方钉（Square­Peg）。</span></span></span><br><span class="line"><span class="function">class SquarePeg is</span></span><br><span class="line"><span class="function">    constructor <span class="title">SquarePeg</span><span class="params">(width)</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">method <span class="title">getWidth</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 返回方钉的宽度。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 适配器类让你能够将方钉放入圆孔中。它会对 RoundPeg 类进行扩展，以接收适</span></span></span><br><span class="line"><span class="function"><span class="comment">// 配器对象作为圆钉。</span></span></span><br><span class="line"><span class="function">class SquarePegAdapter extends RoundPeg is</span></span><br><span class="line"><span class="function">    <span class="comment">// 在实际情况中，适配器中会包含一个 SquarePeg 类的实例。</span></span></span><br><span class="line"><span class="function">    <span class="keyword">private</span> field peg: SquarePeg</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    constructor <span class="title">SquarePegAdapter</span><span class="params">(peg: SquarePeg)</span> is</span></span><br><span class="line"><span class="function">        <span class="keyword">this</span>.peg </span>= peg</span><br><span class="line"></span><br><span class="line">    <span class="function">method <span class="title">getRadius</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 适配器会假扮为一个圆钉，</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 其半径刚好能与适配器实际封装的方钉搭配起来。</span></span></span><br><span class="line"><span class="function">        return peg.<span class="title">getWidth</span><span class="params">()</span> * Math.<span class="title">sqrt</span><span class="params">(<span class="number">2</span>)</span> / 2</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 客户端代码中的某个位置。</span></span></span><br><span class="line"><span class="function">hole </span>= <span class="keyword">new</span> RoundHole(<span class="number">5</span>)</span><br><span class="line">rpeg = <span class="keyword">new</span> RoundPeg(<span class="number">5</span>)</span><br><span class="line">hole.fits(rpeg) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">small_sqpeg = <span class="keyword">new</span> SquarePeg(<span class="number">5</span>)</span><br><span class="line">large_sqpeg = <span class="keyword">new</span> SquarePeg(<span class="number">10</span>)</span><br><span class="line">hole.fits(small_sqpeg) <span class="comment">// 此处无法编译（类型不一致）。</span></span><br><span class="line"></span><br><span class="line">small_sqpeg_adapter = <span class="keyword">new</span> SquarePegAdapter(small_sqpeg)</span><br><span class="line">large_sqpeg_adapter = <span class="keyword">new</span> SquarePegAdapter(large_sqpeg)</span><br><span class="line">hole.fits(small_sqpeg_adapter) <span class="comment">// true</span></span><br><span class="line">hole.fits(large_sqpeg_adapter) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="5-案例"><a class="markdownIt-Anchor" href="#5-案例"></a> 5. 案例</h2>
<p>适配器模式在 Java 代码中很常见。</p>
<p>Java 核心程序库中有一些标准的适配器：</p>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#asList-T...-" target="_blank" rel="noopener"><code>java.util.Arrays#asList()</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#list-java.util.Enumeration-" target="_blank" rel="noopener"><code>java.util.Collections#list()</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#enumeration-java.util.Collection-" target="_blank" rel="noopener"><code>java.util.Collections#enumeration()</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStreamReader.html#InputStreamReader-java.io.InputStream-" target="_blank" rel="noopener"><code>java.io.InputStreamReader(InputStream)</code></a> （返回 <code>Reader</code>对象）</li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/OutputStreamWriter.html#OutputStreamWriter-java.io.OutputStream-" target="_blank" rel="noopener"><code>java.io.OutputStreamWriter(OutputStream)</code></a> （返回 <code>Writer</code>对象）</li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/adapters/XmlAdapter.html#marshal-BoundType-" target="_blank" rel="noopener"><code>javax.xml.bind.annotation.adapters.XmlAdapter#marshal()</code></a> 和 <code>#unmarshal()</code></li>
</ul>
<p><strong>识别方法</strong>： 适配器可以通过以不同抽象或接口类型实例为参数的构造函数来识别。 当适配器的任何方法被调用时， 它会将参数转换为合适的格式， 然后将调用定向到其封装对象中的一个或多个方法。</p>
<h2 id="6-与其他模式的关系"><a class="markdownIt-Anchor" href="#6-与其他模式的关系"></a> 6. 与其他模式的关系</h2>
<ul>
<li><a href="https://refactoringguru.cn/design-patterns/bridge" target="_blank" rel="noopener">桥接模式</a>通常会于开发前期进行设计， 使你能够将程序的各个部分独立开来以便开发。 另一方面， <a href="https://refactoringguru.cn/design-patterns/adapter" target="_blank" rel="noopener">适配器模式</a>通常在已有程序中使用， 让相互不兼容的类能很好地合作。</li>
<li><a href="https://refactoringguru.cn/design-patterns/adapter" target="_blank" rel="noopener">适配器</a>可以对已有对象的接口进行修改， <a href="https://refactoringguru.cn/design-patterns/decorator" target="_blank" rel="noopener">装饰模式</a>则能在不改变对象接口的前提下强化对象功能。 此外， <em>装饰</em>还支持递归组合， <em>适配器</em>则无法实现。</li>
<li><a href="https://refactoringguru.cn/design-patterns/adapter" target="_blank" rel="noopener">适配器</a>能为被封装对象提供不同的接口， <a href="https://refactoringguru.cn/design-patterns/proxy" target="_blank" rel="noopener">代理模式</a>能为对象提供相同的接口， <a href="https://refactoringguru.cn/design-patterns/decorator" target="_blank" rel="noopener">装饰</a>则能为对象提供加强的接口。</li>
<li><a href="https://refactoringguru.cn/design-patterns/facade" target="_blank" rel="noopener">外观模式</a>为现有对象定义了一个新接口， <a href="https://refactoringguru.cn/design-patterns/adapter" target="_blank" rel="noopener">适配器</a>则会试图运用已有的接口。 <em>适配器</em>通常只封装一个对象， <em>外观</em>通常会作用于整个对象子系统上。</li>
<li><a href="https://refactoringguru.cn/design-patterns/bridge" target="_blank" rel="noopener">桥接</a>、 <a href="https://refactoringguru.cn/design-patterns/state" target="_blank" rel="noopener">状态模式</a>和<a href="https://refactoringguru.cn/design-patterns/strategy" target="_blank" rel="noopener">策略模式</a> （在某种程度上包括<a href="https://refactoringguru.cn/design-patterns/adapter" target="_blank" rel="noopener">适配器</a>） 模式的接口非常相似。 实际上， 它们都基于<a href="https://refactoringguru.cn/design-patterns/composite" target="_blank" rel="noopener">组合模式</a>——即将工作委派给其他对象， 不过也各自解决了不同的问题。 模式并不只是以特定方式组织代码的配方， 你还可以使用它们来和其他开发者讨论模式所解决的问题。</li>
</ul>
<h2 id="7-参考资料"><a class="markdownIt-Anchor" href="#7-参考资料"></a> 7. 参考资料</h2>
<ul>
<li><a href="https://book.douban.com/subject/2243615/" target="_blank" rel="noopener">《Head First 设计模式》</a></li>
<li><a href="https://book.douban.com/subject/2334288/" target="_blank" rel="noopener">《大话设计模式》</a></li>
<li><a href="https://refactoringguru.cn/design-patterns/catalog" target="_blank" rel="noopener">设计模式教程</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2015/01/14/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2015/01/14/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式之组合模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-01-14 15:33:00" itemprop="dateCreated datePublished" datetime="2015-01-14T15:33:00+08:00">2015-01-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index">
                    <span itemprop="name">设计</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">设计模式</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/blog/2015/01/14/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/01/14/设计模式之组合模式/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="设计模式之组合模式"><a class="markdownIt-Anchor" href="#设计模式之组合模式"></a> 设计模式之组合模式</h1>
<h2 id="1-意图"><a class="markdownIt-Anchor" href="#1-意图"></a> 1. 意图</h2>
<p><strong>组合模式</strong> (Component) 是一种结构型设计模式，将对象组合成<strong>树形结构</strong>以表示“部分-整体”的层次结构。</p>
<p>组合模式使得用户对单个对象和组合对象的使用具有<strong>唯一性</strong>。</p>
<h2 id="2-适用场景"><a class="markdownIt-Anchor" href="#2-适用场景"></a> 2. 适用场景</h2>
<p>组合模式的适用场景：</p>
<ul>
<li>想要表示对象的部分-整体层次结构。</li>
<li>想要客户端忽略组合对象与单个对象的差异，客户端将统一地使用组合结构中的所有对象。</li>
</ul>
<p>关于分级数据结构的一个普遍性的例子是你每次使用电脑时所遇到的 <strong>文件系统</strong>。</p>
<p>文件系统由目录和文件组成。每个目录都可以装内容。目录的内容可以是文件，也 可以是目录。</p>
<p>按照这种方式，计算机的文件系统就是以递归结构来组织的。如果你想要描述这样的数据结构，那么你可以使用组合模式。</p>
<h2 id="3-结构"><a class="markdownIt-Anchor" href="#3-结构"></a> 3. 结构</h2>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210430162149.png" alt="img" /></p>
<h3 id="31-结构说明"><a class="markdownIt-Anchor" href="#31-结构说明"></a> 3.1. 结构说明</h3>
<ol>
<li><strong>组件</strong> （Component） 接口描述了树中简单项目和复杂项目所共有的操作。</li>
<li><strong>叶节点</strong> （Leaf） 是树的基本结构， 它不包含子项目。一般情况下， 叶节点最终会完成大部分的实际工作， 因为它们无法将工作指派给其他部分。</li>
<li><strong>容器</strong> （Container）——又名 “组合 （Composite）”——是包含叶节点或其他容器等子项目的单位。 容器不知道其子项目所属的具体类， 它只通过通用的组件接口与其子项目交互。容器接收到请求后会将工作分配给自己的子项目， 处理中间结果， 然后将最终结果返回给客户端。</li>
<li><strong>客户端</strong> （Client） 通过组件接口与所有项目交互。 因此， 客户端能以相同方式与树状结构中的简单或复杂项目交互。</li>
</ol>
<h3 id="32-结构代码范式"><a class="markdownIt-Anchor" href="#32-结构代码范式"></a> 3.2. 结构代码范式</h3>
<p><strong>Component</strong> : 组合中的对象声明接口，在适当的情况下，实现所有类共有接口的默认行为。声明一个接口用于访问和管理 Component 的子部件。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Component</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Add</span><span class="params">(Component c)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Remove</span><span class="params">(Component c)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Display</span><span class="params">(<span class="keyword">int</span> depth)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Leaf</strong> : 表示叶节点对象。叶子节点没有子节点。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Leaf</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Leaf</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Add</span><span class="params">(Component c)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Can not add to a leaf"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Remove</span><span class="params">(Component c)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Can not remove from a leaf"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Display</span><span class="params">(<span class="keyword">int</span> depth)</span> </span>&#123;</span><br><span class="line">        String temp = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; depth; i++)</span><br><span class="line">            temp += <span class="string">'-'</span>;</span><br><span class="line">        System.out.println(temp + name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Composite</strong> : 定义枝节点行为，用来存储子部件，在 Component 接口中实现与子部件相关的操作。例如 Add 和 Remove。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Composite</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Component&gt; children = <span class="keyword">new</span> ArrayList&lt;Component&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Composite</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Add</span><span class="params">(Component c)</span> </span>&#123;</span><br><span class="line">        children.add(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Remove</span><span class="params">(Component c)</span> </span>&#123;</span><br><span class="line">        children.remove(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Display</span><span class="params">(<span class="keyword">int</span> depth)</span> </span>&#123;</span><br><span class="line">        String temp = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; depth; i++)</span><br><span class="line">            temp += <span class="string">'-'</span>;</span><br><span class="line">        System.out.println(temp + name);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Component c : children) &#123;</span><br><span class="line">            c.Display(depth + <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Client</strong> : 通过 Component 接口操作结构中的对象。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompositePattern</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Composite root = <span class="keyword">new</span> Composite(<span class="string">"root"</span>);</span><br><span class="line">        root.Add(<span class="keyword">new</span> Leaf(<span class="string">"Leaf A"</span>));</span><br><span class="line">        root.Add(<span class="keyword">new</span> Leaf(<span class="string">"Leaf B"</span>));</span><br><span class="line"></span><br><span class="line">        Composite compX = <span class="keyword">new</span> Composite(<span class="string">"Composite X"</span>);</span><br><span class="line">        compX.Add(<span class="keyword">new</span> Leaf(<span class="string">"Leaf XA"</span>));</span><br><span class="line">        compX.Add(<span class="keyword">new</span> Leaf(<span class="string">"Leaf XB"</span>));</span><br><span class="line">        root.Add(compX);</span><br><span class="line"></span><br><span class="line">        Composite compXY = <span class="keyword">new</span> Composite(<span class="string">"Composite XY"</span>);</span><br><span class="line">        compXY.Add(<span class="keyword">new</span> Leaf(<span class="string">"Leaf XYA"</span>));</span><br><span class="line">        compXY.Add(<span class="keyword">new</span> Leaf(<span class="string">"Leaf XYB"</span>));</span><br><span class="line">        compX.Add(compXY);</span><br><span class="line"></span><br><span class="line">        root.Display(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-伪代码"><a class="markdownIt-Anchor" href="#4-伪代码"></a> 4. 伪代码</h2>
<p>在本例中， 我们将借助<strong>组合</strong>模式帮助你在图形编辑器中实现一系列的几何图形。</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210430162653.png" alt="img" /></p>
<p><code>组合图形</code>Compound­Graphic 是一个容器， 它可以由多个包括容器在内的子图形构成。 组合图形与简单图形拥有相同的方法。 但是， 组合图形自身并不完成具体工作， 而是将请求递归地传递给自己的子项目， 然后 “汇总” 结果。</p>
<p>通过所有图形类所共有的接口， 客户端代码可以与所有图形互动。 因此， 客户端不知道与其交互的是简单图形还是组合图形。 客户端可以与非常复杂的对象结构进行交互， 而无需与组成该结构的实体类紧密耦合。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 组件接口会声明组合中简单和复杂对象的通用操作。</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Graphic</span> <span class="title">is</span></span></span><br><span class="line"><span class="class">    <span class="title">method</span> <span class="title">move</span>(<span class="title">x</span>, <span class="title">y</span>)</span></span><br><span class="line"><span class="class">    <span class="title">method</span> <span class="title">draw</span>()</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">// 叶节点类代表组合的终端对象。叶节点对象中不能包含任何子对象。叶节点对象</span></span><br><span class="line"><span class="class">// 通常会完成实际的工作，组合对象则仅会将工作委派给自己的子部件。</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">Dot</span> <span class="keyword">implements</span> <span class="title">Graphic</span> <span class="title">is</span></span></span><br><span class="line"><span class="class">    <span class="title">field</span> <span class="title">x</span>, <span class="title">y</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">constructor</span> <span class="title">Dot</span>(<span class="title">x</span>, <span class="title">y</span>) </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">method <span class="title">move</span><span class="params">(x, y)</span> is</span></span><br><span class="line"><span class="function">        <span class="keyword">this</span>.x +</span>= x, <span class="keyword">this</span>.y += y</span><br><span class="line"></span><br><span class="line">    <span class="function">method <span class="title">draw</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 在坐标位置(X,Y)处绘制一个点。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 所有组件类都可以扩展其他组件。</span></span></span><br><span class="line"><span class="function">class Circle extends Dot is</span></span><br><span class="line"><span class="function">    field radius</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    constructor <span class="title">Circle</span><span class="params">(x, y, radius)</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">method <span class="title">draw</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 在坐标位置(X,Y)处绘制一个半径为 R 的圆。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 组合类表示可能包含子项目的复杂组件。组合对象通常会将实际工作委派给子项</span></span></span><br><span class="line"><span class="function"><span class="comment">// 目，然后“汇总”结果。</span></span></span><br><span class="line"><span class="function">class CompoundGraphic implements Graphic is</span></span><br><span class="line"><span class="function">    field children: array of Graphic</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// 组合对象可在其项目列表中添加或移除其他组件（简单的或复杂的皆可）。</span></span></span><br><span class="line"><span class="function">    method <span class="title">add</span><span class="params">(child: Graphic)</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 在子项目数组中添加一个子项目。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    method <span class="title">remove</span><span class="params">(child: Graphic)</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 从子项目数组中移除一个子项目。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    method <span class="title">move</span><span class="params">(x, y)</span> is</span></span><br><span class="line"><span class="function">        <span class="title">foreach</span> <span class="params">(child in children)</span> <span class="keyword">do</span></span></span><br><span class="line"><span class="function">            child.<span class="title">move</span><span class="params">(x, y)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// 组合会以特定的方式执行其主要逻辑。它会递归遍历所有子项目，并收集和</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 汇总其结果。由于组合的子项目也会将调用传递给自己的子项目，以此类推，</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 最后组合将会完成整个对象树的遍历工作。</span></span></span><br><span class="line"><span class="function">    method <span class="title">draw</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 1. 对于每个子部件：</span></span></span><br><span class="line"><span class="function">        <span class="comment">//     - 绘制该部件。</span></span></span><br><span class="line"><span class="function">        <span class="comment">//     - 更新边框坐标。</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 2. 根据边框坐标绘制一个虚线长方形。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 客户端代码会通过基础接口与所有组件进行交互。这样一来，客户端代码便可同</span></span></span><br><span class="line"><span class="function"><span class="comment">// 时支持简单叶节点组件和复杂组件。</span></span></span><br><span class="line"><span class="function">class ImageEditor is</span></span><br><span class="line"><span class="function">    field all: CompoundGraphic</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    method <span class="title">load</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        all </span>= <span class="keyword">new</span> CompoundGraphic()</span><br><span class="line">        all.add(<span class="keyword">new</span> Dot(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">        all.add(<span class="keyword">new</span> Circle(<span class="number">5</span>, <span class="number">3</span>, <span class="number">10</span>))</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将所需组件组合为复杂的组合组件。</span></span><br><span class="line">    <span class="function">method <span class="title">groupSelected</span><span class="params">(components: array of Graphic)</span> is</span></span><br><span class="line"><span class="function">        group </span>= <span class="keyword">new</span> CompoundGraphic()</span><br><span class="line">        foreach (component in components) <span class="keyword">do</span></span><br><span class="line">            group.add(component)</span><br><span class="line">            all.remove(component)</span><br><span class="line">        all.add(group)</span><br><span class="line">        <span class="comment">// 所有组件都将被绘制。</span></span><br><span class="line">        all.draw()</span><br></pre></td></tr></table></figure>
<h2 id="5-案例"><a class="markdownIt-Anchor" href="#5-案例"></a> 5. 案例</h2>
<p><strong>使用实例：</strong> 组合模式在 Java 代码中很常见,常用于表示与图形打交道的用户界面组件或代码的层次结构。</p>
<p>下面是一些来自 Java 标准程序库中的组合示例：</p>
<ul>
<li><a href="http://docs.oracle.com/javase/8/docs/api/java/awt/Container.html#add-java.awt.Component-" target="_blank" rel="noopener"><code>java.awt.Container#add(Component)</code></a> （几乎广泛存在于 Swing 组件中）</li>
<li><a href="http://docs.oracle.com/javaee/7/api/javax/faces/component/UIComponent.html#getChildren--" target="_blank" rel="noopener"><code>javax.faces.component.UIComponent#getChildren()</code></a> （几乎广泛存在于 JSF UI 组件中）</li>
</ul>
<p><strong>识别方法</strong>： 组合可以通过将同一抽象或接口类型的实例放入树状结构的行为方法来轻松识别。</p>
<h2 id="6-与其他模式的关系"><a class="markdownIt-Anchor" href="#6-与其他模式的关系"></a> 6. 与其他模式的关系</h2>
<ul>
<li><a href="https://refactoringguru.cn/design-patterns/bridge" target="_blank" rel="noopener">桥接模式</a>、 <a href="https://refactoringguru.cn/design-patterns/state" target="_blank" rel="noopener">状态模式</a>和<a href="https://refactoringguru.cn/design-patterns/strategy" target="_blank" rel="noopener">策略模式</a> （在某种程度上包括<a href="https://refactoringguru.cn/design-patterns/adapter" target="_blank" rel="noopener">适配器模式</a>） 模式的接口非常相似。 实际上， 它们都基于<a href="https://refactoringguru.cn/design-patterns/composite" target="_blank" rel="noopener">组合模式</a>——即将工作委派给其他对象， 不过也各自解决了不同的问题。 模式并不只是以特定方式组织代码的配方， 你还可以使用它们来和其他开发者讨论模式所解决的问题。</li>
<li>你可以在创建复杂<a href="https://refactoringguru.cn/design-patterns/composite" target="_blank" rel="noopener">组合</a>树时使用<a href="https://refactoringguru.cn/design-patterns/builder" target="_blank" rel="noopener">生成器模式</a>， 因为这可使其构造步骤以递归的方式运行。</li>
<li><a href="https://refactoringguru.cn/design-patterns/chain-of-responsibility" target="_blank" rel="noopener">责任链模式</a>通常和<a href="https://refactoringguru.cn/design-patterns/composite" target="_blank" rel="noopener">组合模式</a>结合使用。 在这种情况下， 叶组件接收到请求后， 可以将请求沿包含全体父组件的链一直传递至对象树的底部。</li>
<li>你可以使用<a href="https://refactoringguru.cn/design-patterns/iterator" target="_blank" rel="noopener">迭代器模式</a>来遍历<a href="https://refactoringguru.cn/design-patterns/composite" target="_blank" rel="noopener">组合</a>树。</li>
<li>你可以使用<a href="https://refactoringguru.cn/design-patterns/visitor" target="_blank" rel="noopener">访问者模式</a>对整个<a href="https://refactoringguru.cn/design-patterns/composite" target="_blank" rel="noopener">组合</a>树执行操作。</li>
<li>你可以使用<a href="https://refactoringguru.cn/design-patterns/flyweight" target="_blank" rel="noopener">享元模式</a>实现<a href="https://refactoringguru.cn/design-patterns/composite" target="_blank" rel="noopener">组合</a>树的共享叶节点以节省内存。</li>
<li><a href="https://refactoringguru.cn/design-patterns/composite" target="_blank" rel="noopener">组合</a>和<a href="https://refactoringguru.cn/design-patterns/decorator" target="_blank" rel="noopener">装饰模式</a>的结构图很相似， 因为两者都依赖递归组合来组织无限数量的对象。
<ul>
<li><em>装饰</em>类似于<em>组合</em>， 但其只有一个子组件。 此外还有一个明显不同： <em>装饰</em>为被封装对象添加了额外的职责， <em>组合</em>仅对其子节点的结果进行了 “求和”。</li>
<li>但是， 模式也可以相互合作： 你可以使用<em>装饰</em>来扩展<em>组合</em>树中特定对象的行为。</li>
</ul>
</li>
<li>大量使用<a href="https://refactoringguru.cn/design-patterns/composite" target="_blank" rel="noopener">组合</a>和<a href="https://refactoringguru.cn/design-patterns/decorator" target="_blank" rel="noopener">装饰</a>的设计通常可从对于<a href="https://refactoringguru.cn/design-patterns/prototype" target="_blank" rel="noopener">原型模式</a>的使用中获益。 你可以通过该模式来复制复杂结构， 而非从零开始重新构造。</li>
</ul>
<h2 id="7-参考资料"><a class="markdownIt-Anchor" href="#7-参考资料"></a> 7. 参考资料</h2>
<ul>
<li><a href="https://book.douban.com/subject/2243615/" target="_blank" rel="noopener">《Head First 设计模式》</a></li>
<li><a href="https://book.douban.com/subject/2334288/" target="_blank" rel="noopener">《大话设计模式》</a></li>
<li><a href="https://refactoringguru.cn/design-patterns/catalog" target="_blank" rel="noopener">设计模式教程</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/2015/01/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2015/01/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式之模板方法模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-01-06 09:43:00" itemprop="dateCreated datePublished" datetime="2015-01-06T09:43:00+08:00">2015-01-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-14 16:45:53" itemprop="dateModified" datetime="2022-04-14T16:45:53+08:00">2022-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index">
                    <span itemprop="name">设计</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index">
                    <span itemprop="name">设计模式</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/blog/2015/01/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/01/06/设计模式之模板方法模式/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="设计模式之模板方法模式"><a class="markdownIt-Anchor" href="#设计模式之模板方法模式"></a> 设计模式之模板方法模式</h1>
<h2 id="1-意图"><a class="markdownIt-Anchor" href="#1-意图"></a> 1. 意图</h2>
<p><strong>模板方法模式</strong> (Template Method) 是一种行为设计模式， 它在超类中定义了一个算法的框架， 允许子类在不修改结构的情况下重写算法的特定步骤。</p>
<p>模板方法模式是所有模式中最为常见的几个模式之一，是<strong>基于继承</strong>的<strong>代码复用</strong>的基本技术。，没有关联关系。 因此，在模板方法模式的类结构图中，<strong>只有继承关系</strong>。</p>
<p>模板方法模式需要开发抽象类和具体子类的设计师之间的协作。一个设计师负责给出一个算法的轮廓和骨架，另一些设计师则负责给出这个算法的各个逻辑步骤。</p>
<p>代表这些具体逻辑步骤的方法称做<strong>基本方法(primitive method)</strong>；而将这些基本方法汇总起来的方法叫做<strong>模板方法(template method)</strong>，这个设计模式的名字就是从此而来。</p>
<p>在模板方法模式中，首先父类会定义一个算法的框架，即实现算法所必须的所有方法。</p>
<ul>
<li>
<p>其中，具有共性的代码放在父类的具体方法中。</p>
</li>
<li>
<p>各个子类特殊性的代码放在子类的具体方法中。但是父类中需要有对应抽象方法声明。</p>
</li>
<li>
<p>钩子方法可以让子类决定是否对算法的不同点进行挂钩。</p>
</li>
</ul>
<h2 id="2-适用场景"><a class="markdownIt-Anchor" href="#2-适用场景"></a> 2. 适用场景</h2>
<ul>
<li>当你只希望客户端扩展某个特定算法步骤， 而不是整个算法或其结构时， 可使用模板方法模式。</li>
<li>当多个类的算法除一些细微不同之外几乎完全一样时， 你可使用该模式。 但其后果就是， 只要算法发生变化， 你就可能需要修改所有的类。</li>
</ul>
<h2 id="3-结构"><a class="markdownIt-Anchor" href="#3-结构"></a> 3. 结构</h2>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210517201945.png" alt="img" /></p>
<h3 id="31-结构说明"><a class="markdownIt-Anchor" href="#31-结构说明"></a> 3.1. 结构说明</h3>
<ol>
<li><strong>抽象类</strong> （Abstract­Class） 会声明作为算法步骤的方法， 以及依次调用它们的实际模板方法。 算法步骤可以被声明为 <code>抽象</code>类型， 也可以提供一些默认实现。</li>
<li><strong>具体类</strong> （Concrete­Class） 可以重写所有步骤， 但不能重写模板方法自身。</li>
</ol>
<h3 id="32-结构代码范式"><a class="markdownIt-Anchor" href="#32-结构代码范式"></a> 3.2. 结构代码范式</h3>
<p><strong>AbstractClass</strong> : 抽象类，定义并实现一个模板方法。这个模板方法定义了算法的骨架，而逻辑的组成步骤在相应的抽象操作中，推迟到子类去实现。顶级逻辑也有可能调用一些具体方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">PrimitiveOperation1</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">PrimitiveOperation2</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TemplateMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PrimitiveOperation1();</span><br><span class="line">        PrimitiveOperation2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ConcreteClass</strong> : 实现实现父类所定义的一个或多个抽象方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClassA</span> <span class="keyword">extends</span> <span class="title">AbstractClass</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PrimitiveOperation1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"具体A类方法1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PrimitiveOperation2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"具体A类方法2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClassB</span> <span class="keyword">extends</span> <span class="title">AbstractClass</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PrimitiveOperation1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"具体B类方法1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PrimitiveOperation2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"具体B类方法2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TemplateMethodPattern</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AbstractClass objA = <span class="keyword">new</span> ConcreteClassA();</span><br><span class="line">        AbstractClass objB = <span class="keyword">new</span> ConcreteClassB();</span><br><span class="line">        objA.TemplateMethod();</span><br><span class="line">        objB.TemplateMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-伪代码"><a class="markdownIt-Anchor" href="#4-伪代码"></a> 4. 伪代码</h2>
<p>本例中的<strong>模板方法</strong>模式为一款简单策略游戏中人工智能的不同分支提供 “框架”。</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210517202308.png" alt="模板方法模式示例的结构" /></p>
<p>一款简单游戏的 AI 类。</p>
<p>游戏中所有的种族都有几乎同类的单位和建筑。 因此你可以在不同的种族上复用相同的 AI 结构， 同时还需要具备重写一些细节的能力。 通过这种方式， 你可以重写半兽人的 AI 使其更富攻击性， 也可以让人类侧重防守， 还可以禁止怪物建造建筑。 在游戏中新增种族需要创建新的 AI 子类， 还需要重写 AI 基类中所声明的默认方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 抽象类定义了一个模板方法，其中通常会包含某个由抽象原语操作调用组成的算</span></span><br><span class="line"><span class="comment">// 法框架。具体子类会实现这些操作，但是不会对模板方法做出修改。</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GameAI</span> <span class="title">is</span></span></span><br><span class="line"><span class="class">    // 模板方法定义了某个算法的框架。</span></span><br><span class="line"><span class="class">    <span class="title">method</span> <span class="title">turn</span>() <span class="title">is</span></span></span><br><span class="line"><span class="class">        <span class="title">collectResources</span>()</span></span><br><span class="line"><span class="class">        <span class="title">buildStructures</span>()</span></span><br><span class="line"><span class="class">        <span class="title">buildUnits</span>()</span></span><br><span class="line"><span class="class">        <span class="title">attack</span>()</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    // 某些步骤可在基类中直接实现。</span></span><br><span class="line"><span class="class">    <span class="title">method</span> <span class="title">collectResources</span>() <span class="title">is</span></span></span><br><span class="line"><span class="class">        <span class="title">foreach</span> (<span class="title">s</span> <span class="title">in</span> <span class="title">this</span>.<span class="title">builtStructures</span>) <span class="title">do</span></span></span><br><span class="line"><span class="class">            <span class="title">s</span>.<span class="title">collect</span>()</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    // 某些可定义为抽象类型。</span></span><br><span class="line"><span class="class">    <span class="title">abstract</span> <span class="title">method</span> <span class="title">buildStructures</span>()</span></span><br><span class="line"><span class="class">    <span class="title">abstract</span> <span class="title">method</span> <span class="title">buildUnits</span>()</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    // 一个类可包含多个模板方法。</span></span><br><span class="line"><span class="class">    <span class="title">method</span> <span class="title">attack</span>() <span class="title">is</span></span></span><br><span class="line"><span class="class">        <span class="title">enemy</span> </span>= closestEnemy()</span><br><span class="line">        <span class="keyword">if</span> (enemy == <span class="keyword">null</span>)</span><br><span class="line">            sendScouts(map.center)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            sendWarriors(enemy.position)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> method <span class="title">sendScouts</span><span class="params">(position)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">abstract</span> method <span class="title">sendWarriors</span><span class="params">(position)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 具体类必须实现基类中的所有抽象操作，但是它们不能重写模板方法自身。</span></span></span><br><span class="line"><span class="function">class OrcsAI extends GameAI is</span></span><br><span class="line"><span class="function">    method <span class="title">buildStructures</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(there are some resources)</span> then</span></span><br><span class="line"><span class="function">            <span class="comment">// 建造农场，接着是谷仓，然后是要塞。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    method <span class="title">buildUnits</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(there are plenty of resources)</span> then</span></span><br><span class="line"><span class="function">            <span class="title">if</span> <span class="params">(there are no scouts)</span></span></span><br><span class="line"><span class="function">                <span class="comment">// 建造苦工，将其加入侦查编组。</span></span></span><br><span class="line"><span class="function">            <span class="keyword">else</span></span></span><br><span class="line"><span class="function">                <span class="comment">// 建造兽族步兵，将其加入战士编组。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// ...</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    method <span class="title">sendScouts</span><span class="params">(position)</span> is</span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(scouts.length &gt; <span class="number">0</span>)</span> then</span></span><br><span class="line"><span class="function">            <span class="comment">// 将侦查编组送到指定位置。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    method <span class="title">sendWarriors</span><span class="params">(position)</span> is</span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(warriors.length &gt; <span class="number">5</span>)</span> then</span></span><br><span class="line"><span class="function">            <span class="comment">// 将战斗编组送到指定位置。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 子类可以重写部分默认的操作。</span></span></span><br><span class="line"><span class="function">class MonstersAI extends GameAI is</span></span><br><span class="line"><span class="function">    method <span class="title">collectResources</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 怪物不会采集资源。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    method <span class="title">buildStructures</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 怪物不会建造建筑。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    method <span class="title">buildUnits</span><span class="params">()</span> is</span></span><br><span class="line"><span class="function">        <span class="comment">// 怪物不会建造单位。</span></span></span><br></pre></td></tr></table></figure>
<h2 id="5-案例"><a class="markdownIt-Anchor" href="#5-案例"></a> 5. 案例</h2>
<p>模板方法模式应用场景十分广泛。</p>
<p>在《Head First》的模板方法模式章节里列举了一个十分具有代表性的例子。</p>
<p>现实生活中，茶和咖啡是随处可见的饮料。冲泡一杯茶或冲泡一杯咖啡的过程是怎样的？</p>
<p>我们来整理一下流程。</p>
<ul>
<li>泡茶： 烧开水 ==&gt; 冲泡茶叶 ==&gt; 倒入杯中 ==&gt; 添加柠檬</li>
<li>泡咖啡： 烧开水 ==&gt; 冲泡咖啡 ==&gt; 倒入杯中 ==&gt; 添加糖和牛奶</li>
</ul>
<p>由以上处理步骤不难发现，准备这两种饮料的处理过程非常相似。我们可以使用模板类方法去限定制作饮料的算法框架。</p>
<p>其中相同的具有共性的步骤（如烧开水、倒入杯中），直接在抽象类中给出具体实现。</p>
<p>而对于有差异性的步骤，则在各自的具体类中给出实现。</p>
<p>【抽象类】</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Beverage</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模板方法，决定了算法骨架。相当于TemplateMethod()方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepareBeverage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        boilWater();</span><br><span class="line">        brew();</span><br><span class="line">        pourInCup();</span><br><span class="line">        <span class="keyword">if</span> (customWantsCondiments())</span><br><span class="line">        &#123;</span><br><span class="line">            addCondiments();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 共性操作，直接在抽象类中定义</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">boilWater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"烧开水"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 共性操作，直接在抽象类中定义</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pourInCup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"倒入杯中"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 钩子方法，决定某些算法步骤是否挂钩在算法中</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">customWantsCondiments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 特殊操作，在子类中具体实现</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 特殊操作，在子类中具体实现</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【具体类】</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tea</span> <span class="keyword">extends</span> <span class="title">Beverage</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"冲泡茶叶"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"添加柠檬"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coffee</span> <span class="keyword">extends</span> <span class="title">Beverage</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"冲泡咖啡豆"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"添加糖和牛奶"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【客户端】</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"============= 准备茶 ============="</span>);</span><br><span class="line">    Beverage tea = <span class="keyword">new</span> Tea();</span><br><span class="line">    tea.prepareBeverage();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"============= 准备咖啡 ============="</span>);</span><br><span class="line">    Beverage coffee = <span class="keyword">new</span> Coffee();</span><br><span class="line">    coffee.prepareBeverage();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="comment">============= 准备茶 =============</span></span><br><span class="line">烧开水</span><br><span class="line">冲泡茶叶</span><br><span class="line">倒入杯中</span><br><span class="line">添加柠檬</span><br><span class="line"><span class="comment">============= 准备咖啡 =============</span></span><br><span class="line">烧开水</span><br><span class="line">冲泡咖啡豆</span><br><span class="line">倒入杯中</span><br><span class="line">添加糖和牛奶</span><br></pre></td></tr></table></figure>
<h2 id="6-案例"><a class="markdownIt-Anchor" href="#6-案例"></a> 6. 案例</h2>
<p><strong>使用示例：</strong> 模版方法模式在 Java 框架中很常见。 开发者通常使用它来向框架用户提供通过继承实现的、 对标准功能进行扩展的简单方式。</p>
<p>这里是一些核心 Java 程序库中模版方法的示例：</p>
<ul>
<li><a href="http://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html" target="_blank" rel="noopener"><code>java.io.InputStream</code></a>、 <a href="http://docs.oracle.com/javase/8/docs/api/java/io/OutputStream.html" target="_blank" rel="noopener"><code>java.io.OutputStream</code></a>、 <a href="http://docs.oracle.com/javase/8/docs/api/java/io/Reader.html" target="_blank" rel="noopener"><code>java.io.Reader</code></a> 和 <a href="http://docs.oracle.com/javase/8/docs/api/java/io/Writer.html" target="_blank" rel="noopener"><code>java.io.Writer</code></a> 的所有非抽象方法。</li>
<li><a href="http://docs.oracle.com/javase/8/docs/api/java/util/AbstractList.html" target="_blank" rel="noopener"><code>java.util.AbstractList</code></a>、 <a href="http://docs.oracle.com/javase/8/docs/api/java/util/AbstractSet.html" target="_blank" rel="noopener"><code>java.util.AbstractSet</code></a> 和 <a href="http://docs.oracle.com/javase/8/docs/api/java/util/AbstractMap.html" target="_blank" rel="noopener"><code>java.util.AbstractMap</code></a> 的所有非抽象方法。</li>
<li><a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServlet.html" target="_blank" rel="noopener"><code>javax.servlet.http.HttpServlet</code></a>， 所有默认发送 HTTP 405 “方法不允许” 错误响应的 <code>do­XXX()</code>方法。 你可随时对其进行重写。</li>
</ul>
<p><strong>识别方法：</strong> 模版方法可以通过行为方法来识别， 该方法已有一个在基类中定义的 “默认” 行为。</p>
<h3 id="61-消除-if-else-和重复代码"><a class="markdownIt-Anchor" href="#61-消除-if-else-和重复代码"></a> 6.1. 消除 if … else 和重复代码</h3>
<p>假设要开发一个购物车功能，针对不同用户进行不同的处理：</p>
<ul>
<li>普通用户需要收取运费，运费是商品价格的 10%，无商品折扣；</li>
<li>VIP 用户同样需要收取商品价格 10% 的快递费，但购买两件以上相同商品时，第三件开始享受一定折扣；</li>
<li>内部用户可以免运费，无商品折扣。</li>
</ul>
<h4 id="问题-10-版本"><a class="markdownIt-Anchor" href="#问题-10-版本"></a> 问题 1.0 版本</h4>
<p>普通用户购物车</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalUserCart</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cart <span class="title">process</span><span class="params">(<span class="keyword">long</span> userId, Map&lt;Long, Integer&gt; items)</span> </span>&#123;</span><br><span class="line">        Cart cart = <span class="keyword">new</span> Cart();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把Map的购物车转换为Item列表</span></span><br><span class="line">        List&lt;Item&gt; itemList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        items.entrySet().stream().forEach(entry -&gt; &#123;</span><br><span class="line">            Item item = <span class="keyword">new</span> Item();</span><br><span class="line">            item.setId(entry.getKey());</span><br><span class="line">            item.setPrice(Db.getItemPrice(entry.getKey()));</span><br><span class="line">            item.setQuantity(entry.getValue());</span><br><span class="line">            itemList.add(item);</span><br><span class="line">        &#125;);</span><br><span class="line">        cart.setItems(itemList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//处理运费和商品优惠</span></span><br><span class="line">        itemList.stream().forEach(item -&gt; &#123;</span><br><span class="line">            <span class="comment">//运费为商品总价的10%</span></span><br><span class="line">            item.setDeliveryPrice(</span><br><span class="line">                item.getPrice().multiply(BigDecimal.valueOf(item.getQuantity())).multiply(<span class="keyword">new</span> BigDecimal(<span class="string">"0.1"</span>)));</span><br><span class="line">            <span class="comment">//无优惠</span></span><br><span class="line">            item.setCouponPrice(BigDecimal.ZERO);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//计算纯商品总价</span></span><br><span class="line">        cart.setTotalItemPrice(cart.getItems()</span><br><span class="line">            .stream()</span><br><span class="line">            .map(item -&gt; item.getPrice().multiply(BigDecimal.valueOf(item.getQuantity())))</span><br><span class="line">            .reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        <span class="comment">//计算运费总价</span></span><br><span class="line">        cart.setTotalDeliveryPrice(</span><br><span class="line">            cart.getItems().stream().map(Item::getDeliveryPrice).reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        <span class="comment">//计算总优惠</span></span><br><span class="line">        cart.setTotalDiscount(</span><br><span class="line">            cart.getItems().stream().map(Item::getCouponPrice).reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        <span class="comment">//应付总价=商品总价+运费总价-总优惠</span></span><br><span class="line">        cart.setPayPrice(cart.getTotalItemPrice().add(cart.getTotalDeliveryPrice()).subtract(cart.getTotalDiscount()));</span><br><span class="line">        <span class="keyword">return</span> cart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>VIP 用户购物车</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VipUserCart</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cart <span class="title">process</span><span class="params">(<span class="keyword">long</span> userId, Map&lt;Long, Integer&gt; items)</span> </span>&#123;</span><br><span class="line">        Cart cart = <span class="keyword">new</span> Cart();</span><br><span class="line"></span><br><span class="line">        List&lt;Item&gt; itemList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        items.entrySet().stream().forEach(entry -&gt; &#123;</span><br><span class="line">            Item item = <span class="keyword">new</span> Item();</span><br><span class="line">            item.setId(entry.getKey());</span><br><span class="line">            item.setPrice(Db.getItemPrice(entry.getKey()));</span><br><span class="line">            item.setQuantity(entry.getValue());</span><br><span class="line">            itemList.add(item);</span><br><span class="line">        &#125;);</span><br><span class="line">        cart.setItems(itemList);</span><br><span class="line"></span><br><span class="line">        itemList.stream().forEach(item -&gt; &#123;</span><br><span class="line">            <span class="comment">//运费为商品总价的10%</span></span><br><span class="line">            item.setDeliveryPrice(</span><br><span class="line">                item.getPrice().multiply(BigDecimal.valueOf(item.getQuantity())).multiply(<span class="keyword">new</span> BigDecimal(<span class="string">"0.1"</span>)));</span><br><span class="line">            <span class="comment">//购买两件以上相同商品，第三件开始享受一定折扣</span></span><br><span class="line">            <span class="keyword">if</span> (item.getQuantity() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">                item.setCouponPrice(item.getPrice()</span><br><span class="line">                    .multiply(BigDecimal.valueOf(<span class="number">100</span> - Db.getUserCouponPercent(userId)).divide(<span class="keyword">new</span> BigDecimal(<span class="string">"100"</span>)))</span><br><span class="line">                    .multiply(BigDecimal.valueOf(item.getQuantity() - <span class="number">2</span>)));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                item.setCouponPrice(BigDecimal.ZERO);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        cart.setTotalItemPrice(cart.getItems()</span><br><span class="line">            .stream()</span><br><span class="line">            .map(item -&gt; item.getPrice().multiply(BigDecimal.valueOf(item.getQuantity())))</span><br><span class="line">            .reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        cart.setTotalDeliveryPrice(</span><br><span class="line">            cart.getItems().stream().map(Item::getDeliveryPrice).reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        cart.setTotalDiscount(</span><br><span class="line">            cart.getItems().stream().map(Item::getCouponPrice).reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        cart.setPayPrice(cart.getTotalItemPrice().add(cart.getTotalDeliveryPrice()).subtract(cart.getTotalDiscount()));</span><br><span class="line">        <span class="keyword">return</span> cart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>内部用户购物车</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InternalUserCart</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cart <span class="title">process</span><span class="params">(<span class="keyword">long</span> userId, Map&lt;Long, Integer&gt; items)</span> </span>&#123;</span><br><span class="line">        Cart cart = <span class="keyword">new</span> Cart();</span><br><span class="line"></span><br><span class="line">        List&lt;Item&gt; itemList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        items.entrySet().stream().forEach(entry -&gt; &#123;</span><br><span class="line">            Item item = <span class="keyword">new</span> Item();</span><br><span class="line">            item.setId(entry.getKey());</span><br><span class="line">            item.setPrice(Db.getItemPrice(entry.getKey()));</span><br><span class="line">            item.setQuantity(entry.getValue());</span><br><span class="line">            itemList.add(item);</span><br><span class="line">        &#125;);</span><br><span class="line">        cart.setItems(itemList);</span><br><span class="line"></span><br><span class="line">        itemList.stream().forEach(item -&gt; &#123;</span><br><span class="line">            <span class="comment">//免运费</span></span><br><span class="line">            item.setDeliveryPrice(BigDecimal.ZERO);</span><br><span class="line">            <span class="comment">//无优惠</span></span><br><span class="line">            item.setCouponPrice(BigDecimal.ZERO);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        cart.setTotalItemPrice(cart.getItems()</span><br><span class="line">            .stream()</span><br><span class="line">            .map(item -&gt; item.getPrice().multiply(BigDecimal.valueOf(item.getQuantity())))</span><br><span class="line">            .reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        cart.setTotalDeliveryPrice(</span><br><span class="line">            cart.getItems().stream().map(Item::getDeliveryPrice).reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        cart.setTotalDiscount(</span><br><span class="line">            cart.getItems().stream().map(Item::getCouponPrice).reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        cart.setPayPrice(cart.getTotalItemPrice().add(cart.getTotalDeliveryPrice()).subtract(cart.getTotalDiscount()));</span><br><span class="line">        <span class="keyword">return</span> cart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"wrong"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Cart <span class="title">wrong</span><span class="params">(@RequestParam(<span class="string">"userId"</span>)</span> <span class="keyword">int</span> userId) </span>&#123;</span><br><span class="line">    String userCategory = Db.getUserCategory(userId);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (userCategory.equals(<span class="string">"Normal"</span>)) &#123;</span><br><span class="line">        NormalUserCart normalUserCart = <span class="keyword">new</span> NormalUserCart();</span><br><span class="line">        <span class="keyword">return</span> normalUserCart.process(userId, items);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (userCategory.equals(<span class="string">"Vip"</span>)) &#123;</span><br><span class="line">        VipUserCart vipUserCart = <span class="keyword">new</span> VipUserCart();</span><br><span class="line">        <span class="keyword">return</span> vipUserCart.process(userId, items);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (userCategory.equals(<span class="string">"Internal"</span>)) &#123;</span><br><span class="line">        InternalUserCart internalUserCart = <span class="keyword">new</span> InternalUserCart();</span><br><span class="line">        <span class="keyword">return</span> internalUserCart.process(userId, items);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对比一下代码量可以发现，三种购物车 70% 的代码是重复的。原因很简单，虽然不同类型用户计算运费和优惠的方式不同，但整个购物车的初始化、统计总价、总运费、总优惠和支付价格的逻辑都是一样的。</p>
</blockquote>
<h4 id="修正版本"><a class="markdownIt-Anchor" href="#修正版本"></a> 修正版本</h4>
<p>1.0 版本的问题在于：相同的代码应该只在一处出现。</p>
<p>如果我们熟记抽象类和抽象方法的定义的话，这时或许就会想到，是否可以把重复的逻辑定义在抽象类中，三个购物车只要分别实现不同的那份逻辑呢？</p>
<p>其实，这个模式就是模板方法模式。</p>
<blockquote>
<p>下面展示基于 工厂模式+模板方法模式 优化重复代码。</p>
</blockquote>
<p>【抽象类】</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCart</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cart <span class="title">process</span><span class="params">(<span class="keyword">long</span> userId, Map&lt;Long, Integer&gt; items)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Cart cart = <span class="keyword">new</span> Cart();</span><br><span class="line"></span><br><span class="line">        List&lt;Item&gt; itemList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        items.entrySet().stream().forEach(entry -&gt; &#123;</span><br><span class="line">            Item item = <span class="keyword">new</span> Item();</span><br><span class="line">            item.setId(entry.getKey());</span><br><span class="line">            item.setPrice(Db.getItemPrice(entry.getKey()));</span><br><span class="line">            item.setQuantity(entry.getValue());</span><br><span class="line">            itemList.add(item);</span><br><span class="line">        &#125;);</span><br><span class="line">        cart.setItems(itemList);</span><br><span class="line"></span><br><span class="line">        itemList.stream().forEach(item -&gt; &#123;</span><br><span class="line">            processCouponPrice(userId, item);</span><br><span class="line">            processDeliveryPrice(userId, item);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        cart.setTotalItemPrice(cart.getItems()</span><br><span class="line">            .stream()</span><br><span class="line">            .map(item -&gt; item.getPrice().multiply(BigDecimal.valueOf(item.getQuantity())))</span><br><span class="line">            .reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        cart.setTotalDeliveryPrice(</span><br><span class="line">            cart.getItems().stream().map(Item::getDeliveryPrice).reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        cart.setTotalDiscount(</span><br><span class="line">            cart.getItems().stream().map(Item::getCouponPrice).reduce(BigDecimal.ZERO, BigDecimal::add));</span><br><span class="line">        cart.setPayPrice(cart.getTotalItemPrice().add(cart.getTotalDeliveryPrice()).subtract(cart.getTotalDiscount()));</span><br><span class="line">        <span class="keyword">return</span> cart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">processCouponPrice</span><span class="params">(<span class="keyword">long</span> userId, Item item)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">processDeliveryPrice</span><span class="params">(<span class="keyword">long</span> userId, Item item)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【普通用户购物车】</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span>(value = <span class="string">"NormalUserCart"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalUserCart</span> <span class="keyword">extends</span> <span class="title">AbstractCart</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">processCouponPrice</span><span class="params">(<span class="keyword">long</span> userId, Item item)</span> </span>&#123;</span><br><span class="line">        item.setCouponPrice(BigDecimal.ZERO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">processDeliveryPrice</span><span class="params">(<span class="keyword">long</span> userId, Item item)</span> </span>&#123;</span><br><span class="line">        item.setDeliveryPrice(item.getPrice()</span><br><span class="line">            .multiply(BigDecimal.valueOf(item.getQuantity()))</span><br><span class="line">            .multiply(<span class="keyword">new</span> BigDecimal(<span class="string">"0.1"</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【VIP 用户购物车】</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span>(value = <span class="string">"VipUserCart"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VipUserCart</span> <span class="keyword">extends</span> <span class="title">NormalUserCart</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">processCouponPrice</span><span class="params">(<span class="keyword">long</span> userId, Item item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (item.getQuantity() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            item.setCouponPrice(item.getPrice()</span><br><span class="line">                .multiply(BigDecimal.valueOf(<span class="number">100</span> - Db.getUserCouponPercent(userId)).divide(<span class="keyword">new</span> BigDecimal(<span class="string">"100"</span>)))</span><br><span class="line">                .multiply(BigDecimal.valueOf(item.getQuantity() - <span class="number">2</span>)));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            item.setCouponPrice(BigDecimal.ZERO);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【内部用户购物车】</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span>(value = <span class="string">"InternalUserCart"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InternalUserCart</span> <span class="keyword">extends</span> <span class="title">AbstractCart</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">processCouponPrice</span><span class="params">(<span class="keyword">long</span> userId, Item item)</span> </span>&#123;</span><br><span class="line">        item.setCouponPrice(BigDecimal.ZERO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">processDeliveryPrice</span><span class="params">(<span class="keyword">long</span> userId, Item item)</span> </span>&#123;</span><br><span class="line">        item.setDeliveryPrice(BigDecimal.ZERO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【客户端】</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"right"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Cart <span class="title">right</span><span class="params">(@RequestParam(<span class="string">"userId"</span>)</span> <span class="keyword">int</span> userId) </span>&#123;</span><br><span class="line">    String userCategory = Db.getUserCategory(userId);</span><br><span class="line">    AbstractCart cart = (AbstractCart) applicationContext.getBean(userCategory + <span class="string">"UserCart"</span>);</span><br><span class="line">    <span class="keyword">return</span> cart.process(userId, items);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-与其他模式的关系"><a class="markdownIt-Anchor" href="#7-与其他模式的关系"></a> 7. 与其他模式的关系</h2>
<ul>
<li><a href="https://refactoringguru.cn/design-patterns/factory-method" target="_blank" rel="noopener">工厂方法模式</a>是<a href="https://refactoringguru.cn/design-patterns/template-method" target="_blank" rel="noopener">模板方法模式</a>的一种特殊形式。 同时， <em>工厂方法</em>可以作为一个大型<em>模板方法</em>中的一个步骤。</li>
<li><a href="https://refactoringguru.cn/design-patterns/template-method" target="_blank" rel="noopener">模板方法</a>基于继承机制： 它允许你通过扩展子类中的部分内容来改变部分算法。 <a href="https://refactoringguru.cn/design-patterns/strategy" target="_blank" rel="noopener">策略模式</a>基于组合机制： 你可以通过对相应行为提供不同的策略来改变对象的部分行为。 <em>模板方法</em>在类层次上运作， 因此它是静态的。 <em>策略</em>在对象层次上运作， 因此允许在运行时切换行为。</li>
</ul>
<h2 id="8-参考资料"><a class="markdownIt-Anchor" href="#8-参考资料"></a> 8. 参考资料</h2>
<ul>
<li><a href="https://book.douban.com/subject/2243615/" target="_blank" rel="noopener">《Head First 设计模式》</a></li>
<li><a href="https://book.douban.com/subject/2334288/" target="_blank" rel="noopener">《大话设计模式》</a></li>
<li><a href="https://refactoringguru.cn/design-patterns/catalog" target="_blank" rel="noopener">设计模式教程</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/17/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/17/">17</a><span class="page-number current">18</span>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Zhang Peng"
    src="/blog/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Zhang Peng</p>
  <div class="site-description" itemprop="description">Dunwu's Blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">173</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">102</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/dunwu" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;dunwu" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:forbreak@163.com" title="E-Mail &amp;rarr; mailto:forbreak@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/blog/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-paper-plane"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang Peng</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">976k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">14:48</span>
</div>

        












        
      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>

<script src="/blog/js/bookmark.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>














  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://blog-ajay4qmfci.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
